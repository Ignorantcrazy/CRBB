<?xml version="1.0" encoding="utf-8" ?>
<dataOperations xmlns="http://oversea.newegg.com/DataOperation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <!--备案总数-->
  <dataCommand name="LoadBANum" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
            SELECT COUNT(0) FROM T_LicenseRecord WITH(NOLOCK)
            WHERE n_LicensorProvince=@n_ProvinceCode
            AND dt_RecordDate>=@dt_StartDate
            AND dt_RecordDate<@dt_EndDate
    ]]>
    </commandText>
    <parameters>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@dt_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@dt_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--备案涉及总金额-->
  <dataCommand name="LoadBAAmount" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
            SELECT SUM(d_RecordAmountCN) FROM T_LicenseRecord WITH(NOLOCK)
            WHERE n_LicensorProvince=@n_ProvinceCode
            AND dt_RecordDate>=@dt_StartDate
            AND dt_RecordDate<@dt_EndDate
    ]]>
    </commandText>
    <parameters>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@dt_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@dt_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--备案涉及的金额规模分布-->
  <dataCommand name="LoadAmountDistribution" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        DECLARE @min INT=1;DECLARE @max INT=10;DECLARE @totalNum INT;DECLARE @rangeNum INT;
        DECLARE @T_AmountDistribution TABLE(s_AmountRange NVARCHAR(50),n_Num INT,d_Rate FLOAT)

        SELECT d_RecordAmountCN 
        INTO #Temp FROM T_LicenseRecord WITH(NOLOCK)
        WHERE n_LicensorProvince=@n_ProvinceCode
        AND dt_RecordDate>=@dt_StartDate
        AND dt_RecordDate<@dt_EndDate

        SELECT @totalNum=COUNT(0) FROM #Temp

        SELECT @rangeNum=COUNT(0) FROM #Temp WHERE #Temp.d_RecordAmountCN>=@min*1000 AND #Temp.d_RecordAmountCN<@max*1000
        INSERT INTO @T_AmountDistribution VALUES('1000万-1亿',@rangeNum
	        ,CASE WHEN @totalNum=0 THEN 0 ELSE ROUND(@rangeNum*1.0/@totalNum,4) END)
        SELECT @rangeNum=COUNT(0) FROM #Temp WHERE #Temp.d_RecordAmountCN>=@min*100 AND #Temp.d_RecordAmountCN<@max*100
        INSERT INTO @T_AmountDistribution VALUES('100万-1000万',@rangeNum
	        ,CASE WHEN @totalNum=0 THEN 0 ELSE ROUND(@rangeNum*1.0/@totalNum,4) END)
        SELECT @rangeNum=COUNT(0) FROM #Temp WHERE #Temp.d_RecordAmountCN>=@min*10 AND #Temp.d_RecordAmountCN<@max*10
        INSERT INTO @T_AmountDistribution VALUES('10万-100万',@rangeNum
	        ,CASE WHEN @totalNum=0 THEN 0 ELSE ROUND(@rangeNum*1.0/@totalNum,4) END)
        SELECT @rangeNum=COUNT(0) FROM #Temp WHERE #Temp.d_RecordAmountCN>=@min AND #Temp.d_RecordAmountCN<@max
        INSERT INTO @T_AmountDistribution VALUES('1万-10万',@rangeNum
	        ,CASE WHEN @totalNum=0 THEN 0 ELSE ROUND(@rangeNum*1.0/@totalNum,4) END)
        SELECT @rangeNum=COUNT(0) FROM #Temp WHERE #Temp.d_RecordAmountCN<@min
        INSERT INTO @T_AmountDistribution VALUES('0-1万',@rangeNum
	        ,CASE WHEN @totalNum=0 THEN 0 ELSE ROUND(@rangeNum*1.0/@totalNum,4) END)
        SELECT @rangeNum=COUNT(0) FROM #Temp WHERE #Temp.d_RecordAmountCN<=0
        INSERT INTO @T_AmountDistribution VALUES('无偿许可',@rangeNum
	        ,CASE WHEN @totalNum=0 THEN 0 ELSE ROUND(@rangeNum*1.0/@totalNum,4) END)
        INSERT INTO @T_AmountDistribution VALUES('合计',@totalNum,1)

        SELECT * FROM @T_AmountDistribution
        DROP TABLE #Temp

      ]]>
    </commandText>
    <parameters>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@dt_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@dt_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--备案区域分布情况-->
  <dataCommand name="LoadAreaDistribution" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
  select 1
    ]]>
    </commandText>
    <parameters>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@dt_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@dt_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--五种类型许可人的许可数量-->
  <dataCommand name="LoadBALicensorSituation" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
select 1
    ]]>
    </commandText>
    <parameters>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@dt_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@dt_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--三种类型许可人的许可数量-->
  <dataCommand name="LoadBALicenseeSituation" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
select 1
    ]]>
    </commandText>
    <parameters>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@dt_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@dt_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--实施类型-->
  <dataCommand name="LoadLicenseTypeSituation" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
select 1
    ]]>
    </commandText>
    <parameters>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@dt_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@dt_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--合同性质-->
  <dataCommand name="LoadContractType" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
select 1
    ]]>
    </commandText>
    <parameters>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@dt_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@dt_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>

  <!--=================================================================-->
  <!--质押总数-->
  <dataCommand name="LoadZYNum" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
            SELECT 1
    ]]>
    </commandText>
    <parameters>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@dt_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@dt_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--质押涉及的三种专利数量-->
  <dataCommand name="LoadZYNums" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
            SELECT 1
    ]]>
    </commandText>
    <parameters>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@dt_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@dt_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--质押总金额-->
  <dataCommand name="LoadZYAmount" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
            SELECT 1
    ]]>
    </commandText>
    <parameters>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@dt_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@dt_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--质押区域分布情况-->
  <dataCommand name="LoadZYDistributionOfArea" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
            SELECT 1
    ]]>
    </commandText>
    <parameters>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@dt_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@dt_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--五种出质人数量-->
  <dataCommand name="LoadZYPledgorSituation" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
            SELECT 1
    ]]>
    </commandText>
    <parameters>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@dt_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@dt_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--三种质权人数量-->
  <dataCommand name="LoadZYPawneeSituation" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
            SELECT 1
    ]]>
    </commandText>
    <parameters>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@dt_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@dt_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--质押期限-->
  <dataCommand name="LoadZYDuration" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
            SELECT 1
    ]]>
    </commandText>
    <parameters>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@dt_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@dt_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>

  <!--=================================================================-->






  <!--——————————————————————————————————-->
  
  <!--图begion-->
  <!--广东申请、授权企业数量查询-->
  <dataCommand name="loadDataXXXLXSQR_3_3SZZL_0_SQ_1_QY_Count" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --广东省企业专利申请受理企业数量
      SELECT count(distinct s_Name) n_Count
      FROM dbo.T_Applicants c WITH(NOLOCK)
      WHERE c.s_ApplicantType=@n_ApplicanterType
         AND c.s_ApplicationNO IN (
      SELECT a.Application_NO
      FROM dbo.T_PatentCase a WITH(NOLOCK)
           LEFT JOIN 
           dbo.T_PatentStatus b WITH(NOLOCK)
           ON a.Application_NO=b.s_ApplicationNO
      WHERE b.dt_ApplyDate<@d_EndDate AND b.dt_ApplyDate>=@d_StartDate
           --AND a.s_PatentType=1
      )
         ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
      <param name="@n_ApplicanterType" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadDataXXXLXSQR_3_3SZZL_0_SQ_3_QY_Count" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --广东省企业专利授权受理企业数量
      SELECT count(distinct s_Name) n_Count
      FROM dbo.T_Applicants c WITH(NOLOCK)
      WHERE c.s_ApplicantType=@n_ApplicanterType
         AND c.s_ApplicationNO IN (
      SELECT a.Application_NO
      FROM dbo.T_PatentCase a WITH(NOLOCK)
           LEFT JOIN 
           dbo.T_PatentStatus b WITH(NOLOCK)
           ON a.Application_NO=b.s_ApplicationNO
      WHERE b.dt_AuthorizeDate<@d_EndDate AND b.dt_AuthorizeDate>=@d_StartDate
           --AND a.s_PatentType=1
      )
         ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
      <param name="@n_ApplicanterType" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadDataXXXLXSQR_3_3SZZL_1_SQ_1_QY_Count" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --广东省企业发明专利申请受理企业数量
      SELECT count(distinct s_Name) n_Count
      FROM dbo.T_Applicants c WITH(NOLOCK)
      WHERE c.s_ApplicantType=@n_ApplicanterType
         AND c.s_ApplicationNO IN (
      SELECT a.Application_NO
      FROM dbo.T_PatentCase a WITH(NOLOCK) 
           LEFT JOIN 
           dbo.T_PatentStatus b WITH(NOLOCK) 
           ON a.Application_NO=b.s_ApplicationNO
      WHERE b.dt_ApplyDate<@d_EndDate AND b.dt_ApplyDate>=@d_StartDate
           AND a.s_PatentType=@n_PatentType
      )
         ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
      <param name="@n_ApplicanterType" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadDataXXXLXSQR_3_3SZZL_1_SQ_3_QY_Count" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --广东省企业发明专利授权受理企业数量
      SELECT count(distinct s_Name) n_Count
      FROM dbo.T_Applicants c WITH(NOLOCK)
      WHERE c.s_ApplicantType=@n_ApplicanterType
         AND c.s_ApplicationNO IN (
      SELECT a.Application_NO
      FROM dbo.T_PatentCase a  WITH(NOLOCK)
           LEFT JOIN 
           dbo.T_PatentStatus b WITH(NOLOCK) 
           ON a.Application_NO=b.s_ApplicationNO
      WHERE b.dt_AuthorizeDate<@d_EndDate AND b.dt_AuthorizeDate>=@d_StartDate
           AND a.s_PatentType=@n_PatentType
      )
         ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
      <param name="@n_ApplicanterType" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>

  <!--广东申请、授权企业数量查询-1-->
  <dataCommand name="loadDataXXXLXSQR_3_3SZZL_SQ_1_QY_Count" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --广东省企业专利申请受理企业数量
          DECLARE @s_ProvinceCode varchar(50)=@n_ProvinceCode
          DECLARE @s_PatentType char(1)=@n_PatentType
          DECLARE @s_ApplicantType char(1)=@n_ApplicanterType
          DECLARE @s_ApplicantSort char(1)=@n_ApplicantSort

          select COUNT(1) as  n_Count
          from (
          select A=1
          from T_Applicants A
          join T_PatentCase P on A.s_ApplicationNO=P.Application_NO
          join  T_PatentStatus S on S.s_ApplicationNO=A.s_ApplicationNO
          WHERE S.dt_ApplyDate<=@d_EndDate AND S.dt_ApplyDate>=@d_StartDate
            AND ( P.s_PatentType=@n_PatentType  or @n_PatentType='0')
            AND A.s_ApplicantType=@s_ApplicantType
            AND A.s_ApplicantSort=@n_ApplicantSort
            AND A.s_Province=@s_ProvinceCode
           group by s_Name
           ) temp
         ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
      <param name="@n_ApplicanterType" dbType="Int32" direction="Input"/>
      <param name="@n_ApplicantSort" dbType="Int32" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadDataXXXLXSQR_3_3SZZL_SQ_3_QY_Count" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --广东省企业专利授权受理企业数量
          select COUNT(1) as  n_Count
          from (
          select A=1
          from T_Applicants A
          join T_PatentCase P on A.s_ApplicationNO=P.Application_NO
          join  T_PatentStatus S on S.s_ApplicationNO=A.s_ApplicationNO
          WHERE S.dt_AuthorizeDate<@d_EndDate AND S.dt_AuthorizeDate>=@d_StartDate
            AND ( P.s_PatentType=@n_PatentType  or @n_PatentType=0)
            AND A.s_ApplicantType=@n_ApplicanterType
            AND A.s_ApplicantSort=@n_ApplicantSort
            AND A.s_Province=@n_ProvinceCode
           group by s_Name
           ) temp
         ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
      <param name="@n_ApplicanterType" dbType="Int32" direction="Input"/>
      <param name="@n_ApplicantSort" dbType="Int32" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东申请、授权-->
  <dataCommand name="loadDataZLSQSLQST_LN" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        --广东省历年专利申请受理（/授权）趋势图
        SELECT
	        n_PatentYear n_Year
	        ,n_PatentType n_PatentType
	        ,CurCount n_Count
	        ,ZZL= CASE WHEN LastYearCount is not null THEN (CurCount-LastYearCount)*1.0/LastYearCount ELSE 0 END 
        FROM(
	        SELECT SUM(f_Count) CurCount
	        ,n_PatentType,n_PatentYear
	        ,LastYearCount=(SELECT 
						        SUM(f_Count) 
					        FROM T_PatentChartBaseData_Year I  WITH(NOLOCK)
					        WHERE V.n_ProvinceCode=19 
						        and I.n_PatentType=V.n_PatentType 
						        and I.n_PatentYear-1=V.n_PatentYear
					        )
	        FROM dbo.T_PatentChartBaseData_Year V  WITH(NOLOCK)
	        WHERE V.n_ProvinceCode=19
                AND V.n_PatentStatus=@n_PatentStatus
                AND (YEAR(@d_StartDate)<n_PatentYear OR (YEAR(@d_StartDate)=n_PatentYear AND MONTH(@d_StartDate)<=n_PatentMonth))
	              AND (YEAR(@d_EndDate)>n_PatentYear OR (YEAR(@d_EndDate)=n_PatentYear AND MONTH(@d_EndDate)>=n_PatentMonth)) 
	        GROUP BY n_PatentType,n_PatentYear,n_ProvinceCode
        ) as T
        UNION
        SELECT
	        n_PatentYear n_Year
	        ,0 n_PatentType
	        ,CurCount n_Count
	        ,ZZL= CASE WHEN LastYearCount is not null THEN (CurCount-LastYearCount)*1.0/LastYearCount ELSE 0 END 
        FROM(
	        SELECT 
		        SUM(f_Count) CurCount
		        ,n_PatentYear
		        ,LastYearCount=(SELECT SUM(f_Count) 
						        FROM T_PatentChartBaseData_Year I  WITH(NOLOCK)
						        WHERE V.n_ProvinceCode=19 
						        and I.n_PatentYear-1=V.n_PatentYear
						        )
	        FROM dbo.T_PatentChartBaseData_Year V  WITH(NOLOCK)
	        WHERE V.n_ProvinceCode=19
                AND V.n_PatentStatus=@n_PatentStatus
                AND (YEAR(@d_StartDate)<n_PatentYear OR (YEAR(@d_StartDate)=n_PatentYear AND MONTH(@d_StartDate)<=n_PatentMonth))
	              AND (YEAR(@d_EndDate)>n_PatentYear OR (YEAR(@d_EndDate)=n_PatentYear AND MONTH(@d_EndDate)>=n_PatentMonth)) 
	        GROUP BY n_PatentYear,n_ProvinceCode
        ) as T
      
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadDataZLSQSLQST_Y" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --广东省专利申请受理（/授权）趋势图
      --广东省发明专利申请受理（/授权）趋势图loadDataFMZLSQSLQST
      --广东省实用新型专利申请受理（/授权）趋势图loadDataSYXXZLSQSLQST
      --广东省外观设计专利申请受理（/授权）趋势图loadDataWGSJZLSQSLQST
 
          SELECT SUM(f_Count) V_COUNT
              ,n_PatentType V_n_PatentType
              ,n_PatentYear V_Year
              ,n_PatentMonth V_Month
              INTO #G1
              FROM  dbo.T_PatentChartBaseData  WITH(NOLOCK)
              WHERE n_PatentStatus=@n_PatentStatus
                AND (YEAR(@d_StartDate)<n_PatentYear OR (YEAR(@d_StartDate)=n_PatentYear AND MONTH(@d_StartDate)<=n_PatentMonth))
	              AND (YEAR(@d_EndDate)>n_PatentYear OR (YEAR(@d_EndDate)=n_PatentYear AND MONTH(@d_EndDate)>=n_PatentMonth))
              GROUP BY n_PatentYear,n_PatentMonth,n_PatentType
 
              SELECT SUM(f_Count) V_COUNT
              ,n_PatentType V_n_PatentType
              ,n_PatentYear V_Year
              ,n_PatentMonth V_Month
              INTO #G2
              FROM  dbo.T_PatentChartBaseData  WITH(NOLOCK)
              WHERE n_PatentStatus=@n_PatentStatus
                AND ((YEAR(@d_StartDate)-1)<n_PatentYear OR ((YEAR(@d_StartDate)-1)=n_PatentYear AND MONTH(@d_StartDate)<=n_PatentMonth))
	              AND ((YEAR(@d_EndDate)-1)>n_PatentYear OR ((YEAR(@d_EndDate)-1)=n_PatentYear AND MONTH(@d_EndDate)>=n_PatentMonth))
              GROUP BY n_PatentYear,n_PatentMonth,n_PatentType
      
              SELECT g1.V_Year n_Year  
              ,g1.V_Month n_Month
              ,g1.V_n_PatentType n_PatentType
              ,g1.V_COUNT n_Count
              ,g2.V_COUNT n_CountLast
              ,ZZL=
		        CASE WHEN g2.V_COUNT=0 THEN 0 ELSE (ISNULL(((g1.V_COUNT-g2.V_COUNT)*100.0/g2.V_COUNT),0) )END
	          INTO #G3
              FROM #G1 g1
              LEFT JOIN #G2 g2
              ON g1.V_n_PatentType=g2.V_n_PatentType 
              AND g1.V_Month=g2.V_Month
              AND g1.V_Year-1=g2.V_Year
      
              DECLARE @index int=1;
              DECLARE @T_Rate TABLE(n_Month int null,n_PatentType int null, ZZL float null);
      
              WHILE(@index<=MONTH(@d_EndDate))
              BEGIN
		        DECLARE @patentType int =1;
		        WHILE(@patentType<=3)
		        BEGIN
			        DECLARE @curCount int;
			        DECLARE @lastCount int;
			        SELECT @curCount=SUM(n_Count),
				            @lastCount=SUM(n_CountLast) FROM #G3
				        WHERE n_Month<=@index
				        AND   n_PatentType=@patentType

			        INSERT INTO @T_Rate (n_Month,n_PatentType,ZZL)
			        VALUES
				        (
				        @index,
				        @patentType,
				        CASE WHEN @lastCount=0 THEN 0 ELSE ISNULL((@curCount-@lastCount)*100.0/@lastCount,0) END
				        )
			        SET @patentType=@patentType+1
		        END
		        SET @index=@index+1
              END 
      
              SELECT g3.n_Year,g3.n_Month,g3.n_PatentType,g3.n_Count,rate.ZZL  
              FROM #G3 g3
              LEFT JOIN @T_Rate rate
              ON g3.n_Month=rate.n_Month AND G3.n_PatentType=RATE.n_PatentType
      
              DROP TABLE #G1
              DROP TABLE #G2
              DROP TABLE #G3
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadDataSZZLLXSQSLZKT" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --广东省三种专利类型申请受理（/授权）状况图(年月)
      SELECT SUM(f_Count) V_COUNT
      ,n_PatentType  V_n_PatentType
      INTO #Ta
      FROM dbo.T_PatentChartBaseData  WITH(NOLOCK)
      WHERE n_PatentStatus=@n_PatentStatus 
        AND (YEAR(@d_StartDate)<n_PatentYear OR (YEAR(@d_StartDate)=n_PatentYear AND MONTH(@d_StartDate)<=n_PatentMonth))
	      AND (YEAR(@d_EndDate)>n_PatentYear OR (YEAR(@d_EndDate)=n_PatentYear AND MONTH(@d_EndDate)>=n_PatentMonth))
      GROUP BY n_PatentType
 
      SELECT   
            BL=CASE WHEN (SELECT SUM(#Ta.V_COUNT) From #Ta ) =0 THEN 0 ELSE
            T.V_COUNT*100.0
            /(SELECT SUM(#Ta.V_COUNT) From #Ta )
            END
              ,T.V_COUNT n_Count
              ,T.V_n_PatentType n_PatentType
      FROM 
      #Ta T
    
      DROP TABLE #Ta
      
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadDataWZLXSQRZLSQSLT" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --广东省五种类型申请人专利申请受理（/授权）状况图(年月)
      SELECT ISNULL(SUM(f_Count),0) V_COUNT
      ,n_ApplicanterType V_ApplicanterType 
      INTO #Ta
      FROM dbo.T_PatentChartBaseData  WITH(NOLOCK)
      WHERE n_PatentStatus=@n_PatentStatus
      AND (YEAR(@d_StartDate)<n_PatentYear OR (YEAR(@d_StartDate)=n_PatentYear AND MONTH(@d_StartDate)<=n_PatentMonth))
      AND (YEAR(@d_EndDate)>n_PatentYear OR (YEAR(@d_EndDate)=n_PatentYear AND MONTH(@d_EndDate)>=n_PatentMonth))
      GROUP BY n_ApplicanterType
 
      SELECT   
      BL=CASE WHEN (SELECT SUM(#Ta.V_COUNT) From #Ta ) =0 THEN 0 ELSE
        T.V_COUNT
          *1.0/(SELECT SUM(#Ta.V_COUNT) From #Ta )
          END
      ,T.V_COUNT n_Count
      ,T.V_ApplicanterType n_ApplicanterType
      FROM 
      #Ta T
    
      DROP TABLE #Ta
      
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadDataXXXLX_ZLSQRLXZKT" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --广东省发明专利申请人（/授权专利权）类型状况图(年月)
      --广东省实用新型专利申请人（/授权专利权）类型状况图(年月)
      --广东省外观设计专利申请人（/授权专利权）类型状况图(年月)
      SELECT ISNULL(SUM(f_Count),0) V_COUNT
      ,n_ApplicanterType V_ApplicanterType 
      INTO #Ta
      FROM dbo.T_PatentChartBaseData  WITH(NOLOCK)
      WHERE n_PatentStatus=@n_PatentStatus
        AND n_PatentType=@n_PatentType
        AND (YEAR(@d_StartDate)<n_PatentYear OR (YEAR(@d_StartDate)=n_PatentYear AND MONTH(@d_StartDate)<=n_PatentMonth))
	      AND (YEAR(@d_EndDate)>n_PatentYear OR (YEAR(@d_EndDate)=n_PatentYear AND MONTH(@d_EndDate)>=n_PatentMonth))
      GROUP BY n_ApplicanterType
 
      SELECT   
        BL= CASE WHEN (SELECT SUM(#Ta.V_COUNT) From #Ta )=0 THEN 0 ELSE 
          T.V_COUNT*100.0 
            /(SELECT SUM(#Ta.V_COUNT) From #Ta )
            END
        ,T.V_COUNT n_Count
        ,T.V_ApplicanterType n_ApplicanterType
      FROM 
      #Ta T
    
      DROP TABLE #Ta
      
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadDataXXXLXSQR_SZZLSQZKT" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --广东省工矿企业(等五种专利人)专利申请受理（/授权）状况图(年月)
      SELECT SUM(f_Count) V_COUNT
      ,n_PatentType  V_n_PatentType
      INTO #Ta
      FROM dbo.T_PatentChartBaseData  WITH(NOLOCK)
      WHERE n_PatentStatus=@n_PatentStatus 
        AND n_ApplicanterType=@n_ApplicanterType
        AND (YEAR(@d_StartDate)<n_PatentYear OR (YEAR(@d_StartDate)=n_PatentYear AND MONTH(@d_StartDate)<=n_PatentMonth))
	      AND (YEAR(@d_EndDate)>n_PatentYear OR (YEAR(@d_EndDate)=n_PatentYear AND MONTH(@d_EndDate)>=n_PatentMonth))
      GROUP BY n_PatentType
 
      SELECT   
            BL=  CASE WHEN (SELECT SUM(#Ta.V_COUNT) From #Ta )=0 THEN 0 ELSE 
            T.V_COUNT
            *1.0/(SELECT SUM(#Ta.V_COUNT) From #Ta )
            END
              ,T.V_COUNT n_Count
              ,T.V_n_PatentType n_PatentType
      FROM 
      #Ta T
    
      DROP TABLE #Ta
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@n_ApplicanterType" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadDataGQY_ZLSQ_SQZKT" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --广东省各区域专利申请受理（/授权）状况图(年月)
      SELECT ISNULL(SUM(f_Count),0) V_COUNT
        ,n_PatentType  V_n_PatentType
        ,n_AreaType V_n_AreaType
      INTO #Ta
      FROM dbo.T_PatentChartBaseData WITH(NOLOCK)
      WHERE n_PatentStatus=@n_PatentStatus 
        AND (YEAR(@d_StartDate)<n_PatentYear OR (YEAR(@d_StartDate)=n_PatentYear AND MONTH(@d_StartDate)<=n_PatentMonth))
	      AND (YEAR(@d_EndDate)>n_PatentYear OR (YEAR(@d_EndDate)=n_PatentYear AND MONTH(@d_EndDate)>=n_PatentMonth))
      GROUP BY n_AreaType,n_PatentType
 
      SELECT   
          BL=  CASE WHEN (SELECT SUM(#Ta.V_COUNT) From #Ta )=0 THEN 0 ELSE 
            T.V_COUNT*100.0/(SELECT SUM(#Ta.V_COUNT) From #Ta  WHERE #Ta.V_n_PatentType=T.V_n_PatentType) 
            END
          ,T.V_COUNT n_Count
          ,T.V_n_PatentType n_PatentType
          ,T.V_n_AreaType n_AreaType
      FROM 
      #Ta T
        
      DROP TABLE #Ta
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东混合-->

  <!--广东有效发明-->
  <dataCommand name="loadDataYXFM_ZLRLXZKT" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --有效发明申请人类型比例图
      -- 数据来源： GDPAPatentChartApplyTypeData
      -- 关键参数： n_ProvinceCode,n_PatentStatus,d_SartYear，d_EndYear，d_SartMonth，d_EndMonth
      -- 扩展参数： n_ApplicanterType，n_PatentType,n_PatentStatus
      --如果查询月份没有数据，则查最近（小于）的月份数据
  declare @U_Year int ,@U_Month int
  select  top 1 @U_Year= d_DataYear ,@U_Month=d_DataMonth  
  from  dbo.T_PatentChartApplyData P
   where
         n_ProvinceCode=@n_ProvinceCode 
         and n_PatentStatus=4
         and n_ApplySource=0 --排除PCT
         and (P.d_DataYear< @d_EndYear  or (P.d_DataYear=@d_EndYear and P.d_DataMonth<=@d_EndMonth))
        order by P.d_DataYear desc,P.d_DataMonth desc
        
 --有效发明申请人类型比例图
      -- 数据来源： GDPAPatentChartApplyTypeData
      -- 关键参数： n_ProvinceCode,n_PatentStatus,d_SartYear，d_EndYear，d_SartMonth，d_EndMonth
      -- 扩展参数： n_ApplicanterType，n_PatentType,n_PatentStatus
      SELECT 
      SUM(f_Count) n_Count
      ,n_ApplicanterType
      FROM dbo.T_PatentChartApplyData WITH(NOLOCK)
      WHERE n_PatentStatus=@n_PatentStatus
      AND n_ProvinceCode=@n_ProvinceCode 
      AND  (@U_Year=d_DataYear AND @U_Month=d_DataMonth ) 
      GROUP BY [n_ApplicanterType]            
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartYear" dbType="Int32" direction="Input"/>
      <param name="@d_StartMonth" dbType="Int32" direction="Input"/>
      <param name="@d_EndYear" dbType="Int32" direction="Input"/>
      <param name="@d_EndMonth" dbType="Int32" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadDataYXFM_WCNXZKT" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --有效发明维持年限
      -- 数据来源： GDPAT_PatentChartEffectiveData
      -- 关键参数： n_ProvinceCode,d_SartYear，d_EndYear
      SELECT ISNULL(SUM(n_ApplicanterType_DZYX),0) n_Count_DZYX
          ,ISNULL(SUM(n_ApplicanterType_KYJG),0) n_Count_KYJG
          ,ISNULL(SUM(n_ApplicanterType_QY),0) n_Count_QY
          ,ISNULL(SUM(n_ApplicanterType_JGTT),0) n_Count_JGTT
          ,ISNULL(SUM(n_ApplicanterType_GR),0) n_Count_GR
          ,n_EffectiveDataType
          ,d_CalculateYear
      FROM  dbo.T_PatentChartEffectiveData  WITH(NOLOCK)
      WHERE d_CalculateYear>=@d_StartYear 
        AND d_CalculateYear<= @d_EndYear 
        AND n_ProvinceCode =@n_ProvinceCode 
      GROUP BY d_CalculateYear ,n_EffectiveDataType
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartYear" dbType="Int32" direction="Input"/>
      <param name="@d_EndYear" dbType="Int32" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadEffectivePatentLife" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --有效发明维持年限
          --
          DECLARE @ValidYear int =1;
          DECLARE @T_ValidYear TABLE(Col1 INT NULL,Num INT NULL)

          WHILE(@ValidYear<=20)
          BEGIN   
          INSERT INTO @T_ValidYear VALUES
          (
	          @ValidYear,
	          (
		          SELECT COUNT(0) FROM T_PatentCase TCase LEFT JOIN T_PatentStatus TStatus ON TCase.Application_NO=TStatus.s_ApplicationNO
		          WHERE  
		          TStatus.dt_AuthorizeDate IS NOT NULL
		          AND TCase.dt_ValidDate<@endDate
		          AND
		          (
					      ( n_InvalidTF=0 AND (YEAR(TCase.dt_InvalidDate)-YEAR(TStatus.dt_ApplyDate))=@ValidYear)
					      OR
					      (n_InvalidTF=1 AND (YEAR(@endDate)-YEAR(TStatus.dt_ApplyDate))=@ValidYear)		        
		          )
	          )
          )
          SET @ValidYear=@ValidYear+1
          END
  
          SELECT Col1,Num FROM @T_ValidYear
      ]]>
    </commandText>
    <parameters>
      <param name="@endDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadEffectivePatentNumOverYears" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 		
              --历年有效发明状况
              --
              DECLARE @Year int =YEAR(@endDate)-1;  
              DECLARE @T_Year TABLE(Col1 INT NULL,Num INT NULL)  
        
              WHILE(((YEAR(@EndDate)-@Year)<20))
              BEGIN   
              INSERT INTO @T_Year VALUES
              (
                @Year,
                (
                    SELECT COUNT(0) FROM T_PatentCase TCase LEFT JOIN T_PatentStatus TStatus ON TCase.Application_NO=TStatus.s_ApplicationNO
                    WHERE  
		                    TStatus.dt_AuthorizeDate IS NOT NULL
		                    AND TCase.dt_ValidDate<@endDate
		                    AND
		                    (
			                    (
				                    n_InvalidTF=0
				                    AND 
				                    (
					                    YEAR(TCase.dt_InvalidDate)>YEAR(@EndDate)
					                    OR
					                    (
						                    (YEAR(TCase.dt_InvalidDate)=YEAR(@EndDate))
						                    AND
						                    (MONTH(TCase.dt_InvalidDate)>MONTH(@EndDate))
					                    )
				                    )            
				                    AND YEAR(TStatus.dt_ApplyDate)=@Year
			                    )  
			                    OR
			                    (
				                    n_InvalidTF=1 AND (YEAR(TStatus.dt_ApplyDate)=@Year)
			                    )
                    )
                )
              )

              SET @Year=@Year-1
              END

              SELECT Col1,Num FROM @T_Year ORDER BY Col1 
      ]]>
    </commandText>
    <parameters>
      <param name="@endDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadEffectivePatentNumOverApplitantType" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 		
          --有效发明申请人类型比例图
          --      
          SELECT n_ApplicanterType= s_ApplicantType,n_Count=COUNT(0) FROM T_PatentCase TCase 
          LEFT JOIN T_PatentStatus TStatus ON TCase.Application_NO=TStatus.s_ApplicationNO        
		      LEFT JOIN T_Applicants TApply ON Tcase.Application_NO=TApply.s_ApplicationNO  
              WHERE 
					  TStatus.dt_AuthorizeDate IS NOT NULL
		              AND TApply.s_ApplicantSort=3
		              AND TCase.dt_ValidDate<@endDate
		              AND
		              (
			              (
				              n_InvalidTF=0
				              AND 
				              (
					              YEAR(TCase.dt_InvalidDate)>YEAR(@EndDate)
					              OR
					              (
						              (YEAR(TCase.dt_InvalidDate)=YEAR(@EndDate))
						              AND
						              (MONTH(TCase.dt_InvalidDate)>MONTH(@EndDate))
					              )
				              )
			              )  
			              OR
			              (
				              n_InvalidTF=1 
			              )
              )
            GROUP BY s_ApplicantType
      ]]>
    </commandText>
    <parameters>
      <param name="@endDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadEffectivePatentNumOverCity" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 		
          --截止至当月底广东省各地级以上市有效发明专利情况表
          --      
            DECLARE @totalNum int;
            SELECT name=TCity.CITY_NAME,n_Count INTO #TNum FROM
            (
		            SELECT s_City,n_Count=COUNT(0) FROM T_PatentCase TCase 
		            LEFT JOIN T_PatentStatus TStatus ON TCase.Application_NO=TStatus.s_ApplicationNO        
		            LEFT JOIN T_Applicants TApply ON Tcase.Application_NO=TApply.s_ApplicationNO  
		            WHERE 
					          TStatus.dt_AuthorizeDate IS NOT NULL
					          AND TApply.s_ApplicantSort=3
					          AND TCase.dt_ValidDate<@endDate
		                AND
		                (
			                (
				                n_InvalidTF=0
				                AND 
				                (
					                YEAR(TCase.dt_InvalidDate)>YEAR(@EndDate)
					                OR
					                (
						                (YEAR(TCase.dt_InvalidDate)=YEAR(@EndDate))
						                AND
						                (MONTH(TCase.dt_InvalidDate)>MONTH(@EndDate))
					                )
				                )
			                )  
			                OR
			                (
				                n_InvalidTF=1 
			                )
		            )
		            GROUP BY s_City
            ) temp
            LEFT JOIN T_AddrCity TCity ON temp.s_City=TCity.CITY_CODE

            SELECT @totalNum=SUM(n_Count) FROM #TNum
            SELECT s_Area=name,n_No=n_Count ,s_Rate=CASE WHEN n_Count=0 THEN 0 ELSE n_Count*1.0/@totalNum END  FROM #TNum
            ORDER BY n_Count DESC
            DROP TABLE #TNum
      ]]>
    </commandText>
    <parameters>
      <param name="@endDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadEffectivePatentNumOverCityExtShunde" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 		
            --截止至当月底广东省各地级以上市（分顺德）有效发明专利情况表
            --       		
              DECLARE @totalNum int;
              --不含佛山
              SELECT name=TCity.CITY_NAME,n_Count INTO #NoFoshan FROM
              (
		              SELECT s_City,n_Count=COUNT(0) FROM T_PatentCase TCase 
		              LEFT JOIN T_PatentStatus TStatus ON TCase.Application_NO=TStatus.s_ApplicationNO        
		              LEFT JOIN T_Applicants TApply ON Tcase.Application_NO=TApply.s_ApplicationNO  
		              WHERE 
		              TStatus.dt_AuthorizeDate IS NOT NULL
		              AND TApply.s_ApplicantSort=3
		              AND TCase.dt_ValidDate<@endDate
		              AND s_City!=68
		              AND
		              (
			              (
				              n_InvalidTF=0
				              AND 
				              (
					              YEAR(TCase.dt_InvalidDate)>YEAR(@EndDate)
					              OR
					              (
						              (YEAR(TCase.dt_InvalidDate)=YEAR(@EndDate))
						              AND
						              (MONTH(TCase.dt_InvalidDate)>MONTH(@EndDate))
					              )
				              )
			              )  
			              OR
			              (
				              n_InvalidTF=1 
			              )
		              )
		              GROUP BY s_City
              ) temp
              LEFT JOIN T_AddrCity TCity ON temp.s_City=TCity.CITY_CODE
              --佛山
              SELECT s_Area,n_Count INTO #Foshan FROM
              (
		              SELECT s_Area,n_Count=COUNT(0) FROM T_PatentCase TCase 
		              LEFT JOIN T_PatentStatus TStatus ON TCase.Application_NO=TStatus.s_ApplicationNO        
		              LEFT JOIN T_Applicants TApply ON Tcase.Application_NO=TApply.s_ApplicationNO  
		              WHERE 
					        TStatus.dt_AuthorizeDate IS NOT NULL
		              AND TApply.s_ApplicantSort=3
		              AND TCase.dt_ValidDate<@endDate
		              AND s_City=68
		              AND
		              (
			              (
				              n_InvalidTF=0
				              AND 
				              (
					              YEAR(TCase.dt_InvalidDate)>YEAR(@EndDate)
					              OR
					              (
						              (YEAR(TCase.dt_InvalidDate)=YEAR(@EndDate))
						              AND
						              (MONTH(TCase.dt_InvalidDate)>MONTH(@EndDate))
					              )
				              )
			              )  
			              OR
			              (
				              n_InvalidTF=1 
			              )
		              )
		              GROUP BY s_Area
              ) temp
              LEFT JOIN T_AddrArea TArea ON temp.s_Area=TArea.AREA_CODE

              SELECT * INTO #Total FROM
              (
	              SELECT * FROM #NoFoshan
	              UNION
	              SELECT name='佛山（不含顺德）',n_Count=ISNULL(SUM(n_Count),0) FROM #Foshan WHERE s_Area!=71
	              UNION 
	              SELECT name='顺德区',n_Count=ISNULL(SUM(n_Count),0) FROM #Foshan WHERE s_Area=71
              ) TEMP

              SELECT @totalNum=SUM(n_Count) FROM #Total
              SELECT s_Area=name,n_No=n_Count ,s_Rate=CASE WHEN n_Count=0 THEN 0 ELSE n_Count*1.0/@totalNum END  FROM #Total
              WHERE n_Count !=0
              ORDER BY n_Count DESC

              DROP TABLE #NoFoshan
              DROP TABLE #Foshan
              DROP TABLE #Total
      ]]>
    </commandText>
    <parameters>
      <param name="@endDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东省PCT-->
  <dataCommand name="loadDataPCT_GJZL_SQQY_ZKT" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --广东省PCT国际专利申请区域状况图
      -- 数据来源： GDPAPatentChartApplyTypeData
      -- 关键参数： n_PatentStatus，n_ApplySource,n_ProvinceCode,d_SartYear，d_EndYear，d_SartMonth，d_EndMonth
      -- 扩展参数： n_ApplicanterType，n_PatentType
       SELECT ISNULL(SUM(f_Count),0) n_Count,n_AreaType
       from (
       select
       f_Count,
       n_AreaType=C.n_AreaType 
      FROM dbo.T_PatentChartApplyData WITH(NOLOCK)
      left join dbo.T_AddrCity C on C.CITY_CODE=T_PatentChartApplyData.[n_CityCode]
      WHERE n_ApplySource=@n_ApplySource 
      --AND n_PatentStatus =@n_PatentStatus
      AND n_ProvinceCode =@n_ProvinceCode
      AND (@d_StartYear<d_DataYear OR (@d_StartYear=d_DataYear AND @d_StartMonth<=d_DataMonth))
      AND (@d_EndYear>d_DataYear OR (@d_EndYear=d_DataYear AND @d_EndMonth>=d_DataMonth)) 
      ) T
      
      GROUP BY n_AreaType
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartYear" dbType="Int32" direction="Input"/>
      <param name="@d_StartMonth" dbType="Int32" direction="Input"/>
      <param name="@d_EndYear" dbType="Int32" direction="Input"/>
      <param name="@d_EndMonth" dbType="Int32" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@n_ApplySource" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--全国专利-->
  <dataCommand name="loadDataZLSQSLQST_Y_CN" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --全国专利申请受理（/授权） new--ok
      --全国发明专利申请受理（/授权）
      --全国实用新型专利申请受理（/授权）
      --全国外观设计专利申请受理（/授权）
      SELECT s_AreaCN
      ,n_TotalCount
      ,n_CurYearCount
      ,n_CurMonthCount
      ,n_PCount
      ,d_PCountPerMillion
      ,n_UCount
      ,n_DCount
      ,n_GRCount
      ,n_DZCount
      ,n_KYCount
      ,n_QYCount
      ,n_JGCount
      ,d_Month
      ,d_Year
      ,n_PCountZZL=
      CASE WHEN (
	      SELECT ISNULL(n_PCount,0)
		      FROM dbo.T_SIPOData p  WITH(NOLOCK)
		      WHERE p.n_Type=s.n_Type
				      AND p.d_Year=s.d_Year-1 AND p.d_Month=s.d_Month
				      AND p.s_AreaCN=s.s_AreaCN
				      AND (@d_StartYear<p.d_Year OR (@d_StartYear=p.d_Year AND @d_StartMonth<=p.d_Month))
				      AND (@d_EndYear>p.d_Year OR (@d_EndYear=p.d_Year AND @d_EndMonth>=p.d_Month))  
	
      )=0 THEN 0
      ELSE(
	      ISNULL((n_PCount-
					      (
						      SELECT ISNULL(n_PCount,0)
						      FROM dbo.T_SIPOData t  WITH(NOLOCK)
						      WHERE t.n_Type=s.n_Type
									      AND t.d_Year=s.d_Year-1 AND t.d_Month=s.d_Month
									      AND t.s_AreaCN=s.s_AreaCN  
					      )
						      )*100.0/(
						      SELECT ISNULL(n_PCount,0)
						      FROM dbo.T_SIPOData p  WITH(NOLOCK)
						      WHERE p.n_Type=s.n_Type
								      AND p.d_Year=s.d_Year-1 AND p.d_Month=s.d_Month
								      AND p.s_AreaCN=s.s_AreaCN
					      ),0)
      )END
      ,n_UCountZZL=
      CASE WHEN (
      SELECT ISNULL(n_UCount,0)
				      FROM dbo.T_SIPOData p1  WITH(NOLOCK)
				      WHERE p1.n_Type=s.n_Type
						      AND p1.d_Year=s.d_Year-1 AND p1.d_Month=s.d_Month
						      AND p1.s_AreaCN=s.s_AreaCN
					
      )=0 THEN 0
      ELSE(
                  ISNULL((n_UCount-
			      (
				      SELECT ISNULL(n_UCount,0)
				      FROM dbo.T_SIPOData t1  WITH(NOLOCK)
				      WHERE t1.n_Type=s.n_Type
							      AND t1.d_Year=s.d_Year-1 AND t1.d_Month=s.d_Month
							      AND t1.s_AreaCN=s.s_AreaCN 
			      )
				      )*100.0/(
				      SELECT ISNULL(n_UCount,0)
				      FROM dbo.T_SIPOData p1  WITH(NOLOCK)
				      WHERE p1.n_Type=s.n_Type
						      AND p1.d_Year=s.d_Year-1 AND p1.d_Month=s.d_Month
						      AND p1.s_AreaCN=s.s_AreaCN 
			      ),0)
      )END
      ,n_DCountZZL=
      CASE WHEN (
      SELECT ISNULL(n_DCount,0)
						      FROM dbo.T_SIPOData p2 WITH(NOLOCK)
						      WHERE p2.n_Type=s.n_Type
								      AND p2.d_Year=s.d_Year-1 AND p2.d_Month=s.d_Month
								      AND p2.s_AreaCN=s.s_AreaCN  
					
      )=0 THEN 0
      ELSE(
      ISNULL((n_DCount-
					      (
						      SELECT ISNULL(n_DCount,0)
						      FROM dbo.T_SIPOData t2 WITH(NOLOCK)
						      WHERE t2.n_Type=s.n_Type
									      AND t2.d_Year=s.d_Year-1 AND t2.d_Month=s.d_Month
									      AND t2.s_AreaCN=s.s_AreaCN 
					      )
						      )*100.0/(
						      SELECT ISNULL(n_DCount,0)
						      FROM dbo.T_SIPOData p2 WITH(NOLOCK)
						      WHERE p2.n_Type=s.n_Type
								      AND p2.d_Year=s.d_Year-1 AND p2.d_Month=s.d_Month
								      AND p2.s_AreaCN=s.s_AreaCN 
					      ),0) 
      )END
                         
      FROM 
      dbo.T_SIPOData AS s WITH(NOLOCK)
      WHERE  n_Type=@n_PatentStatus
        AND s.s_AreaCN=@s_AreaCN 
        AND (@d_StartYear<d_Year OR (@d_StartYear=d_Year AND @d_StartMonth<=d_Month))
	      AND (@d_EndYear>d_Year OR (@d_EndYear=d_Year AND @d_EndMonth>=d_Month))  
      ORDER BY n_CurYearCount DESC
       
    ]]>
    </commandText>
    <parameters>
      <param name="@s_AreaCN" dbType="String" direction="Input"/>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartYear" dbType="Int32" direction="Input"/>
      <param name="@d_StartMonth" dbType="Int32" direction="Input"/>
      <param name="@d_EndYear" dbType="Int32" direction="Input"/>
      <param name="@d_EndMonth" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadDataZLSQSL_TS_CN" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --全国发明专利申请受理（授权）量图示-ok
      SELECT s_AreaCN 
        ,n_PCount
        ,n_UCount
        ,n_DCount
        ,n_TotalCount
        ,n_CurYearCount
        ,n_CurMonthCount
        ,d_Year
        ,d_Month
        ,2 ISO_CN
        ,n_PCountZZL=
      CASE WHEN (
	      SELECT ISNULL(n_PCount,0)
			      FROM dbo.T_SIPOData p WITH(NOLOCK)
			      WHERE p.n_Type=s.n_Type
					      AND p.d_Year=s.d_Year-1 AND p.d_Month=s.d_Month
					      AND p.s_AreaCN=s.s_AreaCN 
					   
      )=0 
      THEN 0
      ELSE
      (
      ISNULL((n_PCount-
		      (
			      SELECT ISNULL(n_PCount,0)
			      FROM dbo.T_SIPOData t WITH(NOLOCK)
			      WHERE t.n_Type=s.n_Type
						      AND t.d_Year=s.d_Year-1 AND t.d_Month=s.d_Month
						      AND t.s_AreaCN=s.s_AreaCN 
						   
		      )
			      )*100.0/(
			      SELECT ISNULL(n_PCount,0)
			      FROM dbo.T_SIPOData p WITH(NOLOCK)
			      WHERE p.n_Type=s.n_Type
						      AND p.d_Year=s.d_Year-1 AND p.d_Month=s.d_Month
						      AND p.s_AreaCN=s.s_AreaCN 
						   
		      ),0))
		      END
          ,n_UCountZZL=
      CASE WHEN (
			      SELECT ISNULL(n_UCount,0)
			      FROM dbo.T_SIPOData v1 WITH(NOLOCK)
			      WHERE v1.n_Type=s.n_Type
					      AND v1.d_Year=s.d_Year-1 AND v1.d_Month=s.d_Month
					      AND v1.s_AreaCN=s.s_AreaCN
							   
      )=0 
      THEN 0
      ELSE
      (
	      ISNULL((n_UCount-
		      (
			      SELECT ISNULL(n_UCount,0)
			      FROM dbo.T_SIPOData u1 WITH(NOLOCK)
			      WHERE u1.n_Type=s.n_Type
					      AND u1.d_Year=s.d_Year-1 AND u1.d_Month=s.d_Month
					      AND u1.s_AreaCN=s.s_AreaCN  							   
		      )
			      )*100.0/(
			      SELECT ISNULL(n_UCount,0)
			      FROM dbo.T_SIPOData v1 WITH(NOLOCK)
			      WHERE v1.n_Type=s.n_Type
						      AND v1.d_Year=s.d_Year-1 AND v1.d_Month=s.d_Month
						      AND v1.s_AreaCN=s.s_AreaCN 
						   
		      ),0))
		      END
          ,n_DCountZZL=
      CASE WHEN (
		      SELECT ISNULL(n_DCount,0)
			      FROM dbo.T_SIPOData v2 WITH(NOLOCK)
			      WHERE v2.n_Type=s.n_Type
						      AND v2.d_Year=s.d_Year-1 AND v2.d_Month=s.d_Month
						      AND v2.s_AreaCN=s.s_AreaCN 
						   
      )=0 
      THEN 0
      ELSE
      (
	      ISNULL((n_DCount-
		      (
			      SELECT ISNULL(n_DCount,0)
			      FROM dbo.T_SIPOData u2 WITH(NOLOCK)
			      WHERE u2.n_Type=s.n_Type
						      AND u2.d_Year=s.d_Year-1 AND u2.d_Month=s.d_Month
						      AND u2.s_AreaCN=s.s_AreaCN
						   
		      )
			      )*100.0/(
			      SELECT ISNULL(n_DCount,0)
			      FROM dbo.T_SIPOData v2 WITH(NOLOCK)
			      WHERE v2.n_Type=s.n_Type
						      AND v2.d_Year=s.d_Year-1 AND v2.d_Month=s.d_Month
						      AND v2.s_AreaCN=s.s_AreaCN
						   
		      ),0))
		      END
          ,n_YearCountZZL=
      CASE WHEN (
		      SELECT ISNULL(n_CurYearCount,0)
			      FROM dbo.T_SIPOData v3 WITH(NOLOCK)
			      WHERE v3.n_Type=s.n_Type
						      AND v3.d_Year=s.d_Year-1 AND v3.d_Month=s.d_Month
						      AND v3.s_AreaCN=s.s_AreaCN 
						   
      )=0 
      THEN 0
      ELSE
      (	
	      ISNULL((n_CurYearCount-
		      (
			      SELECT ISNULL(n_CurYearCount,0)
			      FROM dbo.T_SIPOData u3 WITH(NOLOCK)
			      WHERE u3.n_Type=s.n_Type
						      AND u3.d_Year=s.d_Year-1 AND u3.d_Month=s.d_Month
						      AND u3.s_AreaCN=s.s_AreaCN 
						   
		      )
			      )*100.0/(
			      SELECT ISNULL(n_CurYearCount,0)
			      FROM dbo.T_SIPOData v3 WITH(NOLOCK)
			      WHERE v3.n_Type=s.n_Type
						      AND v3.d_Year=s.d_Year-1 AND v3.d_Month=s.d_Month
						      AND v3.s_AreaCN=s.s_AreaCN
						   
		      ),0))
		      END
      FROM 
      dbo.T_SIPOData AS s WITH(NOLOCK)
      WHERE n_Type=@n_PctCode
          AND (@d_StartYear<d_Year OR (@d_StartYear=d_Year AND @d_StartMonth<=d_Month))
	        AND (@d_EndYear>d_Year OR (@d_EndYear=d_Year AND @d_EndMonth>=d_Month))  
          AND s_AreaCN=@s_AreaCN
      UNION
      SELECT s_AreaCN 
        ,n_PCount
        ,n_UCount
        ,n_DCount
        ,n_TotalCount
        ,n_CurYearCount
        ,n_CurMonthCount
        ,d_Year
        ,d_Month
        ,1 ISO_CN
        ,n_PCountZZL=
      CASE WHEN (
	      SELECT ISNULL(n_PCount,0)
			      FROM dbo.T_SIPOData p WITH(NOLOCK)
			      WHERE p.n_Type=s.n_Type
					      AND p.d_Year=s.d_Year-1 AND p.d_Month=s.d_Month
					      AND p.s_AreaCN=s.s_AreaCN 
					   
      )=0 
      THEN 0
      ELSE
      (
      ISNULL((n_PCount-
		      (
			      SELECT ISNULL(n_PCount,0)
			      FROM dbo.T_SIPOData t WITH(NOLOCK)
			      WHERE t.n_Type=s.n_Type
						      AND t.d_Year=s.d_Year-1 AND t.d_Month=s.d_Month
						      AND t.s_AreaCN=s.s_AreaCN  
						   
		      )
			      )*100.0/(
			      SELECT ISNULL(n_PCount,0)
			      FROM dbo.T_SIPOData p WITH(NOLOCK)
			      WHERE p.n_Type=s.n_Type
						      AND p.d_Year=s.d_Year-1 AND p.d_Month=s.d_Month
						      AND p.s_AreaCN=s.s_AreaCN
						   
		      ),0))
		      END
          ,n_UCountZZL=
      CASE WHEN (
			      SELECT ISNULL(n_UCount,0)
			      FROM dbo.T_SIPOData v1 WITH(NOLOCK)
			      WHERE v1.n_Type=s.n_Type
					      AND v1.d_Year=s.d_Year-1 AND v1.d_Month=s.d_Month
					      AND v1.s_AreaCN=s.s_AreaCN 
							   
      )=0 
      THEN 0
      ELSE
      (
	      ISNULL((n_UCount-
		      (
			      SELECT ISNULL(n_UCount,0)
			      FROM dbo.T_SIPOData u1 WITH(NOLOCK)
			      WHERE u1.n_Type=s.n_Type
					      AND u1.d_Year=s.d_Year-1 AND u1.d_Month=s.d_Month
					      AND u1.s_AreaCN=s.s_AreaCN 							   
		      )
			      )*100.0/(
			      SELECT ISNULL(n_UCount,0)
			      FROM dbo.T_SIPOData v1 WITH(NOLOCK)
			      WHERE v1.n_Type=s.n_Type
						      AND v1.d_Year=s.d_Year-1 AND v1.d_Month=s.d_Month
						      AND v1.s_AreaCN=s.s_AreaCN 
						   
		      ),0))
		      END
          ,n_DCountZZL=
      CASE WHEN (
		      SELECT ISNULL(n_DCount,0)
			      FROM dbo.T_SIPOData v2 WITH(NOLOCK)
			      WHERE v2.n_Type=s.n_Type
						      AND v2.d_Year=s.d_Year-1 AND v2.d_Month=s.d_Month
						      AND v2.s_AreaCN=s.s_AreaCN 
						   
      )=0 
      THEN 0
      ELSE
      (
	      ISNULL((n_DCount-
		      (
			      SELECT ISNULL(n_DCount,0)
			      FROM dbo.T_SIPOData u2 WITH(NOLOCK)
			      WHERE u2.n_Type=s.n_Type
						      AND u2.d_Year=s.d_Year-1 AND u2.d_Month=s.d_Month
						      AND u2.s_AreaCN=s.s_AreaCN
						   
		      )
			      )*100.0/(
			      SELECT ISNULL(n_DCount,0)
			      FROM dbo.T_SIPOData v2 WITH(NOLOCK)
			      WHERE v2.n_Type=s.n_Type
						      AND v2.d_Year=s.d_Year-1 AND v2.d_Month=s.d_Month
						      AND v2.s_AreaCN=s.s_AreaCN 
						   
		      ),0))
		      END
          ,n_YearCountZZL=
      CASE WHEN (
		      SELECT ISNULL(n_CurYearCount,0)
			      FROM dbo.T_SIPOData v3 WITH(NOLOCK)
			      WHERE v3.n_Type=s.n_Type
						      AND v3.d_Year=s.d_Year-1 AND v3.d_Month=s.d_Month
						      AND v3.s_AreaCN=s.s_AreaCN
						   
      )=0 
      THEN 0
      ELSE
      (	
	      ISNULL((n_CurYearCount-
		      (
			      SELECT ISNULL(n_CurYearCount,0)
			      FROM dbo.T_SIPOData u3 WITH(NOLOCK)
			      WHERE u3.n_Type=s.n_Type
						      AND u3.d_Year=s.d_Year-1 AND u3.d_Month=s.d_Month
						      AND u3.s_AreaCN=s.s_AreaCN
						   
		      )
			      )*100.0/(
			      SELECT ISNULL(n_CurYearCount,0)
			      FROM dbo.T_SIPOData v3 WITH(NOLOCK)
			      WHERE v3.n_Type=s.n_Type
						      AND v3.d_Year=s.d_Year-1 AND v3.d_Month=s.d_Month
						      AND v3.s_AreaCN=s.s_AreaCN 
						   
		      ),0))
		      END
      FROM 
      dbo.T_SIPOData AS s WITH(NOLOCK)
      WHERE n_Type=@n_OtherCode
	      AND (@d_StartYear<d_Year OR (@d_StartYear=d_Year AND @d_StartMonth<=d_Month))
	      AND (@d_EndYear>d_Year OR (@d_EndYear=d_Year AND @d_EndMonth>=d_Month))  
          AND s_AreaCN=@s_AreaCN
      UNION
      SELECT s_AreaCN 
        ,n_PCount
        ,n_UCount
        ,n_DCount
        ,n_TotalCount
        ,n_CurYearCount
        ,n_CurMonthCount
        ,d_Year
        ,d_Month
        ,0 ISO_CN
        ,n_PCountZZL=
      CASE WHEN (
	      SELECT ISNULL(n_PCount,0)
			      FROM dbo.T_SIPOData p WITH(NOLOCK)
			      WHERE p.n_Type=s.n_Type
					      AND p.d_Year=s.d_Year-1 AND p.d_Month=s.d_Month
					      AND p.s_AreaCN=s.s_AreaCN
					   
      )=0 
      THEN 0
      ELSE
      (
      ISNULL((n_PCount-
		      (
			      SELECT ISNULL(n_PCount,0)
			      FROM dbo.T_SIPOData t WITH(NOLOCK)
			      WHERE t.n_Type=s.n_Type
						      AND t.d_Year=s.d_Year-1 AND t.d_Month=s.d_Month
						      AND t.s_AreaCN=s.s_AreaCN 
						   
		      )
			      )*100.0/(
			      SELECT ISNULL(n_PCount,0)
			      FROM dbo.T_SIPOData p WITH(NOLOCK)
			      WHERE p.n_Type=s.n_Type
						      AND p.d_Year=s.d_Year-1 AND p.d_Month=s.d_Month
						      AND p.s_AreaCN=s.s_AreaCN
						   
		      ),0))
		      END
          ,n_UCountZZL=
      CASE WHEN (
			      SELECT ISNULL(n_UCount,0)
			      FROM dbo.T_SIPOData v1 WITH(NOLOCK)
			      WHERE v1.n_Type=s.n_Type
					      AND v1.d_Year=s.d_Year-1 AND v1.d_Month=s.d_Month
					      AND v1.s_AreaCN=s.s_AreaCN
							   
      )=0 
      THEN 0
      ELSE
      (
	      ISNULL((n_UCount-
		      (
			      SELECT ISNULL(n_UCount,0)
			      FROM dbo.T_SIPOData u1 WITH(NOLOCK)
			      WHERE u1.n_Type=s.n_Type
					      AND u1.d_Year=s.d_Year-1 AND u1.d_Month=s.d_Month
					      AND u1.s_AreaCN=s.s_AreaCN							   
		      )
			      )*100.0/(
			      SELECT ISNULL(n_UCount,0)
			      FROM dbo.T_SIPOData v1 WITH(NOLOCK)
			      WHERE v1.n_Type=s.n_Type
						      AND v1.d_Year=s.d_Year-1 AND v1.d_Month=s.d_Month
						      AND v1.s_AreaCN=s.s_AreaCN  
						   
		      ),0))
		      END
          ,n_DCountZZL=
      CASE WHEN (
		      SELECT ISNULL(n_DCount,0)
			      FROM dbo.T_SIPOData v2 WITH(NOLOCK)
			      WHERE v2.n_Type=s.n_Type
						      AND v2.d_Year=s.d_Year-1 AND v2.d_Month=s.d_Month
						      AND v2.s_AreaCN=s.s_AreaCN 
						   
      )=0 
      THEN 0
      ELSE
      (
	      ISNULL((n_DCount-
		      (
			      SELECT ISNULL(n_DCount,0)
			      FROM dbo.T_SIPOData u2 WITH(NOLOCK)
			      WHERE u2.n_Type=s.n_Type
						      AND u2.d_Year=s.d_Year-1 AND u2.d_Month=s.d_Month
						      AND u2.s_AreaCN=s.s_AreaCN  
						   
		      )
			      )*100.0/(
			      SELECT ISNULL(n_DCount,0)
			      FROM dbo.T_SIPOData v2 WITH(NOLOCK)
			      WHERE v2.n_Type=s.n_Type
						      AND v2.d_Year=s.d_Year-1 AND v2.d_Month=s.d_Month
						      AND v2.s_AreaCN=s.s_AreaCN
						   
		      ),0))
		      END
          ,n_YearCountZZL=
      CASE WHEN (
		      SELECT ISNULL(n_CurYearCount,0)
			      FROM dbo.T_SIPOData v3 WITH(NOLOCK)
			      WHERE v3.n_Type=s.n_Type
						      AND v3.d_Year=s.d_Year-1 AND v3.d_Month=s.d_Month
						      AND v3.s_AreaCN=s.s_AreaCN 
						   
      )=0 
      THEN 0
      ELSE
      (	
	      ISNULL((n_CurYearCount-
		      (
			      SELECT ISNULL(n_CurYearCount,0)
			      FROM dbo.T_SIPOData u3 WITH(NOLOCK)
			      WHERE u3.n_Type=s.n_Type
						      AND u3.d_Year=s.d_Year-1 AND u3.d_Month=s.d_Month
						      AND u3.s_AreaCN=s.s_AreaCN 
						   
		      )
			      )*100.0/(
			      SELECT ISNULL(n_CurYearCount,0)
			      FROM dbo.T_SIPOData v3 WITH(NOLOCK)
			      WHERE v3.n_Type=s.n_Type
						      AND v3.d_Year=s.d_Year-1 AND v3.d_Month=s.d_Month
						      AND v3.s_AreaCN=s.s_AreaCN
						   
		      ),0))
		      END
      FROM 
      dbo.T_SIPOData AS s WITH(NOLOCK)
      WHERE 
          (n_Type=@n_OtherCode or n_Type=@n_PctCode) 
          AND (@d_StartYear<d_Year OR (@d_StartYear=d_Year AND @d_StartMonth<=d_Month))
          AND (@d_EndYear>d_Year OR (@d_EndYear=d_Year AND @d_EndMonth>=d_Month))  
          AND s_AreaCN=@s_AreaCN        
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PctCode" dbType="Int32" direction="Input"/>
      <param name="@n_OtherCode" dbType="Int32" direction="Input"/>
      <param name="@s_AreaCN" dbType="String" direction="Input"/>
      <param name="@d_StartYear" dbType="Int32" direction="Input"/>
      <param name="@d_StartMonth" dbType="Int32" direction="Input"/>
      <param name="@d_EndYear" dbType="Int32" direction="Input"/>
      <param name="@d_EndMonth" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadDataCity_SZZLLXSQ_BLT_CN" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --全国部分省市专利申请受理(授权)中三种类型专利比例图-ok
      SELECT 
        s_AreaCN
        ,d_Year
        ,d_Month
        ,n_Type
        ,n_CurMonthCount
        ,n_PCount
        ,n_UCount
        ,n_DCount
      FROM dbo.T_SIPOData  WITH(NOLOCK)
      WHERE  n_Type=@n_PatentStatus
          AND (@d_StartYear<d_Year OR (@d_StartYear=d_Year AND @d_StartMonth<=d_Month))
	        AND (@d_EndYear>d_Year OR (@d_EndYear=d_Year AND @d_EndMonth>=d_Month))  
          AND s_AreaCN IN(@City1,@City2,@City3,@City4,@City5,@City6,@City7,@City8,@City9,@City0)
        
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@CityWhere" dbType="String" direction="Input"/>
      <param name="@City0" dbType="String" direction="Input"/>
      <param name="@City1" dbType="String" direction="Input"/>
      <param name="@City2" dbType="String" direction="Input"/>
      <param name="@City3" dbType="String" direction="Input"/>
      <param name="@City4" dbType="String" direction="Input"/>
      <param name="@City5" dbType="String" direction="Input"/>
      <param name="@City6" dbType="String" direction="Input"/>
      <param name="@City7" dbType="String" direction="Input"/>
      <param name="@City8" dbType="String" direction="Input"/>
      <param name="@City9" dbType="String" direction="Input"/>
      <param name="@d_StartYear" dbType="Int32" direction="Input"/>
      <param name="@d_StartMonth" dbType="Int32" direction="Input"/>
      <param name="@d_EndYear" dbType="Int32" direction="Input"/>
      <param name="@d_EndMonth" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadData_MWRK_3ZZLLX_SQ_Table_CN" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --全国部分省市万人口专利申请受理(授权)数量(不含广东)-ok
      SELECT 
        a.s_AreaCN
        ,ISNULL(a.n_CurYearCount,0) a_YearhCount
        ,ISNULL(a.d_PCountPerMillion,0) a_PCountPerMillion
        ,ISNULL(a.n_PCount,0) a_PCount
        ,ISNULL(a.n_PersonCount,0) a_PersonCount
        ,ISNULL(b.n_CurYearCount,0) b_YearhCount
        ,ISNULL(b.n_PCount,0) b_PCount
        ,a_b_PCount_Person=CASE WHEN ISNULL(a.n_PersonCount,0)=0 THEN 0 ELSE((a.n_PCount+b.n_PCount)*1.0/(a.n_PersonCount))END 
      FROM dbo.T_SIPOData a WITH(NOLOCK)
      LEFT JOIN
      dbo.T_SIPOData b WITH(NOLOCK)
      ON a.d_Month=b.d_Month
      AND a.d_Year=b.d_Year
      AND a.s_AreaCN=b.s_AreaCN
      AND a.n_Type=1
      AND b.n_Type=3
      AND (@d_StartYear<a.d_Year OR (@d_StartYear=a.d_Year AND @d_StartMonth<=a.d_Month))
      AND (@d_EndYear>a.d_Year OR (@d_EndYear=a.d_Year AND @d_EndMonth>=a.d_Month))  
        
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartYear" dbType="Int32" direction="Input"/>
      <param name="@d_StartMonth" dbType="Int32" direction="Input"/>
      <param name="@d_EndYear" dbType="Int32" direction="Input"/>
      <param name="@d_EndMonth" dbType="Int32" direction="Input"/>
      <!--<param name="@City0" dbType="String" direction="Input"/>
      <param name="@City1" dbType="String" direction="Input"/>
      <param name="@City2" dbType="String" direction="Input"/>
      <param name="@City3" dbType="String" direction="Input"/>
      <param name="@City4" dbType="String" direction="Input"/>
      <param name="@City5" dbType="String" direction="Input"/>
      <param name="@City6" dbType="String" direction="Input"/>
      <param name="@City7" dbType="String" direction="Input"/>
      <param name="@City8" dbType="String" direction="Input"/>
      <param name="@City9" dbType="String" direction="Input"/>-->
    </parameters>
  </dataCommand>
  <dataCommand name="loadData_MWRK_3ZZLLX_SQ_Table_CN_GD" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        --全国部分省市万人口专利申请受理(授权)数量(含广东)-ok
        --广东
        SELECT a.s_AreaCN 
			    ,ISNULL(d_PCountPerMillion,0) d_PCountPerMillion
			    ,n_PersonCount--=CASE WHEN(d_PCountPerMillion)=0 THEN 0 ELSE ((n_PCount*1.0/d_PCountPerMillion)) END
              INTO #P
              FROM dbo.T_SIPOData a WITH(NOLOCK) WHERE (1=1)
	            AND a.n_Type=@n_PatentStatus2
	            AND (@d_EndYear=a.d_Year AND @d_EndMonth=a.d_Month)
		         
         SELECT a.s_AreaCN
                ,SUM(a.n_PCount) a_PCountSUM
                ,a_PCount=
				    CASE WHEN (ISNULL((SELECT n_PersonCount FROM #P p WHERE p.s_AreaCN=a.s_AreaCN),0))=0 THEN 0 
				    ELSE (SUM(a.n_PCount)*1.0/ISNULL((SELECT n_PersonCount FROM #P p WHERE p.s_AreaCN=a.s_AreaCN),0))END 
                ,1 n_DataType
              INTO #G1
              FROM dbo.T_SIPOData a WITH(NOLOCK) WHERE (1=1)
	            AND a.n_Type=@n_PatentStatus1
	            AND (@d_StartYear<a.d_Year OR (@d_StartYear=a.d_Year AND @d_StartMonth<=a.d_Month))
	            AND (@d_EndYear>a.d_Year OR (@d_EndYear=a.d_Year AND @d_EndMonth>=a.d_Month))
	            AND a.n_ProvinceCode=@n_ProvinceCode
	          GROUP BY a.s_AreaCN
	      
         SELECT a.s_AreaCN
                ,SUM(a.n_PCount) b_PCountSUM
                ,b_PCount=
				    CASE WHEN (ISNULL((SELECT n_PersonCount FROM #P p WHERE p.s_AreaCN=a.s_AreaCN),0))=0 THEN 0 
				    ELSE (SUM(a.n_PCount)*1.0/ISNULL((SELECT n_PersonCount FROM #P p WHERE p.s_AreaCN=a.s_AreaCN),0))END 
                ,1 n_DataType
              INTO #G3
              FROM dbo.T_SIPOData a WITH(NOLOCK) WHERE (1=1)
	            AND a.n_Type=@n_PatentStatus3
	            AND (@d_StartYear<a.d_Year OR (@d_StartYear=a.d_Year AND @d_StartMonth<=a.d_Month))
	            AND (@d_EndYear>a.d_Year OR (@d_EndYear=a.d_Year AND @d_EndMonth>=a.d_Month))
	            AND a.n_ProvinceCode=@n_ProvinceCode
	          GROUP BY a.s_AreaCN
	       --省份
	         SELECT a.s_AreaCN
                ,SUM(a.n_PCount) a_PCountSUM
                ,a_PCount=
				    CASE WHEN (ISNULL((SELECT n_PersonCount FROM #P p WHERE p.s_AreaCN=a.s_AreaCN),0))=0 THEN 0 
				    ELSE (SUM(a.n_PCount)*1.0/ISNULL((SELECT n_PersonCount FROM #P p WHERE p.s_AreaCN=a.s_AreaCN),0))END 
                ,0 n_DataType
              INTO #G21
              FROM dbo.T_SIPOData a WITH(NOLOCK) WHERE (1=1)
	            AND a.n_Type=@n_PatentStatus1
	            AND (@d_StartYear<a.d_Year OR (@d_StartYear=a.d_Year AND @d_StartMonth<=a.d_Month))
	            AND (@d_EndYear>a.d_Year OR (@d_EndYear=a.d_Year AND @d_EndMonth>=a.d_Month))
	            AND a.n_ProvinceCode=0
	          GROUP BY a.s_AreaCN   
	      
	          SELECT a.s_AreaCN
                ,SUM(a.n_PCount) b_PCountSUM
                ,b_PCount=
				    CASE WHEN (ISNULL((SELECT n_PersonCount FROM #P p WHERE p.s_AreaCN=a.s_AreaCN),0))=0 THEN 0 
				    ELSE (SUM(a.n_PCount)*1.0/ISNULL((SELECT n_PersonCount FROM #P p WHERE p.s_AreaCN=a.s_AreaCN),0))END 
                ,0 n_DataType
              INTO #G23
              FROM dbo.T_SIPOData a WITH(NOLOCK) WHERE (1=1)
	            AND a.n_Type=@n_PatentStatus3
	            AND (@d_StartYear<a.d_Year OR (@d_StartYear=a.d_Year AND @d_StartMonth<=a.d_Month))
	            AND (@d_EndYear>a.d_Year OR (@d_EndYear=a.d_Year AND @d_EndMonth>=a.d_Month))
	            AND a.n_ProvinceCode=0
	          GROUP BY a.s_AreaCN    
             --直辖市
             	         SELECT a.s_AreaCN
                ,SUM(a.n_PCount) a_PCountSUM
                ,a_PCount=
				    CASE WHEN (ISNULL((SELECT n_PersonCount FROM #P p WHERE p.s_AreaCN=a.s_AreaCN),0))=0 THEN 0 
				    ELSE (SUM(a.n_PCount)*1.0/ISNULL((SELECT n_PersonCount FROM #P p WHERE p.s_AreaCN=a.s_AreaCN),0))END 
                ,2 n_DataType
              INTO #Z1
              FROM dbo.T_SIPOData a WITH(NOLOCK) WHERE (1=1)
	            AND a.n_Type=@n_PatentStatus1
	            AND (@d_StartYear<a.d_Year OR (@d_StartYear=a.d_Year AND @d_StartMonth<=a.d_Month))
	            AND (@d_EndYear>a.d_Year OR (@d_EndYear=a.d_Year AND @d_EndMonth>=a.d_Month))
	            AND a.n_ProvinceCode<>0 AND a.n_ProvinceCode<>@n_ProvinceCode
	          GROUP BY a.s_AreaCN   
	      
	          SELECT a.s_AreaCN
                ,SUM(a.n_PCount) b_PCountSUM
                ,b_PCount=
				    CASE WHEN (ISNULL((SELECT n_PersonCount FROM #P p WHERE p.s_AreaCN=a.s_AreaCN),0))=0 THEN 0 
				    ELSE (SUM(a.n_PCount)*1.0/ISNULL((SELECT n_PersonCount FROM #P p WHERE p.s_AreaCN=a.s_AreaCN),0))END 
                ,2 n_DataType
              INTO #Z3
              FROM dbo.T_SIPOData a WITH(NOLOCK) WHERE (1=1)
	            AND a.n_Type=@n_PatentStatus3
	            AND (@d_StartYear<a.d_Year OR (@d_StartYear=a.d_Year AND @d_StartMonth<=a.d_Month))
	            AND (@d_EndYear>a.d_Year OR (@d_EndYear=a.d_Year AND @d_EndMonth>=a.d_Month))
	            AND a.n_ProvinceCode<>0 AND a.n_ProvinceCode<>@n_ProvinceCode
	          GROUP BY a.s_AreaCN  
             
		     SELECT 
		          g1.n_DataType
			      ,g1.s_AreaCN
			      ,a_PersonCount=(SELECT n_PersonCount FROM #P p WHERE p.s_AreaCN=g1.s_AreaCN)
			      ,a_PCount
			      ,b_PCount
			      ,d_PCountPerMillion=(SELECT d_PCountPerMillion FROM #P p WHERE p.s_AreaCN=g1.s_AreaCN)
		     FROM #G1 g1
		     LEFT JOIN #G3 g3
		     ON g1.s_AreaCN=g3.s_AreaCN
		     UNION ALL
		     SELECT 
			      g21.n_DataType
			      ,g21.s_AreaCN
			      ,a_PersonCount=(SELECT n_PersonCount FROM #P p WHERE p.s_AreaCN=g21.s_AreaCN)
			      ,a_PCount
			      ,b_PCount
			      ,d_PCountPerMillion=(SELECT d_PCountPerMillion FROM #P p WHERE p.s_AreaCN=g21.s_AreaCN) 
		     FROM #G21 g21
		     LEFT JOIN #G23 g23
		     ON g21.s_AreaCN=g23.s_AreaCN
	         UNION ALL
	         SELECT * FROM
		     (SELECT 
		          n_DataType=3
			      ,g1.s_AreaCN
			      ,a_PersonCount=(SELECT n_PersonCount FROM #P p WHERE p.s_AreaCN=g1.s_AreaCN)
			      ,a_PCount
			      ,b_PCount
			      ,d_PCountPerMillion=(SELECT d_PCountPerMillion FROM #P p WHERE p.s_AreaCN=g1.s_AreaCN)
		     FROM #Z1 g1
		     LEFT JOIN #Z3 g3
		     ON g1.s_AreaCN=g3.s_AreaCN) g
		     WHERE g.s_AreaCN IN ('北京','上海','天津','重庆')
	         UNION ALL
		      SELECT * FROM
		     (SELECT 
		          n_DataType=4
			      ,g1.s_AreaCN
			      ,a_PersonCount=(SELECT n_PersonCount FROM #P p WHERE p.s_AreaCN=g1.s_AreaCN)
			      ,a_PCount
			      ,b_PCount
			      ,d_PCountPerMillion=(SELECT d_PCountPerMillion FROM #P p WHERE p.s_AreaCN=g1.s_AreaCN)
		     FROM #Z1 g1
		     LEFT JOIN #Z3 g3
		     ON g1.s_AreaCN=g3.s_AreaCN) g
		     WHERE g.s_AreaCN NOT IN ('北京','上海','天津','重庆')
		     DROP TABLE #P
		     DROP TABLE #G1
		     DROP TABLE #G3	
		     DROP TABLE #G21
		     DROP TABLE #G23
		     DROP TABLE #Z1
		     DROP TABLE #Z3
        ]]>
    </commandText>
    <parameters>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@s_ProvinceName" dbType="String" direction="Input"/>
      <param name="@n_PatentStatus1" dbType="Int32" direction="Input"/>
      <param name="@n_PatentStatus2" dbType="Int32" direction="Input"/>
      <param name="@n_PatentStatus3" dbType="Int32" direction="Input"/>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
      <param name="@d_StartYear" dbType="Int32" direction="Input"/>
      <param name="@d_StartMonth" dbType="Int32" direction="Input"/>
      <param name="@d_EndYear" dbType="Int32" direction="Input"/>
      <param name="@d_EndMonth" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadData_City_3ZZLLX_SQ_Table_CN" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --全国各地区专利申请受理(授权)结构表--ok
      --
       SELECT a.s_AreaCN 
			    ,SUM(a.n_PCount) n_PCountSUM
			    ,SUM(a.n_UCount) n_UCountSUM
			    ,SUM(a.n_DCount) n_DCountSUM
			    ,SUM(a.n_PCount+a.n_UCount+a.n_DCount) n_SUM
       INTO #G
       FROM dbo.T_SIPOData a WITH(NOLOCK) WHERE (1=1)
	        AND a.n_Type=@n_PatentStatus
	        AND (@d_StartYear<a.d_Year OR (@d_StartYear=a.d_Year AND @d_StartMonth<=a.d_Month))
	        AND (@d_EndYear>a.d_Year OR (@d_EndYear=a.d_Year AND @d_EndMonth>=a.d_Month))
	        AND a.n_ProvinceCode=0
	   GROUP BY a.s_AreaCN	
       SELECT a.s_AreaCN 
			    ,SUM(a.n_PCount) n_PCountSUM
			    ,SUM(a.n_UCount) n_UCountSUM
			    ,SUM(a.n_DCount) n_DCountSUM
			    ,SUM(a.n_PCount+a.n_UCount+a.n_DCount) n_SUM
       INTO #G2
       FROM dbo.T_SIPOData a WITH(NOLOCK) WHERE (1=1)
	        AND a.n_Type=@n_PatentStatus
	        AND (@d_StartYear<a.d_Year OR (@d_StartYear=a.d_Year AND @d_StartMonth<=a.d_Month))
	        AND (@d_EndYear>a.d_Year OR (@d_EndYear=a.d_Year AND @d_EndMonth>=a.d_Month))
	        AND a.n_ProvinceCode=@n_ProvinceCode
	   GROUP BY a.s_AreaCN	   	      
       SELECT a.s_AreaCN 
			    ,SUM(a.n_PCount) n_PCountSUM
			    ,SUM(a.n_UCount) n_UCountSUM
			    ,SUM(a.n_DCount) n_DCountSUM
			    ,SUM(a.n_PCount+a.n_UCount+a.n_DCount) n_SUM
       INTO #G3
       FROM dbo.T_SIPOData a WITH(NOLOCK) WHERE (1=1)
	        AND a.n_Type=@n_PatentStatus
	        AND (@d_StartYear<a.d_Year OR (@d_StartYear=a.d_Year AND @d_StartMonth<=a.d_Month))
	        AND (@d_EndYear>a.d_Year OR (@d_EndYear=a.d_Year AND @d_EndMonth>=a.d_Month))
	        AND a.n_ProvinceCode<>@n_ProvinceCode AND a.n_ProvinceCode<>0
	   GROUP BY a.s_AreaCN	
	   
	   SELECT 
	       n_DataType=0
	       ,g.s_AreaCN
	       ,n_PCount_BL=(CASE WHEN (g.n_SUM)=0 THEN 0 ELSE ( (g.n_PCountSUM*100.0/g.n_SUM))END)
	       ,n_UCount_BL=(CASE WHEN (g.n_SUM)=0 THEN 0 ELSE ( (g.n_UCountSUM*100.0/g.n_SUM))END)
	       ,n_DCount_BL=(CASE WHEN (g.n_SUM)=0 THEN 0 ELSE ( (g.n_DCountSUM*100.0/g.n_SUM))END)
	   FROM #G g
	   UNION ALL
	   SELECT 
	       n_DataType=1
	       ,g.s_AreaCN
	       ,n_PCount_BL=(CASE WHEN (g.n_SUM)=0 THEN 0 ELSE ( (g.n_PCountSUM*100.0/g.n_SUM))END)
	       ,n_UCount_BL=(CASE WHEN (g.n_SUM)=0 THEN 0 ELSE ( (g.n_UCountSUM*100.0/g.n_SUM))END)
	       ,n_DCount_BL=(CASE WHEN (g.n_SUM)=0 THEN 0 ELSE ( (g.n_DCountSUM*100.0/g.n_SUM))END)
	   FROM #G2 g
	   UNION ALL
	   SELECT 
	       n_DataType=3
	       ,g.s_AreaCN
	       ,n_PCount_BL=(CASE WHEN (g.n_SUM)=0 THEN 0 ELSE ( (g.n_PCountSUM*100.0/g.n_SUM))END)
	       ,n_UCount_BL=(CASE WHEN (g.n_SUM)=0 THEN 0 ELSE ( (g.n_UCountSUM*100.0/g.n_SUM))END)
	       ,n_DCount_BL=(CASE WHEN (g.n_SUM)=0 THEN 0 ELSE ( (g.n_DCountSUM*100.0/g.n_SUM))END)
	   FROM #G3 g
	   WHERE g.s_AreaCN IN ('北京','上海','天津','重庆')
	   UNION ALL
	   SELECT 
	       n_DataType=4
	       ,g.s_AreaCN
	       ,n_PCount_BL=(CASE WHEN (g.n_SUM)=0 THEN 0 ELSE ( (g.n_PCountSUM*100.0/g.n_SUM))END)
	       ,n_UCount_BL=(CASE WHEN (g.n_SUM)=0 THEN 0 ELSE ( (g.n_UCountSUM*100.0/g.n_SUM))END)
	       ,n_DCount_BL=(CASE WHEN (g.n_SUM)=0 THEN 0 ELSE ( (g.n_DCountSUM*100.0/g.n_SUM))END)
	   FROM #G3 g
	   WHERE g.s_AreaCN NOT IN ('北京','上海','天津','重庆')    
	   
	   DROP TABLE #G
	   DROP TABLE #G2
	   DROP TABLE #G3
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@d_StartYear" dbType="Int32" direction="Input"/>
      <param name="@d_StartMonth" dbType="Int32" direction="Input"/>
      <param name="@d_EndYear" dbType="Int32" direction="Input"/>
      <param name="@d_EndMonth" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>

  <dataCommand name="loadData_City_3ZZLLX_SQ_Table_PCT" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --全国各地区PCT专利申请受理(授权)结构表--ok
	        
         SELECT 
            d.s_AreaCN
            ,d.n_CurYearCount
        INTO #G
        FROM dbo.T_SIPOData d WITH(NOLOCK)
        WHERE d.n_Type=@n_PatentStatus
	        AND d_Year=@d_EndYear
	        AND d.d_Month=@d_EndMonth
	        AND d.s_AreaCN='国内合计' 

        SELECT
            n_DataType=0 
            ,s.s_AreaCN
            ,s.n_CurMonthCount
            ,s.n_CurYearCount
            ,n_Rate=
	            CASE WHEN ((SELECT d.n_CurYearCount FROM #G d WHERE d.s_AreaCN=s.s_AreaCN ))=0 THEN 0 
	            ELSE (ISNULL(((s.n_CurYearCount*100.0)/(SELECT d.n_CurYearCount FROM #G d WHERE d.s_AreaCN='国内合计') ),0)) END
        INTO #G1
        FROM dbo.T_SIPOData s WITH(NOLOCK)
        WHERE s.n_Type=@n_PatentStatus
            AND s.d_Year=@d_EndYear
            AND s.d_Month=@d_EndMonth
            AND s.s_AreaCN not in ('合计')
            AND s.n_ProvinceCode =0
        --GD
        SELECT 
            n_DataType=1 
            ,s.s_AreaCN
            ,s.n_CurMonthCount
            ,s.n_CurYearCount
            ,n_Rate=
	            CASE WHEN ((SELECT d.n_CurYearCount FROM #G d WHERE d.s_AreaCN=s.s_AreaCN ))=0 THEN 0 
	            ELSE (ISNULL(((s.n_CurYearCount*100.0)/(SELECT d.n_CurYearCount FROM #G d WHERE d.s_AreaCN='国内合计') ),0)) END
        INTO #G3
        FROM dbo.T_SIPOData s WITH(NOLOCK)
        WHERE s.n_Type=@n_PatentStatus
            AND s.d_Year=@d_EndYear
            AND s.d_Month=@d_EndMonth
            AND s.n_ProvinceCode =@n_ProvinceCode   
       --  QT     
       SELECT 
            n_DataType=2 
            ,s.s_AreaCN
            ,s.n_CurMonthCount
            ,s.n_CurYearCount
            ,n_Rate=
	            CASE WHEN ((SELECT d.n_CurYearCount FROM #G d WHERE d.s_AreaCN=s.s_AreaCN ))=0 THEN 0 
	            ELSE (ISNULL(((s.n_CurYearCount*100.0)/(SELECT d.n_CurYearCount FROM #G d WHERE d.s_AreaCN='国内合计') ),0)) END
        INTO #Z
        FROM dbo.T_SIPOData s WITH(NOLOCK)
        WHERE s.n_Type=@n_PatentStatus
            AND s.d_Year=@d_EndYear
            AND s.d_Month=@d_EndMonth
            AND s.n_ProvinceCode <>@n_ProvinceCode   	
            AND s.n_ProvinceCode <>0
            AND s.s_AreaCN not in ('合计')
        SELECT * FROM
        (    
			SELECT 
				n_DataType=0
				,g.n_CurMonthCount
				,g.n_CurYearCount
				,g.n_Rate
				,g.s_AreaCN
			FROM #G1 g
			UNION ALL
			SELECT 
				n_DataType=1
				,g.n_CurMonthCount
				,g.n_CurYearCount
				,g.n_Rate
				,g.s_AreaCN
			FROM #G3 g
			UNION ALL
			SELECT 
				n_DataType=3
				,g.n_CurMonthCount
				,g.n_CurYearCount
				,g.n_Rate
				,g.s_AreaCN
			 FROM #Z g
			 WHERE g.s_AreaCN IN ('北京','上海','天津','重庆')
			UNION ALL
			SELECT 
				n_DataType=4
				,g.n_CurMonthCount
				,g.n_CurYearCount
				,g.n_Rate
				,g.s_AreaCN
			 FROM #Z g
			 WHERE g.s_AreaCN NOT IN ('北京','上海','天津','重庆')
	         
         ) T
        ORDER BY T.n_Rate,T.n_CurYearCount DESC
        
        DROP TABLE #G1
        DROP TABLE #G
        DROP TABLE #G3
        DROP TABLE #Z
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@d_StartYear" dbType="Int32" direction="Input"/>
      <param name="@d_StartMonth" dbType="Int32" direction="Input"/>
      <param name="@d_EndYear" dbType="Int32" direction="Input"/>
      <param name="@d_EndMonth" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>

  <dataCommand name="loadDataSZZLLXSQSLZKT_CN" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --全国三种专利类型申请受理（/授权）状况图(年月)-暂未用
      SELECT 
        s_AreaCN
        ,d_Year
        ,d_Month
        ,n_Type
        ,n_CurYearCount
        ,n_CurMonthCount
        ,n_PCount
        ,n_UCount
        ,n_DCount
      FROM dbo.T_SIPOData  WITH(NOLOCK)
      WHERE  n_Type=@n_PatentStatus
          AND (@d_StartYear<d_Year OR (@d_StartYear=d_Year AND @d_StartMonth<=d_Month))
	        AND (@d_EndYear>d_Year OR (@d_EndYear=d_Year AND @d_EndMonth>=d_Month))  
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartYear" dbType="Int32" direction="Input"/>
      <param name="@d_StartMonth" dbType="Int32" direction="Input"/>
      <param name="@d_EndYear" dbType="Int32" direction="Input"/>
      <param name="@d_EndMonth" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>

  <!--全国专利 排名-->
  <dataCommand name="loadData_3SZZLLX_SQ_X_CITYLIST_CN" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --全国三种专利类型申请受理（/授权）城市列表
      SELECT 
        n_CityCode
        ,n_ProvinceCode
        ,s_CityName
      FROM dbo.T_PatentChartBaseData a  WITH(NOLOCK)
      WHERE a.n_PatentStatus=@n_PatentStatus
      AND (@d_StartYear<a.n_PatentYear OR (@d_StartYear=a.n_PatentYear AND @d_StartMonth<=a.n_PatentMonth))
      AND (@d_EndYear>a.n_PatentYear OR (@d_EndYear=a.n_PatentYear AND @d_EndMonth>=a.n_PatentMonth))
      GROUP BY a.n_ProvinceCode,a.n_CityCode,s_CityName
  
       
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
      <param name="@d_StartYear" dbType="Int32" direction="Input"/>
      <param name="@d_StartMonth" dbType="Int32" direction="Input"/>
      <param name="@d_EndYear" dbType="Int32" direction="Input"/>
      <param name="@d_EndMonth" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadData_3SZZLLX_SQ_X_CITY_TOP_CN" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --全国三种专利类型申请受理（/授权）排名数据
      SELECT 
        n_PatentStatus
        ,n_PatentType
        ,n_CityCode
        ,n_ProvinceCode
        ,s_CityName
        ,ISNULL(SUM(f_Count),0) n_Count
      
      FROM dbo.T_PatentChartBaseData a  WITH(NOLOCK)
      WHERE a.n_PatentStatus=@n_PatentStatus
      AND (@d_StartYear<a.n_PatentYear OR (@d_StartYear=a.n_PatentYear AND @d_StartMonth<=a.n_PatentMonth))
      AND (@d_EndYear>a.n_PatentYear OR (@d_EndYear=a.n_PatentYear AND @d_EndMonth>=a.n_PatentMonth))
      GROUP BY a.n_ProvinceCode,a.n_CityCode,a.n_PatentStatus,a.n_PatentType,a.f_Count,s_CityName
  
       
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
      <param name="@d_StartYear" dbType="Int32" direction="Input"/>
      <param name="@d_StartMonth" dbType="Int32" direction="Input"/>
      <param name="@d_EndYear" dbType="Int32" direction="Input"/>
      <param name="@d_EndMonth" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东省IPC分类-->
  <dataCommand name="loadDataZLSQ_IPCFLZKT" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --广东省专利申请受理IPC分类情况图
      -- 数据来源： GDPAPatentChartApplyTypeData
      -- 关键参数： n_PatentStatus，s_citycodes,d_SartYear，d_EndYear，d_SartMonth，d_EndMonth
      -- 扩展参数： n_ApplicanterType，n_PatentType
      SELECT * FROM dbo.T_PatentChartApplyData  WITH(NOLOCK)
      WHERE n_PatentStatus=@n_PatentStatus
        AND (@d_StartYear<d_DataYear OR (@d_StartYear=d_DataYear AND @d_StartMonth<=d_DataMonth))
	      AND (@d_EndYear>d_DataYear OR (@d_EndYear=d_DataYear AND @d_EndMonth>=d_DataMonth)) 
        --AND s_citycodes In (@s_citycodes)
      --GROUP BY d_StartYear,d_EndYear,n_PatentType
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@n_ApplicanterType" dbType="Int32" direction="Input"/>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
      <param name="@d_StartYear" dbType="Int32" direction="Input"/>
      <param name="@d_StartMonth" dbType="Int32" direction="Input"/>
      <param name="@d_EndYear" dbType="Int32" direction="Input"/>
      <param name="@d_EndMonth" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadDataGDS_ZLSQ_IPCFLZKT" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      --广东省各地市专利申请受理IPC分类情况图
      -- 数据来源： GDPAPatentChartApplyTypeData
      -- 关键参数： n_PatentStatus，s_citycodes,d_SartYear，d_EndYear，d_SartMonth，d_EndMonth
      -- 扩展参数： n_ApplicanterType，n_PatentType
      SELECT * FROM dbo.T_PatentChartApplyData  WITH(NOLOCK)
      WHERE n_PatentStatus=@n_PatentStatus
        AND (@d_StartYear<d_DataYear OR (@d_StartYear=d_DataYear AND @d_StartMonth<=d_DataMonth))
	      AND (@d_EndYear>d_DataYear OR (@d_EndYear=d_DataYear AND @d_EndMonth>=d_DataMonth)) 
        AND n_ProvinceCode =@n_ProvinceCode
      --GROUP BY d_StartYear,d_EndYear,n_PatentType
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@n_ApplicanterType" dbType="Int32" direction="Input"/>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
      <param name="@d_StartYear" dbType="Int32" direction="Input"/>
      <param name="@d_StartMonth" dbType="Int32" direction="Input"/>
      <param name="@d_EndYear" dbType="Int32" direction="Input"/>
      <param name="@d_EndMonth" dbType="Int32" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--代理机构-->

  <!--图end-->
  <!--表begin-->
  <dataCommand name="loadDataSZZLSQ_ListFrm_1_7" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        DECLARE @T_PatentType Table(n_PatentType int null,s_PatentTypeName varchar(100) null)

        INSERT INTO @T_PatentType(n_PatentType,s_PatentTypeName)VALUES (1, '发明')
        INSERT INTO @T_PatentType(n_PatentType,s_PatentTypeName)VALUES (2, '实用新型')
        INSERT INTO @T_PatentType(n_PatentType,s_PatentTypeName)VALUES (3, '外观设计')
 
        select 
        n_PatentType=CASE WHEN CurT.n_PatentType IS null Then LastT.n_PatentType else CurT.n_PatentType end
        ,isnull(curCount,0) as curCount
        ,isnull(lastCount,0) as lastCount
        ,Rate= case when lastCount!=0 then (isnull(curCount,0)-lastCount)*1.0/CAST(lastCount as float) else null end
        ,s_PatentTypeName
        from @T_PatentType T_P
        left join  
        (
        select 
         n_PatentType,
         SUM(f_Count) curCount
         from dbo.T_PatentChartBaseData  WITH(NOLOCK)
        where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus

        and (Year(@d_StartDate)<n_PatentYear 
             or (Year(@d_StartDate)=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
        and (Year(@d_EndDate)>n_PatentYear 
             or (Year(@d_EndDate)=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
         group by n_PatentType
         ) as CurT on T_P.n_PatentType=CurT.n_PatentType
         left join  
         (
         select 
        n_PatentType,
         SUM(f_Count) lastCount
         from dbo.T_PatentChartBaseData  WITH(NOLOCK)
        where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus

        and (Year(DATEADD(YYYY,-1,@d_StartDate))<n_PatentYear 
             or (Year(DATEADD(YYYY,-1,@d_StartDate))=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
        and (Year(DATEADD(YYYY,-1,@d_EndDate))>n_PatentYear 
             or (Year(DATEADD(YYYY,-1,@d_EndDate))=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
         group by n_PatentType
         ) as LastT on T_P.n_PatentType=LastT.n_PatentType
         ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadDataWZSQRZLSQ_ListFrm_2_4" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
       DECLARE @T_ApplicanterTyper Table(n_ApplicanterTyper int null,s_ApplicanterTyperName varchar(100) null)

      INSERT INTO @T_ApplicanterTyper(n_ApplicanterTyper,s_ApplicanterTyperName)VALUES (1, '大专院校')
      INSERT INTO @T_ApplicanterTyper(n_ApplicanterTyper,s_ApplicanterTyperName)VALUES (2, '科研机构')
      INSERT INTO @T_ApplicanterTyper(n_ApplicanterTyper,s_ApplicanterTyperName)VALUES (3, '企业')
      INSERT INTO @T_ApplicanterTyper(n_ApplicanterTyper,s_ApplicanterTyperName)VALUES (4, '机关团体')
      INSERT INTO @T_ApplicanterTyper(n_ApplicanterTyper,s_ApplicanterTyperName)VALUES (5, '个人')
      select * ,s_ApplicanterTyperName
      from @T_ApplicanterTyper  left join 
      ( select 
       n_ApplicanterType 
       ,FM = SUM(case when n_PatentType=1 then f_Count else 0 end )  
       ,SYXX = SUM(case when n_PatentType=2 then f_Count else 0 end ) 
       , WG = SUM(case when n_PatentType=3 then f_Count else 0 end ) 
       from dbo.T_PatentChartBaseData P  WITH(NOLOCK)
      where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus 
      and (Year(@d_StartDate)<n_PatentYear 
           or (Year(@d_StartDate)=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
      and (Year(@d_EndDate)>n_PatentYear 
           or (Year(@d_EndDate)=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
       group by n_ApplicanterType
       ) T on  n_ApplicanterTyper=T.n_ApplicanterType 
         ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadDataWZSQRZLSQ_ListFrm_2_5" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        DECLARE @n_ApplicanterType int =3
        DECLARE @T_PatentType Table(n_PatentType int null,s_PatentTypeName varchar(100) null)

        INSERT INTO @T_PatentType(n_PatentType,s_PatentTypeName)VALUES (1, '发明')
        INSERT INTO @T_PatentType(n_PatentType,s_PatentTypeName)VALUES (2, '实用新型')
        INSERT INTO @T_PatentType(n_PatentType,s_PatentTypeName)VALUES (3, '外观设计')
 
         select 
         T_P.n_PatentType
         ,s_PatentTypeName
         ,isnull(curCount,0) as curCount
         ,isnull(lastCount,0) as lastCount
         ,Rate= case when lastCount!=0 then (isnull(curCount,0)-lastCount)*1.0/CAST(lastCount as float) else null end 
         from @T_PatentType T_P 
        left join 
        ( 
        select 
        n_PatentType,
         SUM(f_Count) curCount
         from dbo.T_PatentChartBaseData  WITH(NOLOCK)
        where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus
        and n_ApplicanterType=@n_ApplicanterType
        and (Year(@d_StartDate)<n_PatentYear 
             or (Year(@d_StartDate)=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
        and (Year(@d_EndDate)>n_PatentYear 
             or (Year(@d_EndDate)=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
         group by n_PatentType
        )  as CurT on T_P.n_PatentType=CurT.n_PatentType
        left join  
         (
         select 
        n_PatentType,
         SUM(f_Count) lastCount
         from dbo.T_PatentChartBaseData  WITH(NOLOCK)
        where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus
        and n_ApplicanterType=@n_ApplicanterType
        and (Year(DATEADD(YYYY,-1,@d_StartDate))<n_PatentYear 
             or (Year(DATEADD(YYYY,-1,@d_StartDate))=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
        and (Year(DATEADD(YYYY,-1,@d_EndDate))>n_PatentYear 
             or (Year(DATEADD(YYYY,-1,@d_EndDate))=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
         group by n_PatentType
         ) as LastT on T_P.n_PatentType=LastT.n_PatentType
         ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东混合表 1 ,和表2 -->
  <dataCommand name="loadDataGDHH_ListFrm_6_12" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
       select 
      T.n_CityCode
      ,CITY_NAME
      ,ISNULL(FM,0) AS FM
      ,FM_Last
      ,FMRate= case when FM_Last!=0 then (ISNULL(FM,0)-FM_Last)*100.0/CAST(FM_Last as float) else null end
      ,SYXX
      ,WG
      ,Total=ISNULL(FM,0)+ISNULL(SYXX,0)+ISNULL(WG,0)
      ,Total_Last=ISNULL(FM_Last,0)+ISNULL(SYXX_Last,0)+ISNULL(WG_Last,0)
      ,TotalRate= case when (ISNULL(FM_Last,0)+ISNULL(SYXX_Last,0)+ISNULL(WG_Last,0))!=0 then 
      ((ISNULL(FM,0)+ISNULL(SYXX,0)+ISNULL(WG,0)) - (ISNULL(FM_Last,0)+ISNULL(SYXX_Last,0)+ISNULL(WG_Last,0)))*100.0  / (ISNULL(FM_Last,0)+ISNULL(SYXX_Last,0)+ISNULL(WG_Last,0))
      else 0 end
      from (select C.*  from dbo.T_AddrCity  C
      join dbo.T_AddrProvince P on P.PROVINCE_ID=C.PROVINCE_ID
       where  P.PROVINCE_CODE=@n_ProvinceCode  ) TC
      left join --当前时间的
      ( 
        select 
       n_CityCode 
       ,FM = SUM(case when n_PatentType=1 then f_Count else 0 end )  
       ,SYXX = SUM(case when n_PatentType=2 then f_Count else 0 end ) 
       , WG = SUM(case when n_PatentType=3 then f_Count else 0 end ) 
       from dbo.T_PatentChartBaseData P  WITH(NOLOCK)
      where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus 
      and (Year(@d_StartDate)<n_PatentYear 
           or (Year(@d_StartDate)=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
      and (Year(@d_EndDate)>n_PatentYear 
           or (Year(@d_EndDate)=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
       group by n_CityCode 
        ) T 
        on TC.CITY_CODE=T.n_CityCode
  
        left join --去年同期数据
      ( 
        select 
       n_CityCode 
       ,FM_Last  = SUM(case when n_PatentType=1 then f_Count else 0 end )  
       ,SYXX_Last  = SUM(case when n_PatentType=2 then f_Count else 0 end ) 
       , WG_Last  = SUM(case when n_PatentType=3 then f_Count else 0 end ) 
       from dbo.T_PatentChartBaseData P  WITH(NOLOCK)
      where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus 
      and (Year(DATEADD(YYYY,-1,@d_StartDate))<n_PatentYear 
           or (Year(DATEADD(YYYY,-1,@d_StartDate))=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
      and (Year(DATEADD(YYYY,-1,@d_EndDate))>n_PatentYear 
           or (Year(DATEADD(YYYY,-1,@d_EndDate))=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
       group by n_CityCode 
        ) T_Last 
        on TC.CITY_CODE=T_Last.n_CityCode
      order by Total desc
  
         ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东混合表 3 -->
  <dataCommand name="loadDataGDHH_ListFrm_6_3" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
       select 
      T.n_CityCode
      ,CITY_NAME
      ,GR
      ,DZYX 
      ,KYDW
      ,GKQY
      ,JGTT
      ,Total=ISNULL(GR,0)+ISNULL(DZYX,0)+ISNULL(KYDW,0) +ISNULL(GKQY,0)+ISNULL(JGTT,0)
      from (select C.*  from dbo.T_AddrCity  C
      join dbo.T_AddrProvince P on P.PROVINCE_ID=C.PROVINCE_ID
       where  P.PROVINCE_CODE=@n_ProvinceCode  ) TC
      left join --当前时间的
      ( 
       select 
       n_CityCode 
       ,GR = SUM(case when n_ApplicanterType=5 then f_Count else 0 end )  
       ,DZYX = SUM(case when n_ApplicanterType=1 then f_Count else 0 end ) 
       , KYDW = SUM(case when n_ApplicanterType=2 then f_Count else 0 end ) 
       , GKQY = SUM(case when n_ApplicanterType=3 then f_Count else 0 end ) 
       , JGTT = SUM(case when n_ApplicanterType=4 then f_Count else 0 end )  
       from dbo.T_PatentChartBaseData P  WITH(NOLOCK)
      where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus 
      and (Year(@d_StartDate)<n_PatentYear 
           or (Year(@d_StartDate)=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
      and (Year(@d_EndDate)>n_PatentYear 
           or (Year(@d_EndDate)=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
       group by n_CityCode 
        ) T 
        on TC.CITY_CODE=T.n_CityCode
      order by Total desc
         ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东混合表 4 ,和表5(分顺德) -->
  <dataCommand name="loadDataGDHH_ListFrm_6_45" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      select 
      T.n_CityCode
      ,CITY_NAME
      ,ISNULL(FM,0) AS FM
      ,FM_Last
      ,FMRate= case when FM_Last!=0 then (ISNULL(FM,0)-FM_Last)*100.0/CAST(FM_Last as float) else null end
      ,SYXX
      ,WG
      ,Total=ISNULL(FM,0)+ISNULL(SYXX,0)+ISNULL(WG,0)
      ,Total_Last=ISNULL(FM_Last,0)+ISNULL(SYXX_Last,0)+ISNULL(WG_Last,0)
      ,TotalRate= case when (ISNULL(FM_Last,0)+ISNULL(SYXX_Last,0)+ISNULL(WG_Last,0))!=0 then 
      ((ISNULL(FM,0)+ISNULL(SYXX,0)+ISNULL(WG,0)) - (ISNULL(FM_Last,0)+ISNULL(SYXX_Last,0)+ISNULL(WG_Last,0)))*100.0  / (ISNULL(FM_Last,0)+ISNULL(SYXX_Last,0)+ISNULL(WG_Last,0))
      else 0 end
      from (select C.*  from dbo.T_AddrCity  C
      join dbo.T_AddrProvince P on P.PROVINCE_ID=C.PROVINCE_ID
       where  P.PROVINCE_CODE=@n_ProvinceCode and  C.CITY_CODE!=@n_CityCode  ) TC
      left join --当前时间的
      ( 
        select 
       n_CityCode 
       ,FM = SUM(case when n_PatentType=1 then f_Count else 0 end )  
       ,SYXX = SUM(case when n_PatentType=2 then f_Count else 0 end ) 
       , WG = SUM(case when n_PatentType=3 then f_Count else 0 end ) 
       from dbo.T_PatentChartBaseData P  WITH(NOLOCK)
      where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus 
      and (Year(@d_StartDate)<n_PatentYear 
           or (Year(@d_StartDate)=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
      and (Year(@d_EndDate)>n_PatentYear 
           or (Year(@d_EndDate)=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
       group by n_CityCode 
        ) T 
        on TC.CITY_CODE=T.n_CityCode
  
        left join --去年同期数据
      ( 
        select 
       n_CityCode 
       ,FM_Last  = SUM(case when n_PatentType=1 then f_Count else 0 end )  
       ,SYXX_Last  = SUM(case when n_PatentType=2 then f_Count else 0 end ) 
       , WG_Last  = SUM(case when n_PatentType=3 then f_Count else 0 end ) 
       from dbo.T_PatentChartBaseData P  WITH(NOLOCK)
      where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus 
      and (Year(DATEADD(YYYY,-1,@d_StartDate))<n_PatentYear 
           or (Year(DATEADD(YYYY,-1,@d_StartDate))=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
      and (Year(DATEADD(YYYY,-1,@d_EndDate))>n_PatentYear 
           or (Year(DATEADD(YYYY,-1,@d_EndDate))=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
       group by n_CityCode 
        ) T_Last 
        on TC.CITY_CODE=T_Last.n_CityCode
   -----------------------------------------------------------
     UNION ALL
        select 
      T.n_CityCode
      ,CITY_NAME+'(不含顺德区)'
      ,ISNULL(FM,0) AS FM
      ,FM_Last
      ,FMRate= case when FM_Last!=0 then (ISNULL(FM,0)-FM_Last)*100.0/CAST(FM_Last as float) else null end
      ,SYXX
      ,WG
      ,Total=ISNULL(FM,0)+ISNULL(SYXX,0)+ISNULL(WG,0)
      ,Total_Last=ISNULL(FM_Last,0)+ISNULL(SYXX_Last,0)+ISNULL(WG_Last,0)
      ,TotalRate= case when (ISNULL(FM_Last,0)+ISNULL(SYXX_Last,0)+ISNULL(WG_Last,0))!=0 then 
      ((ISNULL(FM,0)+ISNULL(SYXX,0)+ISNULL(WG,0)) - (ISNULL(FM_Last,0)+ISNULL(SYXX_Last,0)+ISNULL(WG_Last,0)))*100.0  / (ISNULL(FM_Last,0)+ISNULL(SYXX_Last,0)+ISNULL(WG_Last,0))
      else 0 end
      from (select C.*  from dbo.T_AddrCity  C
      join dbo.T_AddrProvince P on P.PROVINCE_ID=C.PROVINCE_ID
       where  P.PROVINCE_CODE=@n_ProvinceCode and  C.CITY_CODE=@n_CityCode ) TC
      left join --当前时间的
      ( 
        select 
       n_CityCode 
       ,FM = SUM(case when n_PatentType=1 then f_Count else 0 end )  
       ,SYXX = SUM(case when n_PatentType=2 then f_Count else 0 end ) 
       , WG = SUM(case when n_PatentType=3 then f_Count else 0 end ) 
       from dbo.T_PatentChartApplyData_Ext P  WITH(NOLOCK)
      where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus 
      and (Year(@d_StartDate)<d_DataYear 
           or (Year(@d_StartDate)=d_DataYear and MONTH(@d_StartDate)<=d_DataMonth))
      and (Year(@d_EndDate)>d_DataYear 
           or (Year(@d_EndDate)=d_DataYear and MONTH(@d_EndDate)>=d_DataMonth))
      and P.n_AreaCode!=71 
       group by n_CityCode 
        ) T 
        on TC.CITY_CODE=T.n_CityCode
  
        left join --去年同期数据
      ( 
        select 
       n_CityCode 
       ,FM_Last  = SUM(case when n_PatentType=1 then f_Count else 0 end )  
       ,SYXX_Last  = SUM(case when n_PatentType=2 then f_Count else 0 end ) 
       , WG_Last  = SUM(case when n_PatentType=3 then f_Count else 0 end ) 
       from dbo.T_PatentChartApplyData_Ext P  WITH(NOLOCK)
      where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus 
      and (Year(DATEADD(YYYY,-1,@d_StartDate))<d_DataYear 
           or (Year(DATEADD(YYYY,-1,@d_StartDate))=d_DataYear and MONTH(@d_StartDate)<=d_DataMonth))
      and (Year(DATEADD(YYYY,-1,@d_EndDate))>d_DataYear 
           or (Year(DATEADD(YYYY,-1,@d_EndDate))=d_DataYear and MONTH(@d_EndDate)>=d_DataMonth)) 
      and P.n_AreaCode!=71 
       group by n_CityCode 
        ) T_Last 
        on TC.CITY_CODE=T_Last.n_CityCode
    
   -----------------------------------------------------------
     UNION ALL
        select 
      T.n_CityCode
      ,'顺德区'
      ,ISNULL(FM,0) AS FM
      ,FM_Last
      ,FMRate= case when FM_Last!=0 then (ISNULL(FM,0)-FM_Last)*100.0/CAST(FM_Last as float) else null end
      ,SYXX
      ,WG
      ,Total=ISNULL(FM,0)+ISNULL(SYXX,0)+ISNULL(WG,0)
      ,Total_Last=ISNULL(FM_Last,0)+ISNULL(SYXX_Last,0)+ISNULL(WG_Last,0)
      ,TotalRate= case when (ISNULL(FM_Last,0)+ISNULL(SYXX_Last,0)+ISNULL(WG_Last,0))!=0 then 
      ((ISNULL(FM,0)+ISNULL(SYXX,0)+ISNULL(WG,0)) - (ISNULL(FM_Last,0)+ISNULL(SYXX_Last,0)+ISNULL(WG_Last,0)))*100.0  / (ISNULL(FM_Last,0)+ISNULL(SYXX_Last,0)+ISNULL(WG_Last,0))
      else 0 end
      from (select C.*  from dbo.T_AddrCity  C
      join dbo.T_AddrProvince P on P.PROVINCE_ID=C.PROVINCE_ID
       where  P.PROVINCE_CODE=@n_ProvinceCode and  C.CITY_CODE=@n_CityCode ) TC
      left join --当前时间的
      ( 
        select 
       n_CityCode 
       ,FM = SUM(case when n_PatentType=1 then f_Count else 0 end )  
       ,SYXX = SUM(case when n_PatentType=2 then f_Count else 0 end ) 
       , WG = SUM(case when n_PatentType=3 then f_Count else 0 end ) 
       from dbo.T_PatentChartApplyData_Ext P  WITH(NOLOCK)
      where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus 
      and (Year(@d_StartDate)<d_DataYear 
           or (Year(@d_StartDate)=d_DataYear and MONTH(@d_StartDate)<=d_DataMonth))
      and (Year(@d_EndDate)>d_DataYear 
           or (Year(@d_EndDate)=d_DataYear and MONTH(@d_EndDate)>=d_DataMonth))
      and P.n_AreaCode=71 
       group by n_CityCode 
        ) T 
        on TC.CITY_CODE=T.n_CityCode
  
        left join --去年同期数据
      ( 
        select 
       n_CityCode 
       ,FM_Last  = SUM(case when n_PatentType=1 then f_Count else 0 end )  
       ,SYXX_Last  = SUM(case when n_PatentType=2 then f_Count else 0 end ) 
       , WG_Last  = SUM(case when n_PatentType=3 then f_Count else 0 end ) 
       from dbo.T_PatentChartApplyData_Ext P  WITH(NOLOCK)
      where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus 
      and (Year(DATEADD(YYYY,-1,@d_StartDate))<d_DataYear 
           or (Year(DATEADD(YYYY,-1,@d_StartDate))=d_DataYear and MONTH(@d_StartDate)<=d_DataMonth))
      and (Year(DATEADD(YYYY,-1,@d_EndDate))>d_DataYear 
           or (Year(DATEADD(YYYY,-1,@d_EndDate))=d_DataYear and MONTH(@d_EndDate)>=d_DataMonth)) 
      and P.n_AreaCode=71 
       group by n_CityCode 
        ) T_Last 
        on TC.CITY_CODE=T_Last.n_CityCode
      order by Total desc
       
  
         ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@n_CityCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东混合表 6 -->
  <dataCommand name="loadDataGDHH_ListFrm_6_6" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
      select 
      T.n_CityCode
      ,CITY_NAME
      ,GR
      ,DZYX 
      ,KYDW
      ,GKQY
      ,JGTT
      ,Total=ISNULL(GR,0)+ISNULL(DZYX,0)+ISNULL(KYDW,0) +ISNULL(GKQY,0)+ISNULL(JGTT,0)
      from (select C.*  from dbo.T_AddrCity  C
      join dbo.T_AddrProvince P on P.PROVINCE_ID=C.PROVINCE_ID
       where  P.PROVINCE_CODE=@n_ProvinceCode  and  C.CITY_CODE!=@n_CityCode
       ) TC
      left join --当前时间的
      ( 
       select 
       n_CityCode 
       ,GR = SUM(case when n_ApplicanterType=5 then f_Count else 0 end )  
       ,DZYX = SUM(case when n_ApplicanterType=1 then f_Count else 0 end ) 
       , KYDW = SUM(case when n_ApplicanterType=2 then f_Count else 0 end ) 
       , GKQY = SUM(case when n_ApplicanterType=3 then f_Count else 0 end ) 
       , JGTT = SUM(case when n_ApplicanterType=4 then f_Count else 0 end )  
       from dbo.T_PatentChartBaseData P  WITH(NOLOCK)
      where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus 
      and (Year(@d_StartDate)<n_PatentYear 
           or (Year(@d_StartDate)=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
      and (Year(@d_EndDate)>n_PatentYear 
           or (Year(@d_EndDate)=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth))
      
       group by n_CityCode 
        ) T 
        on TC.CITY_CODE=T.n_CityCode
   -------------------
   UNION ALL
    select 
      T.n_CityCode
      ,CITY_NAME=CITY_NAME+'(不含顺德区)'
      ,GR
      ,DZYX 
      ,KYDW
      ,GKQY
      ,JGTT
      ,Total=ISNULL(GR,0)+ISNULL(DZYX,0)+ISNULL(KYDW,0) +ISNULL(GKQY,0)+ISNULL(JGTT,0)
      from (select C.*  from dbo.T_AddrCity  C
      join dbo.T_AddrProvince P on P.PROVINCE_ID=C.PROVINCE_ID
       where  P.PROVINCE_CODE=@n_ProvinceCode  and  C.CITY_CODE=@n_CityCode
       ) TC
      left join --当前时间的
      ( 
       select 
       n_CityCode 
       ,GR = SUM(case when n_ApplicanterType=5 then f_Count else 0 end )  
       ,DZYX = SUM(case when n_ApplicanterType=1 then f_Count else 0 end ) 
       , KYDW = SUM(case when n_ApplicanterType=2 then f_Count else 0 end ) 
       , GKQY = SUM(case when n_ApplicanterType=3 then f_Count else 0 end ) 
       , JGTT = SUM(case when n_ApplicanterType=4 then f_Count else 0 end )  
       from dbo.T_PatentChartApplyData_Ext P  WITH(NOLOCK)
      where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus 
      and (Year(@d_StartDate)<d_DataYear 
           or (Year(@d_StartDate)=d_DataYear and MONTH(@d_StartDate)<=d_DataMonth))
      and (Year(@d_EndDate)>d_DataYear 
           or (Year(@d_EndDate)=d_DataYear and MONTH(@d_EndDate)>=d_DataMonth))
      and P.n_AreaCode!=71
       group by n_CityCode 
        ) T 
        on TC.CITY_CODE=T.n_CityCode     
     -------------------
   UNION ALL
    select 
      T.n_CityCode
      ,CITY_NAME='顺德区'
      ,GR
      ,DZYX 
      ,KYDW
      ,GKQY
      ,JGTT
      ,Total=ISNULL(GR,0)+ISNULL(DZYX,0)+ISNULL(KYDW,0) +ISNULL(GKQY,0)+ISNULL(JGTT,0)
      from (select C.*  from dbo.T_AddrCity  C
      join dbo.T_AddrProvince P on P.PROVINCE_ID=C.PROVINCE_ID
       where  P.PROVINCE_CODE=@n_ProvinceCode  and  C.CITY_CODE=@n_CityCode
       ) TC
      left join --当前时间的
      ( 
       select 
       n_CityCode 
       ,GR = SUM(case when n_ApplicanterType=5 then f_Count else 0 end )  
       ,DZYX = SUM(case when n_ApplicanterType=1 then f_Count else 0 end ) 
       , KYDW = SUM(case when n_ApplicanterType=2 then f_Count else 0 end ) 
       , GKQY = SUM(case when n_ApplicanterType=3 then f_Count else 0 end ) 
       , JGTT = SUM(case when n_ApplicanterType=4 then f_Count else 0 end )  
       from dbo.T_PatentChartApplyData_Ext P  WITH(NOLOCK)
      where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus 
      and (Year(@d_StartDate)<d_DataYear 
           or (Year(@d_StartDate)=d_DataYear and MONTH(@d_StartDate)<=d_DataMonth))
      and (Year(@d_EndDate)>d_DataYear 
           or (Year(@d_EndDate)=d_DataYear and MONTH(@d_EndDate)>=d_DataMonth))
      and P.n_AreaCode=71
       group by n_CityCode 
        ) T 
        on TC.CITY_CODE=T.n_CityCode    
        -------------------------------
      order by Total desc
         ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@n_CityCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>

  <dataCommand name="loadDataWZSQRZLSQ_TOPX_ListFrm_4_123" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        --如果查询月份没有数据，则查最近（小于）的月份数据
  declare @U_Year int ,@U_Month int
  select  top 1 @U_Year= d_DataYear ,@U_Month=d_DataMonth  
  from  dbo.T_PatentChartApplicanterTypeData P
   where
         n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus 
         and  n_ApplicanterType=@n_ApplicanterType 
         and (P.d_DataYear<YEAR(@d_EndDate) or (P.d_DataYear=YEAR(@d_EndDate) and P.d_DataMonth<=MONTH(@d_EndDate)))
        order by P.d_DataYear desc,P.d_DataMonth desc
   
  select *
        ,Total=FM+SYXX+WG
        from 
        (
        select 
         s_Name
         ,FM = SUM(case when n_PatentType=1 then f_Count else 0 end )  
         ,SYXX = SUM(case when n_PatentType=2 then f_Count else 0 end ) 
         ,WG = SUM(case when n_PatentType=3 then f_Count else 0 end ) 
         ,s_DataCityName CityName
         from  dbo.T_PatentChartApplicanterTypeData P  WITH(NOLOCK)
         where
         n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus 
         and  n_ApplicanterType=@n_ApplicanterType 
         and  @U_Year=d_DataYear and @U_Month=d_DataMonth
         group by P.s_Name,s_DataCityName
         ) T  order by  FM+SYXX+WG desc  
         ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@n_ApplicanterType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadDataPCT_ListFrm_8_1" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        --计算所有PCT授权或申请数据
        Declare @Total int 
        select 
          @Total=SUM(f_Count) 
        from dbo.T_PatentChartApplyData P  WITH(NOLOCK)
         where
         n_ProvinceCode=@n_ProvinceCode
          --and n_PatentStatus=@n_PatentStatus 
          and  (n_ApplySource=@n_ApplySource)
          and (Year(@d_StartDate)<d_DataYear 
             or (Year(@d_StartDate)=d_DataYear and MONTH(@d_StartDate)<=d_DataMonth))
          and (Year(@d_EndDate)>d_DataYear 
             or (Year(@d_EndDate)=d_DataYear and MONTH(@d_EndDate)>=d_DataMonth)) 

        select 
        *
        ,Rate=(case when @Total=0 then 0 else f_Count*100.0/CAST(@Total as float)  end) 
        from 
        ( 
        select 
        P.n_CityCode 
        ,CITY_NAME=(select CITY_NAME from dbo.T_AddrCity C where C.CITY_CODE=P.n_CityCode)
        ,f_Count = SUM(f_Count) 
        from dbo.T_PatentChartApplyData P  WITH(NOLOCK)
         where
         n_ProvinceCode=@n_ProvinceCode
          --and n_PatentStatus=@n_PatentStatus 
          and  (n_ApplySource=@n_ApplySource)
         and (Year(@d_StartDate)<d_DataYear 
             or (Year(@d_StartDate)=d_DataYear and MONTH(@d_StartDate)<=d_DataMonth))
        and (Year(@d_EndDate)>d_DataYear 
             or (Year(@d_EndDate)=d_DataYear and MONTH(@d_EndDate)>=d_DataMonth)) 
          group by n_CityCode 
          ) as T
          ORDER BY f_Count DESC
         ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@n_ApplySource" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东省地级市电子申请率排名报表-->
  <dataCommand name="loadDataGDSZLSQ_PM_ListFrm_5_1" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
              select ROW_NUMBER() over (order by s_Rate desc) as n_No,s_Area,s_Rate from 
              (
              select s_Area
                ,s_Rate=case when ts_Count=0 then 0 else  s_Count*100.0/ts_Count end
                from 
                (
              select s_Area =(select top 1 C.CITY_NAME from dbo.T_AddrCity C where C.CITY_CODE=T_AddrCity.CITY_CODE )
              ,CITY_CODE 
              ,s_Count=sum(f_Count)  
              from T_PatentChartApplyData as p  WITH(NOLOCK)
              left join dbo.T_AddrCity  WITH(NOLOCK) on CITY_CODE=p.n_CityCode 
              where p.b_ElectronicTF=1 --是电子申请
              and p.n_PatentStatus=1 --状态为申请
              and p.n_ApplySource=0 --排除PCT
              and p.n_ProvinceCode=@n_ProvinceCode
              and (Year(@d_StartDate)<d_DataYear 
                          or (Year(@d_StartDate)=d_DataYear and MONTH(@d_StartDate)<=d_DataMonth))
                    and (Year(@d_EndDate)>d_DataYear 
                        or (Year(@d_EndDate)=d_DataYear and MONTH(@d_EndDate)>=d_DataMonth)) 
              group by CITY_CODE
                ) T
                left join 
                (
                    select 
                    CITY_CODE  
              ,ts_Count=sum(f_Count)  
              from T_PatentChartApplyData as p  WITH(NOLOCK)
              left join dbo.T_AddrCity  WITH(NOLOCK) on CITY_CODE=p.n_CityCode 
              where  
              p.n_PatentStatus=1 --状态为申请
              and p.n_ApplySource=0 --排除PCT
              and p.n_ProvinceCode=@n_ProvinceCode
              and (Year(@d_StartDate)<d_DataYear 
                          or (Year(@d_StartDate)=d_DataYear and MONTH(@d_StartDate)<=d_DataMonth))
                    and (Year(@d_EndDate)>d_DataYear 
                        or (Year(@d_EndDate)=d_DataYear and MONTH(@d_EndDate)>=d_DataMonth)) 
              group by CITY_CODE
                  ) TT on T.CITY_CODE=TT.CITY_CODE
              )Temp
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东省地级市电子申请率(分顺德)排名报表-->
  <dataCommand name="loadDataGDSZLSQ_PM_ListFrm_5_2" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
    select ROW_NUMBER() over (order by s_Rate desc) as n_No,s_Area,s_Rate from 
   (
     select s_Area
            ,s_Rate=case when ts_Count=0 then 0 else  s_Count*100.0/ts_Count end
            from 
            (
				select s_Area =(select top 1 C.CITY_NAME from dbo.T_AddrCity C where C.CITY_CODE=T_AddrCity.CITY_CODE )
				,CITY_CODE 
				,s_Count=sum(f_Count)  
				from T_PatentChartApplyData as p  WITH(NOLOCK)
				left join dbo.T_AddrCity  WITH(NOLOCK) on CITY_CODE=p.n_CityCode 
				where p.b_ElectronicTF=1 --是电子申请
				and p.n_PatentStatus=1 --状态为申请
				and p.n_ApplySource=0 --排除PCT
				and p.n_ProvinceCode=@n_ProvinceCode
				and (Year(@d_StartDate)<d_DataYear 
                      or (Year(@d_StartDate)=d_DataYear and MONTH(@d_StartDate)<=d_DataMonth))
                and (Year(@d_EndDate)>d_DataYear 
                    or (Year(@d_EndDate)=d_DataYear and MONTH(@d_EndDate)>=d_DataMonth)) 
                and T_AddrCity.CITY_CODE!=@n_CityCode
				group by CITY_CODE
            ) T
            left join 
            (
                select 
                CITY_CODE  
				,ts_Count=sum(f_Count)  
				from T_PatentChartApplyData as p  WITH(NOLOCK)
				left join dbo.T_AddrCity  WITH(NOLOCK) on CITY_CODE=p.n_CityCode 
				where  
				 p.n_PatentStatus=1 --状态为申请
				and p.n_ApplySource=0 --排除PCT
				and p.n_ProvinceCode=@n_ProvinceCode
				and (Year(@d_StartDate)<d_DataYear 
                      or (Year(@d_StartDate)=d_DataYear and MONTH(@d_StartDate)<=d_DataMonth))
                and (Year(@d_EndDate)>d_DataYear 
                    or (Year(@d_EndDate)=d_DataYear and MONTH(@d_EndDate)>=d_DataMonth)) 
                and T_AddrCity.CITY_CODE!=@n_CityCode
				group by CITY_CODE
             ) TT on T.CITY_CODE=TT.CITY_CODE
          UNION ALL
           --添加佛山(不包含顺德)数据统计  
             select s_Area='佛山(不含顺德)'
            ,s_Rate=case when ts_Count=0 then 0 else  s_Count*100.0/ts_Count end
            from 
            (
				select s_Area =(select top 1 C.CITY_NAME from dbo.T_AddrCity C where C.CITY_CODE=T_AddrCity.CITY_CODE )
				,CITY_CODE 
				,s_Count=sum(f_Count)  
				from T_PatentChartApplyData_Ext as p  WITH(NOLOCK)
				left join dbo.T_AddrCity  WITH(NOLOCK) on CITY_CODE=p.n_CityCode 
				where p.b_ElectronicTF=1 --是电子申请
				and p.n_PatentStatus=1 --状态为申请
				and p.n_ApplySource=0 --排除PCT
				and p.n_ProvinceCode=@n_ProvinceCode
				and (Year(@d_StartDate)<d_DataYear 
                      or (Year(@d_StartDate)=d_DataYear and MONTH(@d_StartDate)<=d_DataMonth))
                and (Year(@d_EndDate)>d_DataYear 
                    or (Year(@d_EndDate)=d_DataYear and MONTH(@d_EndDate)>=d_DataMonth)) 
                and T_AddrCity.CITY_CODE=@n_CityCode
                and P.n_AreaCode!=71
				group by CITY_CODE
            ) T
            left join 
            (
                select 
                CITY_CODE  
				,ts_Count=sum(f_Count)  
				from T_PatentChartApplyData_Ext as p  WITH(NOLOCK)
				left join dbo.T_AddrCity  WITH(NOLOCK) on CITY_CODE=p.n_CityCode 
				where  
				 p.n_PatentStatus=1 --状态为申请
				and p.n_ApplySource=0 --排除PCT
				and p.n_ProvinceCode=@n_ProvinceCode
				and (Year(@d_StartDate)<d_DataYear 
                      or (Year(@d_StartDate)=d_DataYear and MONTH(@d_StartDate)<=d_DataMonth))
                and (Year(@d_EndDate)>d_DataYear 
                    or (Year(@d_EndDate)=d_DataYear and MONTH(@d_EndDate)>=d_DataMonth)) 
                and T_AddrCity.CITY_CODE=@n_CityCode
                and P.n_AreaCode!=71
				group by CITY_CODE
             ) TT on T.CITY_CODE=TT.CITY_CODE
             
          UNION ALL
           --添加顺德数据统计
             select s_Area='顺德区'
            ,s_Rate=case when ts_Count=0 then 0 else  s_Count*100.0/ts_Count end
            from 
            (
				select s_Area =(select top 1 C.CITY_NAME from dbo.T_AddrCity C where C.CITY_CODE=T_AddrCity.CITY_CODE )
				,CITY_CODE 
				,s_Count=sum(f_Count)  
				from T_PatentChartApplyData_Ext as p  WITH(NOLOCK)
				left join dbo.T_AddrCity  WITH(NOLOCK) on CITY_CODE=p.n_CityCode 
				where p.b_ElectronicTF=1 --是电子申请
				and p.n_PatentStatus=1 --状态为申请
				and p.n_ApplySource=0 --排除PCT
				and p.n_ProvinceCode=@n_ProvinceCode
				and (Year(@d_StartDate)<d_DataYear 
                      or (Year(@d_StartDate)=d_DataYear and MONTH(@d_StartDate)<=d_DataMonth))
                and (Year(@d_EndDate)>d_DataYear 
                    or (Year(@d_EndDate)=d_DataYear and MONTH(@d_EndDate)>=d_DataMonth)) 
                and T_AddrCity.CITY_CODE=@n_CityCode
                and P.n_AreaCode=71
				group by CITY_CODE
            ) T
            left join 
            (
                select 
                CITY_CODE  
				,ts_Count=sum(f_Count)  
				from T_PatentChartApplyData_Ext as p  WITH(NOLOCK)
				left join dbo.T_AddrCity  WITH(NOLOCK) on CITY_CODE=p.n_CityCode 
				where  
				 p.n_PatentStatus=1 --状态为申请
				and p.n_ApplySource=0 --排除PCT
				and p.n_ProvinceCode=@n_ProvinceCode
				and (Year(@d_StartDate)<d_DataYear 
                      or (Year(@d_StartDate)=d_DataYear and MONTH(@d_StartDate)<=d_DataMonth))
                and (Year(@d_EndDate)>d_DataYear 
                    or (Year(@d_EndDate)=d_DataYear and MONTH(@d_EndDate)>=d_DataMonth)) 
                and T_AddrCity.CITY_CODE=@n_CityCode
                and P.n_AreaCode=71
				group by CITY_CODE
             ) TT on T.CITY_CODE=TT.CITY_CODE
    )Temp
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@n_CityCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东省地级市电子申请率排名报表(修正数据放在排名末尾)-->
  <dataCommand name="loadDataGDSZLSQ_PM_ListFrm_5_3" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
            DECLARE @CorrentRank INT;
            select s_Area,s_Rate 
            INTO #TempTotal
            from 
            (
	            select s_Area
              ,s_Rate=CONVERT(decimal(18,2),case when ts_Count=0 then 0 else s_Count*100.0/ts_Count end)
	            from 
	            (
		            select s_Area =(select top 1 C.CITY_NAME from dbo.T_AddrCity C where C.CITY_CODE=T_AddrCity.CITY_CODE )
		            ,CITY_CODE 
		            ,s_Count=sum(f_Count)  
		            from T_PatentChartApplyData as p  WITH(NOLOCK)
		            left join dbo.T_AddrCity  WITH(NOLOCK) on CITY_CODE=p.n_CityCode 
		            where p.b_ElectronicTF=1 --是电子申请
		            and p.n_PatentStatus=1 --状态为申请
		            and p.n_ApplySource=0 --排除PCT
		            and p.n_ProvinceCode=@n_ProvinceCode
		            and (Year(@d_StartDate)<d_DataYear 
		            or (Year(@d_StartDate)=d_DataYear and MONTH(@d_StartDate)<=d_DataMonth))
		            and (Year(@d_EndDate)>d_DataYear 
		            or (Year(@d_EndDate)=d_DataYear and MONTH(@d_EndDate)>=d_DataMonth)) 
		            --and C.CITY_NAME!='修正'
		            group by CITY_CODE
	            ) T
	            left join 
	            (
		            select 
		            CITY_CODE  
		            ,ts_Count=sum(f_Count)  
		            from T_PatentChartApplyData as p  WITH(NOLOCK)
		            left join dbo.T_AddrCity  WITH(NOLOCK) on CITY_CODE=p.n_CityCode 
		            where  
		            p.n_PatentStatus=1 --状态为申请
		            and p.n_ApplySource=0 --排除PCT
		            and p.n_ProvinceCode=@n_ProvinceCode
		            and (Year(@d_StartDate)<d_DataYear 
		            or (Year(@d_StartDate)=d_DataYear and MONTH(@d_StartDate)<=d_DataMonth))
		            and (Year(@d_EndDate)>d_DataYear 
		            or (Year(@d_EndDate)=d_DataYear and MONTH(@d_EndDate)>=d_DataMonth)) 
		            group by CITY_CODE
	            ) TT 
	            on T.CITY_CODE=TT.CITY_CODE
            )Temp    

            SELECT ROW_NUMBER() OVER (ORDER BY s_Rate desc) as n_No,s_Area,s_Rate 
            INTO #TempNoCorrect
            FROM #TempTotal WHERE s_Area!='修正'

            select @CorrentRank=MAX(n_No) from #TempNoCorrect


            SELECT * FROM #TempNoCorrect
            UNION
            SELECT n_No=@CorrentRank+1,
            s_Area,s_Rate FROM #TempTotal WHERE s_Area='修正'

            DROP TABLE #TempTotal
            DROP TABLE #TempNoCorrect
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东省地级市有效发明专利情况表-->
  <dataCommand name="loadDataYXFM_ListFrm_7_2" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
             --如果查询月份没有数据，则查最近（小于）的月份数据
  declare @U_Year int ,@U_Month int
  select  top 1 @U_Year= d_DataYear ,@U_Month=d_DataMonth  
  from  dbo.T_PatentChartApplyData P
   where
         n_ProvinceCode=@n_ProvinceCode 
         and n_PatentStatus=4
         and n_ApplySource=0 --排除PCT
         and (P.d_DataYear<YEAR(@d_StartDate) or (P.d_DataYear=YEAR(@d_StartDate) and P.d_DataMonth<=MONTH(@d_StartDate)))
        order by P.d_DataYear desc,P.d_DataMonth desc
 
   declare @ProvinceCount int 
        select @ProvinceCount=SUM(f_Count) 
        from T_PatentChartApplyData  WITH(NOLOCK)
        where
         n_ProvinceCode=@n_ProvinceCode 
         and n_PatentStatus=4
         and n_ApplySource=0 --排除PCT
         and d_DataYear=@U_Year
         and d_DataMonth=@U_Month  
          
  select s_Area ,n_No=s_Count
            ,s_Rate= case when @ProvinceCount=0 or @ProvinceCount is null then 0 else T.s_Count2*100.0/@ProvinceCount  end
            from 
            ( 
				select s_Area =(select C.CITY_NAME from dbo.T_AddrCity C where C.CITY_CODE=T_AddrCity.CITY_CODE )
				,CITY_CODE
				,s_Count=sum(f_Count)  
        ,s_Count2=sum(f_Count) 
				from T_PatentChartApplyData as p  WITH(NOLOCK)
				inner join dbo.T_AddrCity  WITH(NOLOCK) on CITY_CODE=p.n_CityCode 
				where 
        --p.b_ElectronicTF=1 --是电子申请
				--and
        p.n_PatentStatus=4 --状态为申请
				and p.n_ApplySource=0 --排除PCT
				and p.n_ProvinceCode=@n_ProvinceCode
				and p.d_DataYear=@U_Year
                and p.d_DataMonth=@U_Month
				group by CITY_CODE
            ) T
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东省地级市有效发明专利(分顺德)情况表-->
  <dataCommand name="loadDataYXFM_ListFrm_7_5" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
       --如果查询月份没有数据，则查最近（小于）的月份数据
  declare @U_Year int ,@U_Month int
  select  top 1 @U_Year= d_DataYear ,@U_Month=d_DataMonth
  from  dbo.T_PatentChartApplyData P
   where
         n_ProvinceCode=@n_ProvinceCode 
         and n_PatentStatus=4
         and n_ApplySource=0 --排除PCT
         and (P.d_DataYear<YEAR(@d_StartDate) or (P.d_DataYear=YEAR(@d_StartDate) and P.d_DataMonth<=MONTH(@d_StartDate)))
        order by P.d_DataYear desc,P.d_DataMonth desc
 
   declare @ProvinceCount int 
        select @ProvinceCount=SUM(f_Count) 
        from T_PatentChartApplyData  WITH(NOLOCK)
        where
         n_ProvinceCode=@n_ProvinceCode 
         and n_PatentStatus=4
         and n_ApplySource=0 --排除PCT
         and d_DataYear=@U_Year
         and d_DataMonth=@U_Month  
          
  select s_Area ,n_No=s_Count
            ,s_Rate= case when @ProvinceCount=0 or @ProvinceCount is null then 0 else T.s_Count2*100.0/@ProvinceCount  end 
            from 
            ( 
				select s_Area =(select C.CITY_NAME from dbo.T_AddrCity C where C.CITY_CODE=T_AddrCity.CITY_CODE )
				,CITY_CODE
				,s_Count=sum(f_Count)  
        ,s_Count2=sum(f_Count) 
				from T_PatentChartApplyData as p  WITH(NOLOCK)
				inner join dbo.T_AddrCity  WITH(NOLOCK) on CITY_CODE=p.n_CityCode 
				where  
        p.n_PatentStatus=4 --状态为申请
				and p.n_ApplySource=0 --排除PCT
				and p.n_ProvinceCode=@n_ProvinceCode
				and p.d_DataYear=@U_Year
                and p.d_DataMonth=@U_Month
                and T_AddrCity.CITY_CODE!=@n_CityCode
				group by CITY_CODE
            ) T
  Union all 
   --添加佛山(不包含顺德)数据统计
    select s_Area='佛山(不含顺德)' ,n_No=s_Count
            ,s_Rate= case when @ProvinceCount=0 or @ProvinceCount is null then 0 else T.s_Count2*100.0/@ProvinceCount  end 
            from 
            ( 
				select s_Area =(select C.CITY_NAME from dbo.T_AddrCity C where C.CITY_CODE=T_AddrCity.CITY_CODE )
				,CITY_CODE
				,s_Count=sum(f_Count)  
        ,s_Count2=sum(f_Count) 
				from T_PatentChartApplyData_Ext as p  WITH(NOLOCK)
				inner join dbo.T_AddrCity  WITH(NOLOCK) on CITY_CODE=p.n_CityCode 
				where  
                 p.n_PatentStatus=4 --状态为有效
				and p.n_ApplySource=0 --排除PCT
				and p.n_ProvinceCode=@n_ProvinceCode
				and p.d_DataYear=@U_Year
                and p.d_DataMonth=@U_Month
                and T_AddrCity.CITY_CODE=@n_CityCode
                and P.n_AreaCode!=71
				group by CITY_CODE
            ) T
  Union all 
   --添加顺德数据统计
    select s_Area='顺德' ,n_No=s_Count
            ,s_Rate= case when @ProvinceCount=0 or @ProvinceCount is null then 0 else T.s_Count2*100.0/@ProvinceCount  end 
            from 
            ( 
				select s_Area =(select C.CITY_NAME from dbo.T_AddrCity C where C.CITY_CODE=T_AddrCity.CITY_CODE )
				,CITY_CODE
				,s_Count=sum(f_Count)  
        ,s_Count2=sum(f_Count) 
				from T_PatentChartApplyData_Ext as p  WITH(NOLOCK)
				inner join dbo.T_AddrCity  WITH(NOLOCK) on CITY_CODE=p.n_CityCode 
				where  
                 p.n_PatentStatus=4 --状态为有效
				and p.n_ApplySource=0 --排除PCT
				and p.n_ProvinceCode=@n_ProvinceCode
				and p.d_DataYear=@U_Year
                and p.d_DataMonth=@U_Month
                and T_AddrCity.CITY_CODE=@n_CityCode
                and P.n_AreaCode=71
				group by CITY_CODE
            ) T
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@n_CityCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--全国各地区PCT申请受理状况表**********************************************************废弃-->
  <dataCommand name="loadDataQGZL_ListFrm_9_8" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        select PROVINCE_NAME as s_Area,PCAD.n_ProvinceCode, 
        (select SUM(f_Count) from T_PatentChartApplyData  WITH(NOLOCK) where d_DataYear=@d_Year and d_DataMonth=@d_Month and n_ProvinceCode=PCAD.n_ProvinceCode) as n_CountMonth, 
        (select SUM(f_Count) from T_PatentChartApplyData  WITH(NOLOCK) where d_DataYear=@d_Year and n_ProvinceCode=PCAD.n_ProvinceCode) as n_CountYear 
        from dbo.T_PatentChartApplyData PCAD  WITH(NOLOCK)
        inner join dbo.T_AddrProvince WITH(NOLOCK) on PROVINCE_ID=PCAD.n_ProvinceCode 
        where d_DataYear=@d_Year 
        group by PROVINCE_NAME,PCAD.n_ProvinceCode 
 
        select 174 as n_CountMonth,611 as n_CountYear 
      ]]>
    </commandText>
    <parameters>
      <param name="@d_Year" dbType="String" direction="Input"/>
      <param name="@d_Month" dbType="String" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--全国各地区专利申请结构表-->
  <dataCommand name="loadDataQGZL_ListFrm_9_7" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        select PROVINCE_NAME as s_Area,PCAD.n_ProvinceCode, 
        100*SUM(case when n_PatentType=1 then ISNULL(f_Count,0) else 0.00 end)*1.0/(case when CAST(SUM(f_Count) as float)=0 then 1 else CAST(SUM(f_Count) as float) end) as p_Per, 
        100*SUM(case when n_PatentType=2 then ISNULL(f_Count,0) else 0.00 end)*1.0/(case when CAST(SUM(f_Count) as float)=0 then 1 else CAST(SUM(f_Count) as float) end) as u_Per, 
        100*SUM(case when n_PatentType=3 then ISNULL(f_Count,0) else 0.00 end)*1.0/(case when CAST(SUM(f_Count) as float)=0 then 1 else CAST(SUM(f_Count) as float) end) as d_Per  
        from T_PatentChartApplyData PCAD  WITH(NOLOCK)
        inner join dbo.T_AddrProvince  WITH(NOLOCK) on PROVINCE_ID=PCAD.n_ProvinceCode
        where PCAD.n_PatentStatus=@s_Type 
        and PCAD.d_DataYear=@d_Year 
        and PCAD.d_DataMonth>=@d_StartMonth 
        and PCAD.d_DataMonth<=@d_EndMonth 
        group by PROVINCE_NAME,PCAD.n_ProvinceCode 
      ]]>
    </commandText>
    <parameters>
      <param name="@d_Year" dbType="String" direction="Input"/>
      <param name="@d_StartMonth" dbType="String" direction="Input"/>
      <param name="@d_EndMonth" dbType="String" direction="Input"/>
      <param name="@s_Type" dbType="String" direction="Input"/>
    </parameters>
  </dataCommand>

  <!--广东专利代理机构代理专利授权情况（申请人）-->
  <dataCommand name="loadDataDLJG_ListFrm_11_1" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        declare @s_ProvinceCode varchar(10) = @n_ProvinceCode   
        select 
        ag.s_Name as s_AgentName,
        pc.s_AgencyNO as s_AgentNo,
        COUNT(0) as n_AuthTotal,
        COUNT(case when pc.s_PatentType=1 then 1 end) as n_PCount,
        COUNT(case when pc.s_PatentType=2 then 1 end) as n_UCount,
        COUNT(case when pc.s_PatentType=3 then 1 end) as n_DCount 
        from dbo.T_PatentCase as pc  WITH(NOLOCK)
        inner join dbo.T_PatentStatus as ps  WITH(NOLOCK) on ps.s_ApplicationNO=pc.Application_NO 
        inner join dbo.T_Applicants as ap  WITH(NOLOCK) on ap.s_ApplicationNO=pc.Application_NO 
        inner join dbo.T_Agency as ag WITH(NOLOCK) on ag.s_NO=pc.s_AgencyNO 
        where pc.b_AgentTF=1 
        and ap.s_ApplicantSort=3 
        and ap.s_Province=@s_ProvinceCode 
        and ps.dt_AuthorizeDate>=@d_StartDate 
        and ps.dt_AuthorizeDate<=@d_EndDate 
        group by ag.s_Name,pc.s_AgencyNO 
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="String" direction="Input"/>
    </parameters>
  </dataCommand>

  <!--广东专利代理机构代理专利授权情况（代理机构）-->
  <dataCommand name="loadDataDLJG_ListFrm_11_2" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        select 
        pc.s_AgencyNO as s_AgentNo,
        ct.CITY_NAME as s_Area,
        ag.s_Name as s_AgentName,
        COUNT(case when pc.s_PatentType=1 then 1 end) as n_PCount,
        COUNT(case when pc.s_PatentType=2 then 1 end) as n_UCount,
        COUNT(case when pc.s_PatentType=3 then 1 end) as n_DCount,
        COUNT(0) as n_Total 
        from dbo.T_PatentCase as pc  WITH(NOLOCK)
        inner join dbo.T_PatentStatus as ps  WITH(NOLOCK) on ps.s_ApplicationNO=pc.Application_NO 
        inner join dbo.T_Applicants as ap  WITH(NOLOCK) on ap.s_ApplicationNO=pc.Application_NO  
        inner join dbo.T_Agency as ag  WITH(NOLOCK) on ag.s_NO=pc.s_AgencyNO 
        inner join dbo.T_AddrProvince as pv WITH(NOLOCK) on pv.PROVINCE_CODE=ag.s_Province 
        inner join dbo.T_AddrCity ct WITH(NOLOCK) on ct.PROVINCE_ID=pv.PROVINCE_ID and ct.CITY_CODE=ag.s_City 
        where pc.b_AgentTF=1 
        and ap.s_ApplicantSort=3 
        and ag.s_Province=@n_ProvinceCode 
        and ps.dt_AuthorizeDate>=@d_StartDate 
        and ps.dt_AuthorizeDate<=@d_EndDate 
        group by pc.s_AgencyNO,ct.CITY_NAME,ag.s_Name 
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>

  <!--广东省专利申请委托专利代理机构情况-->
  <dataCommand name="loadDataDLJG_ListFrm_11_3" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        declare @s_ProvinceCode varchar(10) = @n_ProvinceCode   
        select 
        COUNT(case when pc.s_PatentType=1 then 1 end) as n_PCount,
        COUNT(case when pc.s_PatentType=2 then 1 end) as n_UCount,
        COUNT(case when pc.s_PatentType=3 then 1 end) as n_DCount,
        COUNT(0) as n_Total 
        from dbo.T_PatentCase as pc  WITH(NOLOCK)
        inner join dbo.T_PatentStatus as ps  WITH(NOLOCK) on ps.s_ApplicationNO=pc.Application_NO 
        inner join dbo.T_Applicants as ap  WITH(NOLOCK) on ap.s_ApplicationNO=pc.Application_NO  
        inner join dbo.T_Agency as ag  WITH(NOLOCK) on ag.s_NO=pc.s_AgencyNO 
        where pc.b_AgentTF=1 
        and ap.s_ApplicantSort=1 
        and ap.s_Province=@s_ProvinceCode 
        and ag.s_Province=@s_ProvinceCode 
        and year(ps.dt_ApplyDate)=@s_Year  
      
              select 
        COUNT(case when pc.s_PatentType=1 then 1 end) as n_PCount,
        COUNT(case when pc.s_PatentType=2 then 1 end) as n_UCount,
        COUNT(case when pc.s_PatentType=3 then 1 end) as n_DCount,
        COUNT(0) as n_Total 
        from dbo.T_PatentCase as pc  WITH(NOLOCK)
        inner join dbo.T_PatentStatus as ps  WITH(NOLOCK) on ps.s_ApplicationNO=pc.Application_NO 
        inner join dbo.T_Applicants as ap  WITH(NOLOCK) on ap.s_ApplicationNO=pc.Application_NO 
        where pc.b_AgentTF=1 
        and ap.s_ApplicantSort=1 
        and ap.s_Province=@s_ProvinceCode 
        and year(ps.dt_ApplyDate)=@s_Year  

              select 
        COUNT(case when pc.s_PatentType=1 then 1 end) as n_PCount,
        COUNT(case when pc.s_PatentType=2 then 1 end) as n_UCount,
        COUNT(case when pc.s_PatentType=3 then 1 end) as n_DCount,
        COUNT(0) as n_Total 
        from dbo.T_PatentCase as pc  WITH(NOLOCK)
        inner join dbo.T_PatentStatus as ps  WITH(NOLOCK) on ps.s_ApplicationNO=pc.Application_NO 
        inner join dbo.T_Applicants as ap  WITH(NOLOCK) on ap.s_ApplicationNO=pc.Application_NO 
        where ap.s_Province=@s_ProvinceCode  
        and ap.s_ApplicantSort=1 
        and year(ps.dt_ApplyDate)=@s_Year  
      ]]>
    </commandText>
    <parameters>
      <param name="@s_Year" dbType="String" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="String" direction="Input"/>
    </parameters>
  </dataCommand>

  <!--广东省专利授权委托专利代理机构情况-->
  <dataCommand name="loadDataDLJG_ListFrm_11_4" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        declare @s_ProvinceCode varchar(10) = @n_ProvinceCode   
        select 
        COUNT(case when pc.s_PatentType=1 then 1 end) as n_PCount,
        COUNT(case when pc.s_PatentType=2 then 1 end) as n_UCount,
        COUNT(case when pc.s_PatentType=3 then 1 end) as n_DCount,
        COUNT(0) as n_Total 
        from dbo.T_PatentCase as pc  WITH(NOLOCK)
        inner join dbo.T_PatentStatus as ps  WITH(NOLOCK) on ps.s_ApplicationNO=pc.Application_NO 
        inner join dbo.T_Applicants as ap  WITH(NOLOCK) on ap.s_ApplicationNO=pc.Application_NO  
        inner join dbo.T_Agency as ag  WITH(NOLOCK) on ag.s_NO=pc.s_AgencyNO 
        where pc.b_AgentTF=1 
        and ap.s_ApplicantSort=3 
        and ap.s_Province=@s_ProvinceCode 
        and ag.s_Province=@s_ProvinceCode  
        and year(ps.dt_AuthorizeDate)=@s_Year  
      
        select 
        COUNT(case when pc.s_PatentType=1 then 1 end) as n_PCount,
        COUNT(case when pc.s_PatentType=2 then 1 end) as n_UCount,
        COUNT(case when pc.s_PatentType=3 then 1 end) as n_DCount,
        COUNT(0) as n_Total 
        from dbo.T_PatentCase as pc  WITH(NOLOCK)
        inner join dbo.T_PatentStatus as ps  WITH(NOLOCK) on ps.s_ApplicationNO=pc.Application_NO 
        inner join dbo.T_Applicants as ap  WITH(NOLOCK) on ap.s_ApplicationNO=pc.Application_NO 
        where pc.b_AgentTF=1 
        and ap.s_ApplicantSort=3 
        and ap.s_Province=@s_ProvinceCode  
        and year(ps.dt_AuthorizeDate)=@s_Year  

        select 
        COUNT(case when pc.s_PatentType=1 then 1 end) as n_PCount,
        COUNT(case when pc.s_PatentType=2 then 1 end) as n_UCount,
        COUNT(case when pc.s_PatentType=3 then 1 end) as n_DCount,
        COUNT(0) as n_Total 
        from dbo.T_PatentCase as pc 
        inner join dbo.T_PatentStatus as ps  WITH(NOLOCK) on ps.s_ApplicationNO=pc.Application_NO 
        inner join dbo.T_Applicants as ap  WITH(NOLOCK) on ap.s_ApplicationNO=pc.Application_NO 
        where ap.s_Province=@s_ProvinceCode  
        and ap.s_ApplicantSort=3 
        and year(ps.dt_AuthorizeDate)=@s_Year  
      ]]>
    </commandText>
    <parameters>
      <param name="@s_Year" dbType="String" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="String" direction="Input"/>
    </parameters>
  </dataCommand>

  <!--五种专利类型人增长率 -->
  <dataCommand name="loadDataSZZLSQ_ListFrm_1_8" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[  
        DECLARE @T_ApplicanterType Table(n_ApplicanterType int null,s_ApplicanterTypeName varchar(100) null)

        INSERT INTO @T_ApplicanterType(n_ApplicanterType,s_ApplicanterTypeName)VALUES (1, '大专院校')
        INSERT INTO @T_ApplicanterType(n_ApplicanterType,s_ApplicanterTypeName)VALUES (2, '科研机构')
        INSERT INTO @T_ApplicanterType(n_ApplicanterType,s_ApplicanterTypeName)VALUES (3, '企业')
        INSERT INTO @T_ApplicanterType(n_ApplicanterType,s_ApplicanterTypeName)VALUES (4, '机关团体')
        INSERT INTO @T_ApplicanterType(n_ApplicanterType,s_ApplicanterTypeName )VALUES (5, '个人')

        select 
         n_ApplicanterType =CASE WHEN CurT.n_ApplicanterType IS null Then LastT.n_ApplicanterType else CurT.n_ApplicanterType end
        ,curCount
        ,lastCount
        ,Rate= case when lastCount!=0 then (curCount-lastCount)*100.0/CAST(lastCount as float) else null end
        ,s_ApplicanterTypeName
        from @T_ApplicanterType T_P  
        left join  
        (
        select 
        n_ApplicanterType,
         SUM(f_Count) curCount
         from dbo.T_PatentChartBaseData  WITH(NOLOCK)
        where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus

        and (Year(@d_StartDate)<n_PatentYear 
             or (Year(@d_StartDate)=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
        and (Year(@d_EndDate)>n_PatentYear 
             or (Year(@d_EndDate)=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
         group by n_ApplicanterType
         ) as CurT on T_P.n_ApplicanterType=CurT.n_ApplicanterType
         left join  
         (
         select 
        n_ApplicanterType,
         SUM(f_Count) lastCount
         from dbo.T_PatentChartBaseData  WITH(NOLOCK)
        where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus

        and (Year(DATEADD(YYYY,-1,@d_StartDate))<n_PatentYear 
             or (Year(DATEADD(YYYY,-1,@d_StartDate))=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
        and (Year(DATEADD(YYYY,-1,@d_EndDate))>n_PatentYear 
             or (Year(DATEADD(YYYY,-1,@d_EndDate))=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
         group by n_ApplicanterType
         ) as LastT on T_P.n_ApplicanterType=LastT.n_ApplicanterType
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>

  <!--35技术领域中各城市申请详情-->
  <dataCommand name="loadDataIPC_ListFrm_10_5" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        SELECT T_Cur.s_IndustryName,
	T_Cur.n_GZCount,
	T_Cur.n_SZCount,
	T_Cur.n_ZHCount,
	T_Cur.n_STCount,
	T_Cur.n_SGCount,
	T_Cur.n_HYCount,
	T_Cur.n_MZCount,
	T_Cur.n_HZCount,
	T_Cur.n_SWCount,
	T_Cur.n_DGCount,
	T_Cur.n_ZSCount,
	T_Cur.n_JMCount,
	T_Cur.n_FSCount,
	T_Cur.n_YJCount,
	T_Cur.n_ZJCount,
	T_Cur.n_MMCount,
	T_Cur.n_ZQCount,
	T_Cur.n_QYCount,
	T_Cur.n_CZCount,
	T_Cur.n_JYCount,
	T_Cur.n_YFCount,
	T_Cur.n_Total,
	ISNULL(T_Last.n_Total,0) AS n_LastCount,
	n_Rate = CASE WHEN T_Last.n_Total!=0 THEN (T_Cur.n_Total-T_Last.n_Total)*100.0/CAST(T_Last.n_Total AS FLOAT) ELSE NULL END
	FROM 
        (SELECT IPC.s_IndustryName AS s_IndustryName, 
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=35 THEN IPC.f_Count END),0) AS n_GZCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=48 THEN IPC.f_Count END),0) AS n_SZCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=55 THEN IPC.f_Count END),0) AS n_ZHCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=60 THEN IPC.f_Count END),0) AS n_STCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=74 THEN IPC.f_Count END),0) AS n_SGCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=85 THEN IPC.f_Count END),0) AS n_HYCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=92 THEN IPC.f_Count END),0) AS n_MZCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=101 THEN IPC.f_Count END),0) AS n_HZCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=109 THEN IPC.f_Count END),0) AS n_SWCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=116 THEN IPC.f_Count END),0) AS n_DGCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=128 THEN IPC.f_Count END),0) AS n_ZSCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=179 THEN IPC.f_Count END),0) AS n_JMCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=68 THEN IPC.f_Count END),0) AS n_FSCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=187 THEN IPC.f_Count END),0) AS n_YJCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=192 THEN IPC.f_Count END),0) AS n_ZJCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=211 THEN IPC.f_Count END),0) AS n_MMCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=202 THEN IPC.f_Count END),0) AS n_ZQCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=158 THEN IPC.f_Count END),0) AS n_QYCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=154 THEN IPC.f_Count END),0) AS n_CZCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=173 THEN IPC.f_Count END),0) AS n_JYCount,
        ISNULL(SUM(CASE WHEN IPC.n_CityCode=167 THEN IPC.f_Count END),0) AS n_YFCount,
        ISNULL(SUM(IPC.f_Count),0) AS n_Total 
        FROM T_PatentChartIPCBaseData AS IPC
        WHERE IPC.n_ProvinceCode=19 
          AND (IPC.n_PatentYear > YEAR(@d_StartDate) OR (IPC.n_PatentYear = YEAR(@d_StartDate) AND IPC.n_PatentMonth >= MONTH(@d_StartDate))) 
		  AND (IPC.n_PatentYear < YEAR(@d_EndDate) OR (IPC.n_PatentYear = YEAR(@d_EndDate) AND IPC.n_PatentMonth <= MONTH(@d_EndDate))) 
        GROUP BY IPC.s_IndustryName) T_Cur
        LEFT JOIN (
        SELECT IPC.s_IndustryName AS s_IndustryName, 
        ISNULL(SUM(IPC.f_Count),0) AS n_Total 
        FROM T_PatentChartIPCBaseData AS IPC
        WHERE IPC.n_ProvinceCode=19 
          AND (IPC.n_PatentYear > YEAR(@d_StartDate)-1 OR (IPC.n_PatentYear = YEAR(@d_StartDate)-1 AND IPC.n_PatentMonth >= MONTH(@d_StartDate))) 
		  AND (IPC.n_PatentYear < YEAR(@d_EndDate)-1 OR (IPC.n_PatentYear = YEAR(@d_EndDate)-1 AND IPC.n_PatentMonth <= MONTH(@d_EndDate))) 
        GROUP BY IPC.s_IndustryName ) AS T_Last ON T_Cur.s_IndustryName=T_Last.s_IndustryName   
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>

  <!--35技术领域中各区域申请详情-->
  <dataCommand name="loadDataIPC_ListFrm_10_6_1" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        SELECT  IPC.s_CategoryName AS s_ProductName,IPC.s_IndustryName AS s_IndustName,
    ISNULL(SUM(CASE WHEN IPC.n_AreaType = 1 THEN IPC.f_Count END),0) AS n_ZSCount,
    ISNULL(SUM(CASE WHEN IPC.n_AreaType = 2 THEN IPC.f_Count END),0) AS n_DYCount,
    ISNULL(SUM(CASE WHEN IPC.n_AreaType = 3 THEN IPC.f_Count END),0) AS n_XYCount,
    ISNULL(SUM(CASE WHEN IPC.n_AreaType = 4 THEN IPC.f_Count END),0) AS n_SQCount,
    ISNULL(SUM(IPC.f_Count),0) AS n_Total   
FROM DBO.T_PatentChartIPCBaseData AS IPC 
WHERE IPC.n_ProvinceCode = 19 
AND IPC.n_PatentStatus = 1 
AND (IPC.n_PatentYear > YEAR(@d_StartDate) OR (IPC.n_PatentYear = YEAR(@d_StartDate) AND IPC.n_PatentMonth >= MONTH(@d_StartDate))) 
AND (IPC.n_PatentYear < YEAR(@d_EndDate) OR (IPC.n_PatentYear = YEAR(@d_EndDate) AND IPC.n_PatentMonth <= MONTH(@d_EndDate))) 
GROUP BY IPC.s_CategoryName,IPC.s_IndustryName   
ORDER BY IPC.s_CategoryName,IPC.s_IndustryName   
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--35技术领域中各区域授权详情-->
  <dataCommand name="loadDataIPC_ListFrm_10_6_3" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        SELECT  IPC.s_CategoryName AS s_ProductName,IPC.s_IndustryName AS s_IndustName,
    ISNULL(SUM(CASE WHEN IPC.n_AreaType = 1 THEN IPC.f_Count END),0) AS n_ZSCount,
    ISNULL(SUM(CASE WHEN IPC.n_AreaType = 2 THEN IPC.f_Count END),0) AS n_DYCount,
    ISNULL(SUM(CASE WHEN IPC.n_AreaType = 3 THEN IPC.f_Count END),0) AS n_XYCount,
    ISNULL(SUM(CASE WHEN IPC.n_AreaType = 4 THEN IPC.f_Count END),0) AS n_SQCount,
    ISNULL(SUM(IPC.f_Count),0) AS n_Total   
FROM DBO.T_PatentChartIPCBaseData AS IPC 
WHERE IPC.n_ProvinceCode = 19 
AND IPC.n_PatentStatus = 3 
AND (IPC.n_PatentYear > YEAR(@d_StartDate) OR (IPC.n_PatentYear = YEAR(@d_StartDate) AND IPC.n_PatentMonth >= MONTH(@d_StartDate))) 
AND (IPC.n_PatentYear < YEAR(@d_EndDate) OR (IPC.n_PatentYear = YEAR(@d_EndDate) AND IPC.n_PatentMonth <= MONTH(@d_EndDate))) 
GROUP BY IPC.s_CategoryName,IPC.s_IndustryName   
ORDER BY IPC.s_CategoryName,IPC.s_IndustryName   
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--35技术领域中申请详情-->
  <dataCommand name="loadDataIPC_ListFrm_10_8" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        SELECT IPC.s_IndustryName AS s_IndustName,
        ISNULL(SUM(CASE WHEN IPC.n_ApplicanterType=1 THEN IPC.f_Count END),0) AS n_UVCount,
        ISNULL(SUM(CASE WHEN IPC.n_ApplicanterType=2 THEN IPC.f_Count END),0) AS n_SUCount,
        ISNULL(SUM(CASE WHEN IPC.n_ApplicanterType=3 THEN IPC.f_Count END),0) AS n_ICCount,
        ISNULL(SUM(CASE WHEN IPC.n_ApplicanterType=4 THEN IPC.f_Count END),0) AS n_OGCount,
        ISNULL(SUM(CASE WHEN IPC.n_ApplicanterType=5 THEN IPC.f_Count END),0) AS n_PSCount,
        ISNULL(SUM(IPC.f_Count),0) AS n_Total  
        FROM T_PatentChartIPCBaseData IPC
        WHERE IPC.n_ProvinceCode = 19 
		      AND IPC.n_PatentStatus = 1 
		      AND (IPC.n_PatentYear > YEAR(@d_StartDate) OR (IPC.n_PatentYear = YEAR(@d_StartDate) AND IPC.n_PatentMonth >= MONTH(@d_StartDate))) 
		      AND (IPC.n_PatentYear < YEAR(@d_EndDate) OR (IPC.n_PatentYear = YEAR(@d_EndDate) AND IPC.n_PatentMonth <= MONTH(@d_EndDate))) 
		    GROUP BY IPC.s_IndustryName   
		    ORDER BY n_Total DESC   
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东省工矿企业发明专利申请量产业排名-->
  <dataCommand name="loadDataIPC_ListFrm_10_18" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
         SELECT IPC.s_CategoryName,IPC.s_IndustryName AS IndustryName,IPC.s_Name,SUM(IPC.f_Count) AS n_Count 
FROM T_PatentChartIPCTopData IPC
WHERE IPC.n_ProvinceCode=19
AND IPC.n_ApplicanterType=3
AND IPC.n_PatentStatus=1
AND IPC.n_PatentType=1
AND (IPC.d_DataYear > YEAR(@d_StartDate) OR (IPC.d_DataYear = YEAR(@d_StartDate) AND IPC.d_DataMonth >= MONTH(@d_StartDate))) 
AND (IPC.d_DataYear < YEAR(@d_EndDate) OR (IPC.d_DataYear = YEAR(@d_EndDate) AND IPC.d_DataMonth <= MONTH(@d_EndDate))) 
GROUP BY IPC.s_CategoryName,IPC.s_IndustryName,IPC.s_Name   
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东省工矿企业发明专利授权量产业排名-->
  <dataCommand name="loadDataIPC_ListFrm_10_18_3" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
         SELECT IPC.s_CategoryName,IPC.s_IndustryName AS IndustryName,IPC.s_Name,SUM(IPC.f_Count) AS n_Count 
FROM T_PatentChartIPCTopData IPC
WHERE IPC.n_ProvinceCode=19
AND IPC.n_ApplicanterType=3
AND IPC.n_PatentStatus=3
AND IPC.n_PatentType=1
AND (IPC.d_DataYear > YEAR(@d_StartDate) OR (IPC.d_DataYear = YEAR(@d_StartDate) AND IPC.d_DataMonth >= MONTH(@d_StartDate))) 
AND (IPC.d_DataYear < YEAR(@d_EndDate) OR (IPC.d_DataYear = YEAR(@d_EndDate) AND IPC.d_DataMonth <= MONTH(@d_EndDate))) 
GROUP BY IPC.s_CategoryName,IPC.s_IndustryName,IPC.s_Name  
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--技术领域全省企业发明专利数量及所占比例-->
  <dataCommand name="loadDataIPC_ListFrm_10_14" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
DECLARE  @TotalCount INT=0

SELECT  
  @TotalCount=SUM(I.f_Count)  
    FROM dbo.T_PatentChartIPCBaseData I
    WHERE 
  I.n_ProvinceCode=19 
  AND (Year(@d_StartDate)< n_PatentYear 
           OR (Year(@d_StartDate)=n_PatentYear  AND MONTH(@d_StartDate)<=n_PatentMonth))
      AND (Year(@d_EndDate)>n_PatentYear  
           OR (Year(@d_EndDate)=n_PatentYear AND MONTH(@d_EndDate)>=n_PatentMonth))  

           
 SELECT A.*,
 Rate=CASE WHEN @TotalCount!=0 THEN A.CurCount/CAST(@TotalCount AS FLOAT)*100 ELSE NULL END  
 FROM (
 SELECT 
  s_CategoryName AS s_CategoryName
 ,s_IndustryName AS IndustryName
 ,SUM(I.f_Count) AS CurCount
 FROM dbo.T_PatentChartIPCBaseData I 
 WHERE I.n_ProvinceCode=19 
  AND I.n_PatentType=1 
  AND I.n_ApplicanterType=3 
  AND (Year(@d_StartDate)< n_PatentYear 
           OR (Year(@d_StartDate)=n_PatentYear  AND MONTH(@d_StartDate)<=n_PatentMonth))
      AND (Year(@d_EndDate)>n_PatentYear  
           OR (Year(@d_EndDate)=n_PatentYear AND MONTH(@d_EndDate)>=n_PatentMonth)) 
 GROUP BY I.s_CategoryName,I.s_IndustryName
 ) AS A 
 ORDER BY A.s_CategoryName,Rate DESC  
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>

  <!--全省技术领域发明专利申请量增长率前/后十位-->
  <dataCommand name="loadDataIPC_ListFrm_10_15" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
           DECLARE @n_ProvinceCode INT =19,
@n_PatentType INT=1,
@n_PatentStatus INT=1   

IF @s_Type = 0 
 BEGIN
 SELECT TOP 10 * 
 FROM ( 
 SELECT CurT.s_CategoryName
 , CurT.s_IndustryName AS IndustryName
 ,curCount
 ,Rate= CASE WHEN lastCount!=0 THEN (curCount-lastCount)/CAST(lastCount AS FLOAT)*100 ELSE NULL END  
 FROM (
  SELECT 
  s_CategoryName
 ,s_IndustryName
 ,SUM(f_Count) curCount
 FROM 
  T_PatentChartIPCBaseData
 WHERE 
  n_ProvinceCode=@n_ProvinceCode  
  AND n_PatentType=@n_PatentType
  and n_PatentStatus=@n_PatentStatus
  and (Year(@d_StartDate)<n_PatentYear 
             or (Year(@d_StartDate)=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
        and (Year(@d_EndDate)>n_PatentYear 
             or (Year(@d_EndDate)=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
 GROUP BY  s_CategoryName, s_IndustryName
 ) AS CurT  
 LEFT JOIN 
 (
  SELECT  s_CategoryName
 ,s_IndustryName
 ,SUM(f_Count) lastCount
 FROM
 T_PatentChartIPCBaseData
 WHERE  
  n_ProvinceCode=@n_ProvinceCode  
  AND n_PatentType=@n_PatentType
  and n_PatentStatus=@n_PatentStatus
   and (Year(DATEADD(YYYY,-1,@d_StartDate))<n_PatentYear 
             or (Year(DATEADD(YYYY,-1,@d_StartDate))=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
        and (Year(DATEADD(YYYY,-1,@d_EndDate))>n_PatentYear 
             or (Year(DATEADD(YYYY,-1,@d_EndDate))=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
GROUP BY  s_CategoryName,s_IndustryName
) AS LastT ON LastT.s_IndustryName=CurT.s_IndustryName AND LastT.s_CategoryName=CurT.s_CategoryName
) AS T
ORDER BY T.Rate DESC
END
ELSE
BEGIN
 SELECT TOP 10 * 
 FROM ( 
 SELECT CurT.s_CategoryName
 , CurT.s_IndustryName AS IndustryName
 ,curCount
 ,Rate= CASE WHEN lastCount!=0 THEN (curCount-lastCount)/CAST(lastCount AS FLOAT)*100 ELSE NULL END  
 FROM (
  SELECT 
  s_CategoryName
 ,s_IndustryName
 ,SUM(f_Count) curCount
 FROM 
  T_PatentChartIPCBaseData
 WHERE 
  n_ProvinceCode=@n_ProvinceCode  
  AND n_PatentType=@n_PatentType
  and n_PatentStatus=@n_PatentStatus
  and (Year(@d_StartDate)<n_PatentYear 
             or (Year(@d_StartDate)=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
        and (Year(@d_EndDate)>n_PatentYear 
             or (Year(@d_EndDate)=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
 GROUP BY  s_CategoryName, s_IndustryName
 ) AS CurT  
 LEFT JOIN 
 (
  SELECT  s_CategoryName
 ,s_IndustryName
 ,SUM(f_Count) lastCount
 FROM
 T_PatentChartIPCBaseData
 WHERE  
  n_ProvinceCode=@n_ProvinceCode  
  AND n_PatentType=@n_PatentType
  and n_PatentStatus=@n_PatentStatus
  and (Year(DATEADD(YYYY,-1,@d_StartDate))<n_PatentYear 
             or (Year(DATEADD(YYYY,-1,@d_StartDate))=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
        and (Year(DATEADD(YYYY,-1,@d_EndDate))>n_PatentYear 
             or (Year(DATEADD(YYYY,-1,@d_EndDate))=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
GROUP BY  s_CategoryName,s_IndustryName
) AS LastT ON LastT.s_IndustryName=CurT.s_IndustryName AND LastT.s_CategoryName=CurT.s_CategoryName
) AS T
ORDER BY T.Rate 
END  
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@s_Type" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>

  <!--我省各市企业发明专利排名前3位的技术领域-->
  <dataCommand name="loadDataIPC_ListFrm_10_17" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        declare @n_ProvinceCode int =19
  ,@n_ApplicanterType int=3 
  ,@s_PatentType int=1 
  ,@n_PatentStatus int=1   

   --table
 DECLARE @OutTable Table
 (
   curCount int,
   s_CategoryName nvarchar(100),
   IndustryName nvarchar(100),
   CITY_CODE nvarchar(50) 
 )
declare my_cursor cursor   
for
select CITY_CODE from  dbo.T_AddrProvince P
 JOIN dbo.T_AddrCity C ON P.PROVINCE_ID=C.PROVINCE_ID
 where P.PROVINCE_CODE=@n_ProvinceCode 
open my_cursor
declare @CityCode sysname
fetch next from my_cursor into @CityCode
while(@@fetch_status=0)
begin
 --查找对应的市,找到前三条行业 
    --得到前3名的占用值  
   insert into @OutTable(curCount,s_CategoryName,IndustryName,CITY_CODE) 
   select E1.vf_count,s_CategoryName,s_IndustryName,n_CityCode from 
				 (
                   select   
				   vf_count=SUM(f_Count)  
				   ,s_CategoryName, s_IndustryName, n_CityCode
				   from T_PatentChartIPCBaseData 
				   where  n_CityCode=@CityCode 
				   and n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus 
                        and (Year(@d_StartDate)<n_PatentYear 
                            or (Year(@d_StartDate)=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
                            and (Year(@d_EndDate)>n_PatentYear 
                            or (Year(@d_EndDate)=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
                   group by s_CategoryName, s_IndustryName, n_CityCode
				 ) E1 
				 inner join 
				 (
				   --得到前10名的占用值
                  select  vf_count
                   from ( 
				   --得到前3名排名记录 
					  select 
					   top 3 
					   vf_count=SUM(f_Count)
					   from T_PatentChartIPCBaseData 
					   where  n_CityCode=@CityCode 
				        and n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus 
                        and (Year(@d_StartDate)<n_PatentYear 
                            or (Year(@d_StartDate)=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
                            and (Year(@d_EndDate)>n_PatentYear 
                            or (Year(@d_EndDate)=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
					   group by  s_CategoryName, s_IndustryName, n_CityCode
					   order by vf_count desc
				   ) E 
				   group by vf_count
				  ) E2 
				  on E1.vf_count=E2.vf_count 
  
--fetch next from my_cursor
fetch next from my_cursor into @CityCode 
end 
close my_cursor
deallocate my_cursor
 
select * 
,CityName=(select CITY_NAME from dbo.T_AddrCity C where C.CITY_CODE=A.CITY_CODE)
from @OutTable A 
order by A.CITY_CODE,curCount desc   
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>

  <!--代理机构的申请详情-->
  <dataCommand name="loadDataIPC_ListFrm_10_20" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          DECLARE @n_ProvinceCode INT =19
  ,@s_PatentType INT=1 --发明
  ,@s_PatentType1 INT=2 --实用新型
  
  SELECT  
      T_IndustryToIpc.s_CategoryName, T_IndustryToIpc.IndustryName 
      ,ISNULL(GR,0) AS GR
      ,ISNULL(DZYX,0) AS DZYX
      ,ISNULL(KYDW,0) AS KYDW
      ,ISNULL(GKQY,0) AS GKQY
      ,ISNULL(JGTT,0) AS JGTT
      ,Total=ISNULL(GR,0)+ISNULL(DZYX,0)+ISNULL(KYDW,0) +ISNULL(GKQY,0)+ISNULL(JGTT,0)
      ,ISNULL(GR1,0) AS GR1
      ,ISNULL(DZYX1,0) AS DZYX1
      ,ISNULL(KYDW1,0) AS KYDW1
      ,ISNULL(GKQY1,0) AS GKQY1
      ,ISNULL(JGTT1,0) AS JGTT1
      ,Total1=ISNULL(GR1,0)+ISNULL(DZYX1,0)+ISNULL(KYDW1,0) +ISNULL(GKQY1,0)+ISNULL(JGTT1,0)
      FROM (SELECT T.s_CategoryName,T.IndustryName FROM T_IndustryToIpc T GROUP BY T.s_CategoryName,T.IndustryName) AS T_IndustryToIpc
       join --发明
      ( 
       SELECT  
       s_CategoryName,s_IndustryName AS IndustryName 
       ,GR = SUM(CASE WHEN n_ApplicanterType=5 THEN f_Count END )  
       ,DZYX = SUM(CASE WHEN n_ApplicanterType=1 THEN f_Count END ) 
       , KYDW = SUM(CASE WHEN n_ApplicanterType=2 THEN f_Count END ) 
       , GKQY = SUM(CASE WHEN n_ApplicanterType=3 THEN f_Count END ) 
       , JGTT = SUM(CASE WHEN n_ApplicanterType=4 THEN f_Count END )  
	   FROM T_PatentChartIPCBaseData
		 WHERE n_ProvinceCode = @n_ProvinceCode  
		  AND n_PatentStatus = 1
		  AND n_PatentType = @s_PatentType
		  AND (Year(@d_StartDate) < n_PatentYear OR (Year(@d_StartDate) = n_PatentYear  AND MONTH(@d_StartDate) <= n_PatentMonth))
		  AND (Year(@d_EndDate) > n_PatentYear OR (Year(@d_EndDate) = n_PatentYear AND MONTH(@d_EndDate) >= n_PatentMonth))  
		 GROUP BY s_CategoryName,s_IndustryName 
        ) T 
        ON T_IndustryToIpc.s_CategoryName=T.s_CategoryName AND T_IndustryToIpc.IndustryName=T.IndustryName
        LEFT JOIN --实用新新
        ( 
       SELECT  
       s_CategoryName,s_IndustryName AS IndustryName 
       ,GR1 = SUM(CASE WHEN n_ApplicanterType=5 THEN f_Count END )  
       ,DZYX1 = SUM(CASE WHEN n_ApplicanterType=1 THEN f_Count END ) 
       , KYDW1 = SUM(CASE WHEN n_ApplicanterType=2 THEN f_Count END ) 
       , GKQY1 = SUM(CASE WHEN n_ApplicanterType=3 THEN f_Count END ) 
       , JGTT1 = SUM(CASE WHEN n_ApplicanterType=4 THEN f_Count END )  
	   FROM T_PatentChartIPCBaseData
		 WHERE n_ProvinceCode=@n_ProvinceCode  
		  AND n_PatentStatus = 1
		  AND n_PatentType=@s_PatentType1
		  AND (Year(@d_StartDate) < n_PatentYear OR (Year(@d_StartDate) = n_PatentYear  AND MONTH(@d_StartDate) <= n_PatentMonth))
		  AND (Year(@d_EndDate) > n_PatentYear OR (Year(@d_EndDate) = n_PatentYear AND MONTH(@d_EndDate) >= n_PatentMonth))  
		 GROUP BY s_CategoryName,s_IndustryName 
        ) T1
        ON T_IndustryToIpc.s_CategoryName=T1.s_CategoryName and T_IndustryToIpc.IndustryName=T1.IndustryName
        ORDER BY T1.s_CategoryName,T1.IndustryName   
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--代理机构的授权详情-->
  <dataCommand name="loadDataIPC_ListFrm_10_20_3" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        DECLARE @n_ProvinceCode INT =19
  ,@s_PatentType INT=1 --发明
  ,@s_PatentType1 INT=2 --实用新型
  
  SELECT  
      T_IndustryToIpc.s_CategoryName, T_IndustryToIpc.IndustryName 
      ,ISNULL(GR,0) AS GR
      ,ISNULL(DZYX,0) AS DZYX
      ,ISNULL(KYDW,0) AS KYDW
      ,ISNULL(GKQY,0) AS GKQY
      ,ISNULL(JGTT,0) AS JGTT
      ,Total=ISNULL(GR,0)+ISNULL(DZYX,0)+ISNULL(KYDW,0) +ISNULL(GKQY,0)+ISNULL(JGTT,0)
      ,ISNULL(GR1,0) AS GR1
      ,ISNULL(DZYX1,0) AS DZYX1
      ,ISNULL(KYDW1,0) AS KYDW1
      ,ISNULL(GKQY1,0) AS GKQY1
      ,ISNULL(JGTT1,0) AS JGTT1
      ,Total1=ISNULL(GR1,0)+ISNULL(DZYX1,0)+ISNULL(KYDW1,0) +ISNULL(GKQY1,0)+ISNULL(JGTT1,0)
      FROM (SELECT T.s_CategoryName,T.IndustryName FROM T_IndustryToIpc T GROUP BY T.s_CategoryName,T.IndustryName) AS T_IndustryToIpc
       join --发明
      ( 
       SELECT  
       s_CategoryName,s_IndustryName AS IndustryName 
       ,GR = SUM(CASE WHEN n_ApplicanterType=5 THEN f_Count END )  
       ,DZYX = SUM(CASE WHEN n_ApplicanterType=1 THEN f_Count END ) 
       , KYDW = SUM(CASE WHEN n_ApplicanterType=2 THEN f_Count END ) 
       , GKQY = SUM(CASE WHEN n_ApplicanterType=3 THEN f_Count END ) 
       , JGTT = SUM(CASE WHEN n_ApplicanterType=4 THEN f_Count END )  
	   FROM T_PatentChartIPCBaseData
		 WHERE n_ProvinceCode = @n_ProvinceCode  
		  AND n_PatentStatus = 3
		  AND n_PatentType = @s_PatentType
		  AND (Year(@d_StartDate) < n_PatentYear OR (Year(@d_StartDate) = n_PatentYear  AND MONTH(@d_StartDate) <= n_PatentMonth))
		  AND (Year(@d_EndDate) > n_PatentYear OR (Year(@d_EndDate) = n_PatentYear AND MONTH(@d_EndDate) >= n_PatentMonth))  
		 GROUP BY s_CategoryName,s_IndustryName 
        ) T 
        ON T_IndustryToIpc.s_CategoryName=T.s_CategoryName AND T_IndustryToIpc.IndustryName=T.IndustryName
        LEFT JOIN --实用新新
        ( 
       SELECT  
       s_CategoryName,s_IndustryName AS IndustryName 
       ,GR1 = SUM(CASE WHEN n_ApplicanterType=5 THEN f_Count END )  
       ,DZYX1 = SUM(CASE WHEN n_ApplicanterType=1 THEN f_Count END ) 
       , KYDW1 = SUM(CASE WHEN n_ApplicanterType=2 THEN f_Count END ) 
       , GKQY1 = SUM(CASE WHEN n_ApplicanterType=3 THEN f_Count END ) 
       , JGTT1 = SUM(CASE WHEN n_ApplicanterType=4 THEN f_Count END )  
	   FROM T_PatentChartIPCBaseData
		 WHERE n_ProvinceCode=@n_ProvinceCode  
		  AND n_PatentStatus = 3
		  AND n_PatentType=@s_PatentType1
		  AND (Year(@d_StartDate) < n_PatentYear OR (Year(@d_StartDate) = n_PatentYear  AND MONTH(@d_StartDate) <= n_PatentMonth))
		  AND (Year(@d_EndDate) > n_PatentYear OR (Year(@d_EndDate) = n_PatentYear AND MONTH(@d_EndDate) >= n_PatentMonth))  
		 GROUP BY s_CategoryName,s_IndustryName 
        ) T1
        ON T_IndustryToIpc.s_CategoryName=T1.s_CategoryName and T_IndustryToIpc.IndustryName=T1.IndustryName
        ORDER BY T1.s_CategoryName,T1.IndustryName   
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>

  <!--广东省战略新型领域产业发明和实用新型专利申请状况表-->
  <dataCommand name="loadDataIPC_ListFrm_10_23_1" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          SELECT 
	T_Total.s_Area,T_Total.s_IndustryName,
	ISNULL(T_Total.n_Total,0) AS n_Total,ISNULL(T_Total.n_PTotal,0) AS n_PTotal,ISNULL(T_Total.n_UTotal,0) AS n_UTotal,
	ISNULL(T_T1.n_Total,0) AS n_CurTotal1,ISNULL(T_T1.n_PTotal,0) AS n_PCount1,ISNULL(T_T1.n_UTotal,0) AS n_UCount1,
	ISNULL(T_T2.n_Total,0) AS n_CurTotal2,ISNULL(T_T2.n_PTotal,0) AS n_PCount2,ISNULL(T_T2.n_UTotal,0) AS n_UCount2,
	ISNULL(T_T3.n_Total,0) AS n_CurTotal3,ISNULL(T_T3.n_PTotal,0) AS n_PCount3,ISNULL(T_T3.n_UTotal,0) AS n_UCount3,
	ISNULL(T_T4.n_Total,0) AS n_CurTotal4,ISNULL(T_T4.n_PTotal,0) AS n_PCount4,ISNULL(T_T4.n_UTotal,0) AS n_UCount4,
	ISNULL(T_T5.n_Total,0) AS n_CurTotal5,ISNULL(T_T5.n_PTotal,0) AS n_PCount5,ISNULL(T_T5.n_UTotal,0) AS n_UCount5
FROM (
SELECT TAP.PROVINCE_NAME AS s_Area,IPC.s_IndustryName AS s_IndustryName,
SUM(CASE WHEN IPC.n_PatentType=1 THEN IPC.f_Count END) AS n_PTotal,
SUM(CASE WHEN IPC.n_PatentType=2 THEN IPC.f_Count END) AS n_UTotal,
SUM(IPC.f_Count) AS n_Total 
FROM T_PatentChartIPCBaseData IPC
LEFT JOIN T_AddrProvince TAP ON TAP.PROVINCE_CODE=IPC.n_ProvinceCode
WHERE IPC.n_ProvinceCode=19
AND IPC.n_PatentStatus=1
AND n_PatentYear>YEAR(@d_StartDate)-5
AND n_PatentYear<=YEAR(@d_StartDate)
GROUP BY TAP.PROVINCE_NAME,IPC.s_IndustryName
) AS T_Total
LEFT JOIN (
SELECT TAP.PROVINCE_NAME AS s_Area,IPC.s_IndustryName AS s_IndustryName,
SUM(CASE WHEN IPC.n_PatentType=1 THEN IPC.f_Count END) AS n_PTotal,
SUM(CASE WHEN IPC.n_PatentType=2 THEN IPC.f_Count END) AS n_UTotal,
SUM(IPC.f_Count) AS n_Total 
FROM T_PatentChartIPCBaseData IPC
LEFT JOIN T_AddrProvince TAP ON TAP.PROVINCE_CODE=IPC.n_ProvinceCode
WHERE IPC.n_ProvinceCode=19
AND IPC.n_PatentStatus=1
AND n_PatentYear=YEAR(@d_StartDate)-4
GROUP BY TAP.PROVINCE_NAME,IPC.s_IndustryName
) T_T1 ON T_T1.s_Area=T_Total.s_Area AND T_T1.s_IndustryName=T_Total.s_IndustryName
LEFT JOIN (
SELECT TAP.PROVINCE_NAME AS s_Area,IPC.s_IndustryName AS s_IndustryName,
SUM(CASE WHEN IPC.n_PatentType=1 THEN IPC.f_Count END) AS n_PTotal,
SUM(CASE WHEN IPC.n_PatentType=2 THEN IPC.f_Count END) AS n_UTotal,
SUM(IPC.f_Count) AS n_Total 
FROM T_PatentChartIPCBaseData IPC
LEFT JOIN T_AddrProvince TAP ON TAP.PROVINCE_CODE=IPC.n_ProvinceCode
WHERE IPC.n_ProvinceCode=19
AND IPC.n_PatentStatus=1
AND n_PatentYear=YEAR(@d_StartDate)-3
GROUP BY TAP.PROVINCE_NAME,IPC.s_IndustryName
) T_T2 ON T_T2.s_Area=T_Total.s_Area AND T_T2.s_IndustryName=T_Total.s_IndustryName
LEFT JOIN (
SELECT TAP.PROVINCE_NAME AS s_Area,IPC.s_IndustryName AS s_IndustryName,
SUM(CASE WHEN IPC.n_PatentType=1 THEN IPC.f_Count END) AS n_PTotal,
SUM(CASE WHEN IPC.n_PatentType=2 THEN IPC.f_Count END) AS n_UTotal,
SUM(IPC.f_Count) AS n_Total 
FROM T_PatentChartIPCBaseData IPC
LEFT JOIN T_AddrProvince TAP ON TAP.PROVINCE_CODE=IPC.n_ProvinceCode
WHERE IPC.n_ProvinceCode=19
AND IPC.n_PatentStatus=1
AND n_PatentYear=YEAR(@d_StartDate)-2
GROUP BY TAP.PROVINCE_NAME,IPC.s_IndustryName
) T_T3 ON T_T3.s_Area=T_Total.s_Area AND T_T3.s_IndustryName=T_Total.s_IndustryName
LEFT JOIN (
SELECT TAP.PROVINCE_NAME AS s_Area,IPC.s_IndustryName AS s_IndustryName,
SUM(CASE WHEN IPC.n_PatentType=1 THEN IPC.f_Count END) AS n_PTotal,
SUM(CASE WHEN IPC.n_PatentType=2 THEN IPC.f_Count END) AS n_UTotal,
SUM(IPC.f_Count) AS n_Total 
FROM T_PatentChartIPCBaseData IPC
LEFT JOIN T_AddrProvince TAP ON TAP.PROVINCE_CODE=IPC.n_ProvinceCode
WHERE IPC.n_ProvinceCode=19
AND IPC.n_PatentStatus=1
AND n_PatentYear=YEAR(@d_StartDate)-1
GROUP BY TAP.PROVINCE_NAME,IPC.s_IndustryName
) T_T4 ON T_T4.s_Area=T_Total.s_Area AND T_T4.s_IndustryName=T_Total.s_IndustryName
LEFT JOIN (
SELECT TAP.PROVINCE_NAME AS s_Area,IPC.s_IndustryName AS s_IndustryName,
SUM(CASE WHEN IPC.n_PatentType=1 THEN IPC.f_Count END) AS n_PTotal,
SUM(CASE WHEN IPC.n_PatentType=2 THEN IPC.f_Count END) AS n_UTotal,
SUM(IPC.f_Count) AS n_Total 
FROM T_PatentChartIPCBaseData IPC
LEFT JOIN T_AddrProvince TAP ON TAP.PROVINCE_CODE=IPC.n_ProvinceCode
WHERE IPC.n_ProvinceCode=19
AND IPC.n_PatentStatus=1
AND n_PatentYear=YEAR(@d_StartDate)
GROUP BY TAP.PROVINCE_NAME,IPC.s_IndustryName
) T_T5 ON T_T5.s_Area=T_Total.s_Area AND T_T5.s_IndustryName=T_Total.s_IndustryName   

      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>

  <!--广东省战略新型领域产业发明和实用新型专利授权状况表-->
  <dataCommand name="loadDataIPC_ListFrm_10_23_3" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          SELECT 
	T_Total.s_Area,T_Total.s_IndustryName,
	ISNULL(T_Total.n_Total,0) AS n_Total,ISNULL(T_Total.n_PTotal,0) AS n_PTotal,ISNULL(T_Total.n_UTotal,0) AS n_UTotal,
	ISNULL(T_T1.n_Total,0) AS n_CurTotal1,ISNULL(T_T1.n_PTotal,0) AS n_PCount1,ISNULL(T_T1.n_UTotal,0) AS n_UCount1,
	ISNULL(T_T2.n_Total,0) AS n_CurTotal2,ISNULL(T_T2.n_PTotal,0) AS n_PCount2,ISNULL(T_T2.n_UTotal,0) AS n_UCount2,
	ISNULL(T_T3.n_Total,0) AS n_CurTotal3,ISNULL(T_T3.n_PTotal,0) AS n_PCount3,ISNULL(T_T3.n_UTotal,0) AS n_UCount3,
	ISNULL(T_T4.n_Total,0) AS n_CurTotal4,ISNULL(T_T4.n_PTotal,0) AS n_PCount4,ISNULL(T_T4.n_UTotal,0) AS n_UCount4,
	ISNULL(T_T5.n_Total,0) AS n_CurTotal5,ISNULL(T_T5.n_PTotal,0) AS n_PCount5,ISNULL(T_T5.n_UTotal,0) AS n_UCount5
FROM (
SELECT TAP.PROVINCE_NAME AS s_Area,IPC.s_IndustryName AS s_IndustryName,
SUM(CASE WHEN IPC.n_PatentType=1 THEN IPC.f_Count END) AS n_PTotal,
SUM(CASE WHEN IPC.n_PatentType=2 THEN IPC.f_Count END) AS n_UTotal,
SUM(IPC.f_Count) AS n_Total 
FROM T_PatentChartIPCBaseData IPC
LEFT JOIN T_AddrProvince TAP ON TAP.PROVINCE_CODE=IPC.n_ProvinceCode
WHERE IPC.n_ProvinceCode=19
AND IPC.n_PatentStatus=3
AND n_PatentYear>YEAR(@d_StartDate)-5
AND n_PatentYear<=YEAR(@d_StartDate)
GROUP BY TAP.PROVINCE_NAME,IPC.s_IndustryName
) AS T_Total
LEFT JOIN (
SELECT TAP.PROVINCE_NAME AS s_Area,IPC.s_IndustryName AS s_IndustryName,
SUM(CASE WHEN IPC.n_PatentType=1 THEN IPC.f_Count END) AS n_PTotal,
SUM(CASE WHEN IPC.n_PatentType=2 THEN IPC.f_Count END) AS n_UTotal,
SUM(IPC.f_Count) AS n_Total 
FROM T_PatentChartIPCBaseData IPC
LEFT JOIN T_AddrProvince TAP ON TAP.PROVINCE_CODE=IPC.n_ProvinceCode
WHERE IPC.n_ProvinceCode=19
AND IPC.n_PatentStatus=3
AND n_PatentYear=YEAR(@d_StartDate)-4
GROUP BY TAP.PROVINCE_NAME,IPC.s_IndustryName
) T_T1 ON T_T1.s_Area=T_Total.s_Area AND T_T1.s_IndustryName=T_Total.s_IndustryName
LEFT JOIN (
SELECT TAP.PROVINCE_NAME AS s_Area,IPC.s_IndustryName AS s_IndustryName,
SUM(CASE WHEN IPC.n_PatentType=1 THEN IPC.f_Count END) AS n_PTotal,
SUM(CASE WHEN IPC.n_PatentType=2 THEN IPC.f_Count END) AS n_UTotal,
SUM(IPC.f_Count) AS n_Total 
FROM T_PatentChartIPCBaseData IPC
LEFT JOIN T_AddrProvince TAP ON TAP.PROVINCE_CODE=IPC.n_ProvinceCode
WHERE IPC.n_ProvinceCode=19
AND IPC.n_PatentStatus=3
AND n_PatentYear=YEAR(@d_StartDate)-3
GROUP BY TAP.PROVINCE_NAME,IPC.s_IndustryName
) T_T2 ON T_T2.s_Area=T_Total.s_Area AND T_T2.s_IndustryName=T_Total.s_IndustryName
LEFT JOIN (
SELECT TAP.PROVINCE_NAME AS s_Area,IPC.s_IndustryName AS s_IndustryName,
SUM(CASE WHEN IPC.n_PatentType=1 THEN IPC.f_Count END) AS n_PTotal,
SUM(CASE WHEN IPC.n_PatentType=2 THEN IPC.f_Count END) AS n_UTotal,
SUM(IPC.f_Count) AS n_Total 
FROM T_PatentChartIPCBaseData IPC
LEFT JOIN T_AddrProvince TAP ON TAP.PROVINCE_CODE=IPC.n_ProvinceCode
WHERE IPC.n_ProvinceCode=19
AND IPC.n_PatentStatus=3
AND n_PatentYear=YEAR(@d_StartDate)-2
GROUP BY TAP.PROVINCE_NAME,IPC.s_IndustryName
) T_T3 ON T_T3.s_Area=T_Total.s_Area AND T_T3.s_IndustryName=T_Total.s_IndustryName
LEFT JOIN (
SELECT TAP.PROVINCE_NAME AS s_Area,IPC.s_IndustryName AS s_IndustryName,
SUM(CASE WHEN IPC.n_PatentType=1 THEN IPC.f_Count END) AS n_PTotal,
SUM(CASE WHEN IPC.n_PatentType=2 THEN IPC.f_Count END) AS n_UTotal,
SUM(IPC.f_Count) AS n_Total 
FROM T_PatentChartIPCBaseData IPC
LEFT JOIN T_AddrProvince TAP ON TAP.PROVINCE_CODE=IPC.n_ProvinceCode
WHERE IPC.n_ProvinceCode=19
AND IPC.n_PatentStatus=3
AND n_PatentYear=YEAR(@d_StartDate)-1
GROUP BY TAP.PROVINCE_NAME,IPC.s_IndustryName
) T_T4 ON T_T4.s_Area=T_Total.s_Area AND T_T4.s_IndustryName=T_Total.s_IndustryName
LEFT JOIN (
SELECT TAP.PROVINCE_NAME AS s_Area,IPC.s_IndustryName AS s_IndustryName,
SUM(CASE WHEN IPC.n_PatentType=1 THEN IPC.f_Count END) AS n_PTotal,
SUM(CASE WHEN IPC.n_PatentType=2 THEN IPC.f_Count END) AS n_UTotal,
SUM(IPC.f_Count) AS n_Total 
FROM T_PatentChartIPCBaseData IPC
LEFT JOIN T_AddrProvince TAP ON TAP.PROVINCE_CODE=IPC.n_ProvinceCode
WHERE IPC.n_ProvinceCode=19
AND IPC.n_PatentStatus=3
AND n_PatentYear=YEAR(@d_StartDate)
GROUP BY TAP.PROVINCE_NAME,IPC.s_IndustryName
) T_T5 ON T_T5.s_Area=T_Total.s_Area AND T_T5.s_IndustryName=T_Total.s_IndustryName   
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>

  <!--SIPO数据 -->
  <dataCommand name="loadSIPO" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[             
                DECLARE @s_Year nchar(10)=@d_Year
                DECLARE @s_Month nchar(10)=@d_Month
                DECLARE @actualMonth int;
                            SELECT TOP 1 @actualMonth=d_Month
                            FROM T_SIPOData WHERE d_Year=@s_Year AND d_Month<=@s_Month AND n_Type=@n_Type 
                            GROUP BY d_Month 
                            ORDER BY d_Month DESC  
  
                            SELECT s_AreaCN
                                          ,d_Year
                                          ,d_Month
                                          ,n_Type
                                          ,n_TotalCount
                                          ,n_CurYearCount
                                          ,n_CurMonthCount
                                          ,n_PCount
                                          ,d_PCountPerMillion
                                          ,n_UCount
                                          ,n_DCount
                                          ,n_GRCount
                                          ,n_DZCount
                                          ,n_KYCount
                                          ,n_QYCount
                                          ,n_JGCount
                                          ,AREA_TYPE
                                          ,PROVINCE_CODE
                            FROM [dbo].[T_SIPOData] AS Tsipo WITH(NOLOCK)
                            LEFT JOIN dbo.T_AddrProvince AS Tprovince WITH(NOLOCK)
                                ON LEFT(Tprovince.PROVINCE_NAME,2) = Tsipo.s_AreaCN 
                            WHERE  n_Type=@n_Type
                                AND d_Year=@s_Year
                                AND d_Month=ISNULL(@actualMonth,1)
                            ORDER BY n_CurYearCount DESC
      ]]>
    </commandText>
    <parameters>
      <param name="@n_Type" dbType="Int32" direction="Input"/>
      <param name="@d_Year" dbType="String" direction="Input"/>
      <param name="@d_Month" dbType="String" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--SIPO数据-时间段 -->
  <dataCommand name="loadSIPO_Period" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
              DECLARE @s_StartYear nchar(10)=Year(@d_StartDate)
              DECLARE @s_StartMonth nchar(10)=MONTH(@d_StartDate)
              DECLARE @s_EndYear nchar(10)=Year(@d_EndDate)
              DECLARE @s_EndMonth nchar(10)=MONTH(@d_EndDate)
              select s_AreaCN
                        ,SUM(n_CurMonthCount) n_TotalCount
                        ,SUM(n_PCount) n_PCount
                        ,SUM(n_UCount) n_UCount
                        ,SUM(n_DCount) n_DCount
                        ,SUM(n_GRCount) n_GRCount
                        ,SUM(n_DZCount) n_DZCount
                        ,SUM(n_KYCount) n_KYCount
                        ,SUM(n_QYCount) n_QYCount
                        ,SUM(n_JGCount) n_JGCount
                        ,PROVINCE_CODE
                        ,AREA_TYPE
              FROM [dbo].[T_SIPOData] AS Tsipo WITH(NOLOCK)
              LEFT JOIN dbo.T_AddrProvince AS Tprovince WITH(NOLOCK)
                ON LEFT(Tprovince.PROVINCE_NAME,2) = Tsipo.s_AreaCN
              WHERE  
                      n_Type=@n_Type
                      AND 		                
                      (d_Year>@s_StartYear OR (d_Year=@s_StartYear AND d_Month>=@s_StartMonth))
                      AND
                      (d_Year<@s_EndYear OR (d_Year=@s_EndYear AND d_Month<=@s_EndMonth))
              GROUP BY s_AreaCN,PROVINCE_CODE,AREA_TYPE         
      ]]>
    </commandText>
    <parameters>
      <param name="@n_Type" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--全国各地区有效发明申请受理状况环比增长-->
  <dataCommand name="loadDataQGZL_YXFM_HBZZ" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
                DECLARE @actualMonth int;
                SELECT TOP 1 @actualMonth=d_Month
                FROM T_SIPOData WHERE d_Year=@d_Year AND d_Month<=@d_Month AND n_Type=2
                GROUP BY d_Month 
                ORDER BY d_Month DESC  
               SELECT s_AreaCN ,n_CurYearCount INTO #TANow FROM dbo.T_SIPOData         
                WHERE 
                (
                n_Type=2
                AND d_Year=@d_Year
                AND d_Month=ISNULL(@actualMonth,1)
                )
                SELECT s_AreaCN ,n_CurYearCount INTO #TALast FROM dbo.T_SIPOData         
                WHERE 
                (
                n_Type=2
                AND d_Year=@d_Year AND d_Month=ISNULL(@actualMonth,1)-1
                )

                select 
                 s_AreaCN=#TANOW.s_AreaCN
                ,curCount=#TANow.n_CurYearCount
                ,lastCount=#TALast.n_CurYearCount
                ,RATE=CASE WHEN #TALast.n_CurYearCount !=0 AND #TALast.n_CurYearCount IS NOT NULL 
	                  THEN (#TANow.n_CurYearCount-#TALast.n_CurYearCount)*1.0/#TALast.n_CurYearCount 
	                  ELSE 0
                    END
                 from 
                #TANow
                LEFT JOIN  #TALast
                ON #TANOW.s_AreaCN=#TALast.s_AreaCN
                drop table #TANOW
                drop table #TALast
      ]]>
    </commandText>
    <parameters>
      <param name="@d_Year" dbType="Int32" direction="Input"/>
      <param name="@d_Month" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东省地级市和顺德区的【申请-某种专利类型】受理量和增长率-->
  <dataCommand name="loadCity_SQ_1_Count_ZZL" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
                --不包括佛山
                SELECT
                                CITY_NAME as name,
                                curCount,
                                lastCount,
                                rate=
                                (
	                                CASE 
	                                WHEN lastCount!=0	
	                                THEN
		                                (curCount-lastCount)*1.0/CAST(lastCount AS FLOAT)
	                                ELSE 0	
	                                END
                                )
                                INTO #T_NoFoshan
                                FROM
                                (
	                                SELECT 
	                                n_CityCode,
	                                SUM(f_Count) curCount
	                                FROM dbo.T_PatentChartBaseData WITH(NOLOCK)
	                                WHERE 
	                                (
		                                (n_PatentYear>YEAR(@dtStart) OR (n_PatentYear=YEAR(@dtStart)  AND n_PatentMonth>=MONTH(@dtStart)))
		                                AND
		                                (n_PatentYear<YEAR(@dtEnd) OR (n_PatentYear=YEAR(@dtEnd) AND n_PatentMonth<=MONTH(@dtEnd)))
		                                AND n_ProvinceCode=@n_ProvinceCode
		                                AND n_PatentStatus=1	
		                                AND (n_PatentType = @n_PatentType or @n_PatentType=0)
		                                AND n_CityCode!=9999
		                                AND n_CityCode!=68
	                                )
	                                GROUP BY n_CityCode	
                                )AS CurT
                                LEFT JOIN
                                (
	                                SELECT 
	                                n_CityCode,
	                                SUM(f_Count) lastCount
	                                FROM dbo.T_PatentChartBaseData WITH(NOLOCK)
	                                WHERE 
	                                (
		                                (n_PatentYear>YEAR(@dtStart)-1 OR (n_PatentYear=YEAR(@dtStart)-1  AND n_PatentMonth>=MONTH(@dtStart)))
		                                AND
		                                (n_PatentYear<YEAR(@dtEnd)-1 OR (n_PatentYear=YEAR(@dtEnd)-1 AND n_PatentMonth<=MONTH(@dtEnd)))
		                                AND n_ProvinceCode=@n_ProvinceCode
		                                AND n_PatentStatus=1	
		                                AND (n_PatentType = @n_PatentType or @n_PatentType=0)
		                                AND n_CityCode!=9999
		                                AND n_CityCode!=68
	                                )
	                                GROUP BY n_CityCode
                                )AS LastT ON CurT.n_CityCode=LastT.n_CityCode
                                LEFT JOIN
                                (
	                                SELECT CITY_NAME,CITY_CODE FROM dbo.T_AddrCity WITH(NOLOCK)
                                ) AS cityT ON cityT.CITY_CODE=CurT.n_CityCode

                --佛山
                SELECT
                                CITY_NAME as name,
                                curCount,
                                lastCount,
                                rate=
                                (
	                                CASE 
	                                WHEN lastCount!=0	
	                                THEN
		                                (curCount-lastCount)*1.0/CAST(lastCount AS FLOAT)
	                                ELSE 0	
	                                END
                                )
                                INTO #T_Foshan
                                FROM
                                (
	                                SELECT 
	                                n_CityCode,
	                                SUM(f_Count) curCount
	                                FROM dbo.T_PatentChartBaseData WITH(NOLOCK)
	                                WHERE 
	                                (
		                                (n_PatentYear>YEAR(@dtStart) OR (n_PatentYear=YEAR(@dtStart)  AND n_PatentMonth>=MONTH(@dtStart)))
		                                AND
		                                (n_PatentYear<YEAR(@dtEnd) OR (n_PatentYear=YEAR(@dtEnd) AND n_PatentMonth<=MONTH(@dtEnd)))
		                                AND n_ProvinceCode=@n_ProvinceCode
		                                AND n_PatentStatus=1	
		                                AND (n_PatentType = @n_PatentType or @n_PatentType=0)
		                                AND n_CityCode=68
	                                )
	                                GROUP BY n_CityCode	
                                )AS CurT
                                LEFT JOIN
                                (
	                                SELECT 
	                                n_CityCode,
	                                SUM(f_Count) lastCount
	                                FROM dbo.T_PatentChartBaseData WITH(NOLOCK)
	                                WHERE 
	                                (
		                                (n_PatentYear>YEAR(@dtStart)-1 OR (n_PatentYear=YEAR(@dtStart)-1  AND n_PatentMonth>=MONTH(@dtStart)))
		                                AND
		                                (n_PatentYear<YEAR(@dtEnd)-1 OR (n_PatentYear=YEAR(@dtEnd)-1 AND n_PatentMonth<=MONTH(@dtEnd)))
		                                AND n_ProvinceCode=@n_ProvinceCode
		                                AND n_PatentStatus=1	
		                                AND (n_PatentType = @n_PatentType or @n_PatentType=0)
		                                AND n_CityCode=68
	                                )
	                                GROUP BY n_CityCode
                                )AS LastT ON CurT.n_CityCode=LastT.n_CityCode
                                LEFT JOIN
                                (
	                                SELECT CITY_NAME,CITY_CODE FROM dbo.T_AddrCity WITH(NOLOCK)
                                ) AS cityT ON cityT.CITY_CODE=CurT.n_CityCode

                --顺德
                                SELECT 
	                                name='顺德区',
	                                curCount,
	                                lastCount,
	                                rate=
	                                (
		                                CASE 
		                                WHEN lastCount!=0	
		                                THEN
			                                (curCount-lastCount)*1.0/CAST(lastCount as float)
		                                ELSE 0	
		                                END
	                                )
	                                INTO #T_ShunDe
	                            FROM 
                                (
	                                SELECT 
		                                n_CityCode=999,
		                                COUNT(0)curCount		
	                                FROM
		                                (
		                                SELECT s_ApplicationNO,s_Area FROM dbo.T_Applicants WITH(NOLOCK)
		                                WHERE 
			                                s_Area=71
		                                )AS Temp
	                                LEFT JOIN
		                                (
			                                SELECT s_ApplicationNO,dt_ApplyDate FROM dbo.T_PatentStatus WITH(NOLOCK)
		                                ) AS Temp1 ON Temp.s_ApplicationNO=Temp1.s_ApplicationNO
	                                LEFT JOIN
		                                (
			                                SELECT Application_NO,s_PatentType FROM dbo.T_PatentCase WITH(NOLOCK)
		                                ) AS Temp2 ON Temp.s_ApplicationNO=Temp2.Application_NO
	                                WHERE
	                                (
		                                Temp1.dt_ApplyDate<=@dtEnd
	                                  AND
		                                Temp1.dt_ApplyDate>=@dtStart
		                                AND (s_PatentType = @n_PatentType or @n_PatentType=0)
	                                )
                                )as CurT
                                LEFT JOIN
                                (
	                                SELECT 
		                                n_CityCode=999,
		                                COUNT(0)lastCount
	                                FROM
		                                (
		                                SELECT s_ApplicationNO,s_Area FROM dbo.T_Applicants WITH(NOLOCK)
		                                WHERE 
			                                s_Area=71
		                                )AS Temp
	                                LEFT JOIN
		                                (
			                                SELECT s_ApplicationNO,dt_ApplyDate FROM dbo.T_PatentStatus WITH(NOLOCK)
		                                ) AS Temp1 ON Temp.s_ApplicationNO=Temp1.s_ApplicationNO
	                                LEFT JOIN
		                                (
			                                SELECT Application_NO,s_PatentType FROM dbo.T_PatentCase WITH(NOLOCK)
		                                ) AS Temp2 ON Temp.s_ApplicationNO=Temp2.Application_NO
	                                WHERE
	                                (
		                                Temp1.dt_ApplyDate<= DATEADD(yy,-1,@dtEnd)
	                                  AND
		                                Temp1.dt_ApplyDate>=DATEADD(yy,-1,@dtStart)
		                                AND (s_PatentType = @n_PatentType or @n_PatentType=0)
	                                )
                                )as LastT ON CurT.n_CityCode=LastT.n_CityCode
                                ORDER BY rate desc

   

                DECLARE @FoShanCur INT;
                DECLARE @FoShanLast INT;
                DECLARE @ShundeCur INT;
                DECLARE @ShundeLast INT;
                SELECT @FoShanCur=curCount,@FoShanLast=lastCount FROM #T_Foshan
                SELECT @ShundeCur=curCount,@ShundeLast=lastCount FROM #T_ShunDe

                SELECT * FROM
                (
                SELECT * FROM #T_NoFoshan
                UNION
                SELECT * FROM #T_ShunDe
                UNION
                SELECT
	                name='佛山市（不含顺德区）',
	                curCount=@FoShanCur-@ShundeCur,
	                lastCount=@FoShanLast-@ShundeLast,
	                rate=
	                (
		                CASE 
		                WHEN (@FoShanLast-@ShundeLast)!=0	
		                THEN
		                ((@FoShanCur-@ShundeCur)-(@FoShanLast-@ShundeLast))*1.0/CAST((@FoShanLast-@ShundeLast) as float)
		                ELSE 0	
		                END
	                ) 
                )TEMP ORDER BY rate DESC   
	     
                DROP TABLE #T_NoFoshan
                DROP TABLE #T_Foshan
                DROP TABLE #T_ShunDe
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东省地级市和顺德区的【授权-某种专利类型】数量和增长率-->
  <dataCommand name="loadCity_SQ_3_Count_ZZL" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
                --不包括佛山
                SELECT
                                CITY_NAME as name,
                                curCount,
                                lastCount,
                                rate=
                                (
	                                CASE 
	                                WHEN lastCount!=0	
	                                THEN
		                                (curCount-lastCount)*1.0/CAST(lastCount AS FLOAT)
	                                ELSE 0	
	                                END
                                )
                                INTO #T_NoFoshan
                                FROM
                                (
	                                SELECT 
	                                n_CityCode,
	                                SUM(f_Count) curCount
	                                FROM dbo.T_PatentChartBaseData WITH(NOLOCK)
	                                WHERE 
	                                (
		                                (n_PatentYear>YEAR(@dtStart) OR (n_PatentYear=YEAR(@dtStart)  AND n_PatentMonth>=MONTH(@dtStart)))
		                                AND
		                                (n_PatentYear<YEAR(@dtEnd) OR (n_PatentYear=YEAR(@dtEnd) AND n_PatentMonth<=MONTH(@dtEnd)))
		                                AND n_ProvinceCode=@n_ProvinceCode
		                                AND n_PatentStatus=3	
		                                AND (n_PatentType = @n_PatentType or @n_PatentType=0)
		                                AND n_CityCode!=9999
		                                AND n_CityCode!=68
	                                )
	                                GROUP BY n_CityCode	
                                )AS CurT
                                LEFT JOIN
                                (
	                                SELECT 
	                                n_CityCode,
	                                SUM(f_Count) lastCount
	                                FROM dbo.T_PatentChartBaseData WITH(NOLOCK)
	                                WHERE 
	                                (
		                                (n_PatentYear>YEAR(@dtStart)-1 OR (n_PatentYear=YEAR(@dtStart)-1  AND n_PatentMonth>=MONTH(@dtStart)))
		                                AND
		                                (n_PatentYear<YEAR(@dtEnd)-1 OR (n_PatentYear=YEAR(@dtEnd)-1 AND n_PatentMonth<=MONTH(@dtEnd)))
		                                AND n_ProvinceCode=@n_ProvinceCode
		                                AND n_PatentStatus=3	
		                                AND (n_PatentType = @n_PatentType or @n_PatentType=0)
		                                AND n_CityCode!=9999
		                                AND n_CityCode!=68
	                                )
	                                GROUP BY n_CityCode
                                )AS LastT ON CurT.n_CityCode=LastT.n_CityCode
                                LEFT JOIN
                                (
	                                SELECT CITY_NAME,CITY_CODE FROM dbo.T_AddrCity WITH(NOLOCK)
                                ) AS cityT ON cityT.CITY_CODE=CurT.n_CityCode

                --佛山
                SELECT
                                CITY_NAME as name,
                                curCount,
                                lastCount,
                                rate=
                                (
	                                CASE 
	                                WHEN lastCount!=0	
	                                THEN
		                                (curCount-lastCount)*1.0/CAST(lastCount AS FLOAT)
	                                ELSE 0	
	                                END
                                )
                                INTO #T_Foshan
                                FROM
                                (
	                                SELECT 
	                                n_CityCode,
	                                SUM(f_Count) curCount
	                                FROM dbo.T_PatentChartBaseData WITH(NOLOCK)
	                                WHERE 
	                                (
		                                (n_PatentYear>YEAR(@dtStart) OR (n_PatentYear=YEAR(@dtStart)  AND n_PatentMonth>=MONTH(@dtStart)))
		                                AND
		                                (n_PatentYear<YEAR(@dtEnd) OR (n_PatentYear=YEAR(@dtEnd) AND n_PatentMonth<=MONTH(@dtEnd)))
		                                AND n_ProvinceCode=@n_ProvinceCode
		                                AND n_PatentStatus=3	
		                                AND (n_PatentType = @n_PatentType or @n_PatentType=0)
		                                AND n_CityCode=68
	                                )
	                                GROUP BY n_CityCode	
                                )AS CurT
                                LEFT JOIN
                                (
	                                SELECT 
	                                n_CityCode,
	                                SUM(f_Count) lastCount
	                                FROM dbo.T_PatentChartBaseData WITH(NOLOCK)
	                                WHERE 
	                                (
		                                (n_PatentYear>YEAR(@dtStart)-1 OR (n_PatentYear=YEAR(@dtStart)-1  AND n_PatentMonth>=MONTH(@dtStart)))
		                                AND
		                                (n_PatentYear<YEAR(@dtEnd)-1 OR (n_PatentYear=YEAR(@dtEnd)-1 AND n_PatentMonth<=MONTH(@dtEnd)))
		                                AND n_ProvinceCode=@n_ProvinceCode
		                                AND n_PatentStatus=3	
		                                AND (n_PatentType = @n_PatentType or @n_PatentType=0)
		                                AND n_CityCode=68
	                                )
	                                GROUP BY n_CityCode
                                )AS LastT ON CurT.n_CityCode=LastT.n_CityCode
                                LEFT JOIN
                                (
	                                SELECT CITY_NAME,CITY_CODE FROM dbo.T_AddrCity WITH(NOLOCK)
                                ) AS cityT ON cityT.CITY_CODE=CurT.n_CityCode

                --顺德
                                SELECT 
	                                name='顺德区',
	                                curCount,
	                                lastCount,
	                                rate=
	                                (
		                                CASE 
		                                WHEN lastCount!=0	
		                                THEN
			                                (curCount-lastCount)*1.0/CAST(lastCount as float)
		                                ELSE 0	
		                                END
	                                )
	                                INTO #T_ShunDe
	                            FROM 
                                (
	                                SELECT 
		                                n_CityCode=999,
		                                COUNT(0)curCount		
	                                FROM
		                                (
		                                SELECT s_ApplicationNO,s_Area FROM dbo.T_Applicants WITH(NOLOCK)
		                                WHERE 
			                                s_Area=71
		                                )AS Temp
	                                LEFT JOIN
		                                (
			                                SELECT s_ApplicationNO,dt_AuthorizeDate FROM dbo.T_PatentStatus WITH(NOLOCK)
		                                ) AS Temp1 ON Temp.s_ApplicationNO=Temp1.s_ApplicationNO
	                                LEFT JOIN
		                                (
			                                SELECT Application_NO,s_PatentType FROM dbo.T_PatentCase WITH(NOLOCK)
		                                ) AS Temp2 ON Temp.s_ApplicationNO=Temp2.Application_NO
	                                WHERE
	                                (
		                                Temp1.dt_AuthorizeDate<=@dtEnd
	                                  AND
		                                Temp1.dt_AuthorizeDate>=@dtStart
		                                AND (s_PatentType = @n_PatentType or @n_PatentType=0)
	                                )
                                )as CurT
                                LEFT JOIN
                                (
	                                SELECT 
		                                n_CityCode=999,
		                                COUNT(0)lastCount
	                                FROM
		                                (
		                                SELECT s_ApplicationNO,s_Area FROM dbo.T_Applicants WITH(NOLOCK)
		                                WHERE 
			                                s_Area=71
		                                )AS Temp
	                                LEFT JOIN
		                                (
			                                SELECT s_ApplicationNO,dt_AuthorizeDate FROM dbo.T_PatentStatus WITH(NOLOCK)
		                                ) AS Temp1 ON Temp.s_ApplicationNO=Temp1.s_ApplicationNO
	                                LEFT JOIN
		                                (
			                                SELECT Application_NO,s_PatentType FROM dbo.T_PatentCase WITH(NOLOCK)
		                                ) AS Temp2 ON Temp.s_ApplicationNO=Temp2.Application_NO
	                                WHERE
	                                (
		                                Temp1.dt_AuthorizeDate<= DATEADD(yy,-1,@dtEnd)
	                                  AND
		                                Temp1.dt_AuthorizeDate>=DATEADD(yy,-1,@dtStart)
		                                AND (s_PatentType = @n_PatentType or @n_PatentType=0)
	                                )
                                )as LastT ON CurT.n_CityCode=LastT.n_CityCode
                                ORDER BY rate desc

   

                DECLARE @FoShanCur INT;
                DECLARE @FoShanLast INT;
                DECLARE @ShundeCur INT;
                DECLARE @ShundeLast INT;
                SELECT @FoShanCur=curCount,@FoShanLast=lastCount FROM #T_Foshan
                SELECT @ShundeCur=curCount,@ShundeLast=lastCount FROM #T_ShunDe

                SELECT * FROM
                (
                SELECT * FROM #T_NoFoshan
                UNION
                SELECT * FROM #T_ShunDe
                UNION
                SELECT
	                name='佛山市（不含顺德区）',
	                curCount=@FoShanCur-@ShundeCur,
	                lastCount=@FoShanLast-@ShundeLast,
	                rate=
	                (
		                CASE 
		                WHEN (@FoShanLast-@ShundeLast)!=0	
		                THEN
		                ((@FoShanCur-@ShundeCur)-(@FoShanLast-@ShundeLast))*1.0/CAST((@FoShanLast-@ShundeLast) as float)
		                ELSE 0	
		                END
	                ) 
                )TEMP ORDER BY rate desc   
	     
                DROP TABLE #T_NoFoshan
                DROP TABLE #T_Foshan
                DROP TABLE #T_ShunDe
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>

  <!--五种专利类型人增长率-可根据专利类型筛选 -->
  <dataCommand name="loadDataSZZLSQ_ListFrm_1_8_1" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[  
        DECLARE @T_ApplicanterType Table(n_ApplicanterType int null,s_ApplicanterTypeName varchar(100) null)

        INSERT INTO @T_ApplicanterType(n_ApplicanterType,s_ApplicanterTypeName)VALUES (1, '大专院校')
        INSERT INTO @T_ApplicanterType(n_ApplicanterType,s_ApplicanterTypeName)VALUES (2, '科研机构')
        INSERT INTO @T_ApplicanterType(n_ApplicanterType,s_ApplicanterTypeName)VALUES (3, '企业')
        INSERT INTO @T_ApplicanterType(n_ApplicanterType,s_ApplicanterTypeName)VALUES (4, '机关团体')
        INSERT INTO @T_ApplicanterType(n_ApplicanterType,s_ApplicanterTypeName )VALUES (5, '个人')

        select 
         n_ApplicanterType =CASE WHEN CurT.n_ApplicanterType IS null Then LastT.n_ApplicanterType else CurT.n_ApplicanterType end
        ,curCount
        ,lastCount
        ,Rate= case when lastCount!=0 then (curCount-lastCount)*100.0/CAST(lastCount as float) else 0 end
        ,s_ApplicanterTypeName
        from @T_ApplicanterType T_P  
        left join  
        (
        select 
        n_ApplicanterType,
         SUM(f_Count) curCount
         from dbo.T_PatentChartBaseData  WITH(NOLOCK)
        where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus
        and  (n_PatentType = @n_PatentType OR @n_PatentType=0)
        and (Year(@d_StartDate)<n_PatentYear 
             or (Year(@d_StartDate)=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
        and (Year(@d_EndDate)>n_PatentYear 
             or (Year(@d_EndDate)=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
         group by n_ApplicanterType
         ) as CurT on T_P.n_ApplicanterType=CurT.n_ApplicanterType
         left join  
         (
         select 
        n_ApplicanterType,
         SUM(f_Count) lastCount
         from dbo.T_PatentChartBaseData  WITH(NOLOCK)
        where  n_ProvinceCode=@n_ProvinceCode and n_PatentStatus=@n_PatentStatus
        and (n_PatentType = @n_PatentType OR @n_PatentType=0)
        and (Year(DATEADD(YYYY,-1,@d_StartDate))<n_PatentYear 
             or (Year(DATEADD(YYYY,-1,@d_StartDate))=n_PatentYear and MONTH(@d_StartDate)<=n_PatentMonth))
        and (Year(DATEADD(YYYY,-1,@d_EndDate))>n_PatentYear 
             or (Year(DATEADD(YYYY,-1,@d_EndDate))=n_PatentYear and MONTH(@d_EndDate)>=n_PatentMonth)) 
         group by n_ApplicanterType
         ) as LastT on T_P.n_ApplicanterType=LastT.n_ApplicanterType
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东省地级市申请、授权量和增长率（不区分顺德）-->
  <dataCommand name="loadCity_Count_ZZL" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        SELECT * FROM
        (
                  SELECT
                  CITY_NAME as CITY_NAME,
                  curCount,
                  lastCount,
                  rate=
                  (
	                  CASE 
	                  WHEN lastCount!=0	
	                  THEN
		                  ROUND( (curCount-lastCount)*1.0/CAST(lastCount AS FLOAT),4)
	                  ELSE 0	
	                  END
                  )
                  FROM
                  (
	                  SELECT 
	                  n_CityCode,
	                  SUM(f_Count) curCount
	                  FROM dbo.T_PatentChartBaseData WITH(NOLOCK)
	                  WHERE 
	                  (
		                  (n_PatentYear>@s_StartYear OR (n_PatentYear=@s_StartYear AND n_PatentMonth>=@s_StartMonth))
		                  AND
		                  (n_PatentYear<@s_EndYear OR (n_PatentYear=@s_EndYear AND n_PatentMonth<=@s_EndMonth))
		                  AND n_ProvinceCode=@n_ProvinceCode
		                  AND n_PatentStatus=@s_PatentStatus
		                  AND (n_PatentType = @s_PatentType or @s_PatentType=0) 
	                  )
	                  GROUP BY n_CityCode	
                  )AS CurT
                  LEFT JOIN
                  (
	                  SELECT 
	                  n_CityCode,
	                  SUM(f_Count) lastCount
	                  FROM dbo.T_PatentChartBaseData WITH(NOLOCK)
	                  WHERE 
	                  (
		                  (n_PatentYear>@s_StartYear-1 OR (n_PatentYear=@s_StartYear-1 AND n_PatentMonth>=@s_StartMonth))
		                  AND
		                  (n_PatentYear<@s_EndYear-1 OR (n_PatentYear=@s_EndYear-1 AND n_PatentMonth<=@s_EndMonth))
		                  AND n_ProvinceCode=@n_ProvinceCode
		                  AND n_PatentStatus=@s_PatentStatus
		                  AND (n_PatentType = @s_PatentType or @s_PatentType=0) 
	                  )
	                  GROUP BY n_CityCode
                  )AS LastT ON CurT.n_CityCode=LastT.n_CityCode
                  LEFT JOIN
                  (
	                  SELECT CITY_NAME,CITY_CODE FROM dbo.T_AddrCity WITH(NOLOCK)
                  ) AS cityT ON cityT.CITY_CODE=CurT.n_CityCode
        ) AS Temp
        WHERE CITY_NAME !='修正'
        ORDER BY rate DESC
      ]]>
    </commandText>
    <parameters>
      <param name="@s_StartYear" dbType="String" direction="Input"/>
      <param name="@s_StartMonth" dbType="String" direction="Input"/>
      <param name="@s_EndYear" dbType="String" direction="Input"/>
      <param name="@s_EndMonth" dbType="String" direction="Input"/>
      <param name="@s_PatentType" dbType="Int32" direction="Input"/>
      <param name="@s_PatentStatus" dbType="String" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--广东省地级市申请、授权量和增长率（区分顺德）-->
  <dataCommand name="loadCity_Count_ZZL_ExtShunde" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
              SELECT * FROM 
              (
	              SELECT
					              CITY_NAME as CITY_NAME,
					              curCount,
					              lastCount,
					              rate=
					              (
						              CASE 
						              WHEN lastCount!=0	
						              THEN
							              ROUND( (curCount-lastCount)*1.0/CAST(lastCount AS FLOAT),4)
						              ELSE 0	
						              END
					              )
					              FROM
					              (
						              SELECT 
						              n_CityCode,
						              SUM(f_Count) curCount
						              FROM dbo.T_PatentChartBaseData WITH(NOLOCK)
						              WHERE 
						              (
							              (n_PatentYear>@s_StartYear OR (n_PatentYear=@s_StartYear AND n_PatentMonth>=@s_StartMonth))
							              AND
							              (n_PatentYear<@s_EndYear OR (n_PatentYear=@s_EndYear AND n_PatentMonth<=@s_EndMonth))
							              AND n_ProvinceCode=@n_ProvinceCode
							              AND n_PatentStatus=@n_PatentStatus
							              AND (n_PatentType = @n_PatentType or @n_PatentType=0) 
							              AND n_CityCode !=68
						              )
						              GROUP BY n_CityCode	
					              )AS CurT
					              LEFT JOIN
					              (
						              SELECT 
						              n_CityCode,
						              SUM(f_Count) lastCount
						              FROM dbo.T_PatentChartBaseData WITH(NOLOCK)
						              WHERE 
						              (
							              (n_PatentYear>@s_StartYear-1 OR (n_PatentYear=@s_StartYear-1 AND n_PatentMonth>=@s_StartMonth))
							              AND
							              (n_PatentYear<@s_EndYear-1 OR (n_PatentYear=@s_EndYear-1 AND n_PatentMonth<=@s_EndMonth))
							              AND n_ProvinceCode=@n_ProvinceCode
							              AND n_PatentStatus=@n_PatentStatus
							              AND (n_PatentType = @n_PatentType or @n_PatentType=0) 
							              AND n_CityCode !=68
						              )
						              GROUP BY n_CityCode
					              )AS LastT ON CurT.n_CityCode=LastT.n_CityCode
					              LEFT JOIN
					              (
						              SELECT CITY_NAME,CITY_CODE FROM dbo.T_AddrCity WITH(NOLOCK)
					              ) AS cityT ON cityT.CITY_CODE=CurT.n_CityCode               
	               
					              UNION ALL
	                
					              SELECT
					              CITY_NAME ='顺德区',
					              curCount,
					              lastCount,
					              rate=
					              (
						              CASE 
						              WHEN lastCount!=0	
						              THEN
							              ROUND( (curCount-lastCount)*1.0/CAST(lastCount AS decimal(18,4)),4)
						              ELSE 0	
						              END
					              )
					              FROM
					              (
						              SELECT 
						              n_CityCode,
						              SUM(f_Count) curCount
						              FROM dbo.T_PatentChartApplyData_Ext WITH(NOLOCK)
						              WHERE 
						              (
							              (d_DataYear>@s_StartYear OR (d_DataYear=@s_StartYear AND d_DataMonth>=@s_StartMonth))
							              AND
							              (d_DataYear<@s_EndYear OR (d_DataYear=@s_EndYear AND d_DataMonth<=@s_EndMonth))
							              AND n_ProvinceCode=@n_ProvinceCode
							              AND n_PatentStatus=@n_PatentStatus
							              AND (n_PatentType = @n_PatentType or @n_PatentType=0) 
							              AND n_AreaCode=71
							              AND n_ApplySource=0
							              AND n_CityCode=68
						              )
						              GROUP BY n_CityCode	
					              )AS CurT
					              LEFT JOIN
					              (
						              SELECT 
						              n_CityCode,
						              SUM(f_Count) lastCount
						              FROM dbo.T_PatentChartApplyData_Ext WITH(NOLOCK)
						              WHERE 
						              (
							              (d_DataYear>@s_StartYear-1 OR (d_DataYear=@s_StartYear-1 AND d_DataMonth>=@s_StartMonth))
							              AND
							              (d_DataYear<@s_EndYear-1 OR (d_DataYear=@s_EndYear-1 AND d_DataMonth<=@s_EndMonth))
							              AND n_ProvinceCode=@n_ProvinceCode
							              AND n_PatentStatus=@n_PatentStatus
							              AND (n_PatentType = @n_PatentType or @n_PatentType=0) 
							              AND n_AreaCode=71
							              AND n_ApplySource=0
							              AND n_CityCode=68
						              )
						              GROUP BY n_CityCode
					              )AS LastT ON CurT.n_CityCode=LastT.n_CityCode
	                
					              UNION ALL
	                
					              SELECT
					              CITY_NAME ='佛山市（不含顺德区）',
					              curCount,
					              lastCount,
					              rate=
					              (
						              CASE 
						              WHEN lastCount!=0	
						              THEN
							              ROUND( (curCount-lastCount)*1.0/CAST(lastCount AS FLOAT),4)
						              ELSE 0	
						              END
					              )
					              FROM
					              (
						              SELECT 
						              n_CityCode,
						              SUM(f_Count) curCount
						              FROM dbo.T_PatentChartApplyData_Ext WITH(NOLOCK)
						              WHERE 
						              (
							              (d_DataYear>@s_StartYear OR (d_DataYear=@s_StartYear AND d_DataMonth>=@s_StartMonth))
							              AND
							              (d_DataYear<@s_EndYear OR (d_DataYear=@s_EndYear AND d_DataMonth<=@s_EndMonth))
							              AND n_ProvinceCode=@n_ProvinceCode
							              AND n_PatentStatus=@n_PatentStatus
							              AND (n_PatentType = @n_PatentType or @n_PatentType=0) 
							              AND n_AreaCode!=71
							              AND n_ApplySource=0
							              AND n_CityCode=68
						              )
						              GROUP BY n_CityCode	
					              )AS CurT
					              LEFT JOIN
					              (
						              SELECT 
						              n_CityCode,
						              SUM(f_Count) lastCount
						              FROM dbo.T_PatentChartApplyData_Ext WITH(NOLOCK)
						              WHERE 
						              (
							              (d_DataYear>@s_StartYear-1 OR (d_DataYear=@s_StartYear-1 AND d_DataMonth>=@s_StartMonth))
							              AND
							              (d_DataYear<@s_EndYear-1 OR (d_DataYear=@s_EndYear-1 AND d_DataMonth<=@s_EndMonth))
							              AND n_ProvinceCode=@n_ProvinceCode
							              AND n_PatentStatus=@n_PatentStatus
							              AND (n_PatentType = @n_PatentType or @n_PatentType=0) 
							              AND n_AreaCode!=71
							              AND n_ApplySource=0
							              AND n_CityCode=68
						              )
						              GROUP BY n_CityCode
					              )AS LastT ON CurT.n_CityCode=LastT.n_CityCode 
              ) AS Temp
              WHERE CITY_NAME !='修正'
              ORDER BY rate DESC
      ]]>
    </commandText>
    <parameters>
      <param name="@s_StartYear" dbType="Int32" direction="Input"/>
      <param name="@s_StartMonth" dbType="Int32" direction="Input"/>
      <param name="@s_EndYear" dbType="Int32" direction="Input"/>
      <param name="@s_EndMonth" dbType="Int32" direction="Input"/>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--专利数量-全国代理机构-根据代理机构代码、专利类型筛选 -->
  <dataCommand name="loadAgency_SQ_3_CN" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
            DECLARE @s_PatentType char(1)=@n_PatentType
            SELECT COUNT(0) n_Total FROM T_PatentCase TCase WITH(NOLOCK)
            INNER JOIN dbo.T_PatentStatus AS Tstatus  WITH(NOLOCK) on Tstatus.s_ApplicationNO=TCase.Application_NO
            INNER JOIN T_Applicants AS TApply WITH(NOLOCK) on TApply.s_ApplicationNO=TCase.Application_NO
            WHERE TApply.s_ApplicantSort=3
            AND Tstatus.dt_AuthorizeDate<=@dtEnd
            AND Tstatus.dt_AuthorizeDate>=@dtStart
            AND (TCase.s_PatentType = @s_PatentType or @s_PatentType='0')
            AND b_AgentTF=1   
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--专利数量-广东代理机构-根据代理机构代码、专利类型筛选 -->
  <dataCommand name="loadAgency_SQ_3_GD" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
            DECLARE @s_PatentType char(1)=@n_PatentType
            SELECT COUNT(0) n_Total FROM T_PatentCase TCase WITH(NOLOCK)
            INNER JOIN dbo.T_PatentStatus AS Tstatus  WITH(NOLOCK) on Tstatus.s_ApplicationNO=TCase.Application_NO
            INNER JOIN T_Applicants AS TApply WITH(NOLOCK) on TApply.s_ApplicationNO=TCase.Application_NO
            INNER JOIN T_Agency AS TAgency WITH(NOLOCK) ON RTRIM(TCase.s_AgencyNO)=TAgency.s_NO
            WHERE TApply.s_ApplicantSort='3'
            AND Tstatus.dt_AuthorizeDate<=@dtEnd
            AND Tstatus.dt_AuthorizeDate>=@dtStart
            AND (TCase.s_PatentType = @s_PatentType or @s_PatentType='0')
            AND b_AgentTF=1 
            AND TAgency.s_Province='19'
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--代理机构-授权TopX-->
  <dataCommand name="loadAgencyTopX_SQ_3" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
            DECLARE @s_PatentType char(1)=@n_PatentType
		        SELECT TOP (@n_TopX) s_Name s_AgentName,n_Total FROM 
		        (
			        SELECT TCase.s_AgencyNO, COUNT(TCase.s_AgencyNO) n_Total FROM T_PatentCase TCase WITH(NOLOCK)
			        INNER JOIN dbo.T_PatentStatus AS Tstatus  WITH(NOLOCK) on Tstatus.s_ApplicationNO=TCase.Application_NO
			        INNER JOIN T_Applicants AS TApply WITH(NOLOCK) on TApply.s_ApplicationNO=TCase.Application_NO
			        INNER JOIN T_Agency AS TAgency WITH(NOLOCK) ON RTRIM(TCase.s_AgencyNO)=TAgency.s_NO
			        WHERE TApply.s_ApplicantSort='3'
			        AND Tstatus.dt_AuthorizeDate<=@dtEnd
			        AND Tstatus.dt_AuthorizeDate>=@dtStart
			        AND (TCase.s_PatentType = @s_PatentType or @s_PatentType='0')
			        AND b_AgentTF=1 
			        AND TAgency.s_Province='19'
			        GROUP BY TCase.s_AgencyNO
		        )TEMP
		        LEFT JOIN T_Agency ON TEMP.s_AgencyNO=T_Agency.s_NO
		        ORDER BY n_Total DESC
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
      <param name="@n_TopX" dbType="Int32" direction="Input"/>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--某种申请人类型的数目+该种申请人的总申请\授权量-->
  <dataCommand name="loadApplicantNum_PatentNum_SQ_1" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
			      SELECT
			      COUNT(0) SingleNum 
			      INTO #Ta
			      FROM dbo.T_PatentCase as pc  WITH(NOLOCK)
			      inner join dbo.T_PatentStatus as ps  WITH(NOLOCK) on ps.s_ApplicationNO=pc.Application_NO 
			      inner join dbo.T_Applicants as ap  WITH(NOLOCK) on ap.s_ApplicationNO=pc.Application_NO  
			      WHERE ap.s_ApplicantType=@n_ApplicanterType
			      AND ap.s_ApplicantSort='1'
			      AND ps.dt_ApplyDate> @d_StartDate
			      AND ps.dt_ApplyDate< @d_EndDate
			      GROUP BY ap.s_Name			  
            
			      SELECT COUNT(SingleNum) ApplicantNum,
			      SUM(SingleNum) PatentNum FROM #Ta
			  
			      DROP TABLE #Ta
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ApplicanterType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--某种申请人类型的数目+该种申请人的总授权量-->
  <dataCommand name="loadApplicantNum_PatentNum_SQ_3" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
			      SELECT
			      COUNT(0) SingleNum 
			      INTO #Ta
			      FROM dbo.T_PatentCase as pc  WITH(NOLOCK)
			      inner join dbo.T_PatentStatus as ps  WITH(NOLOCK) on ps.s_ApplicationNO=pc.Application_NO 
			      inner join dbo.T_Applicants as ap  WITH(NOLOCK) on ap.s_ApplicationNO=pc.Application_NO  
			      inner join dbo.T_Agency as ag  WITH(NOLOCK) on ag.s_NO=pc.s_AgencyNO 
			      WHERE ap.s_ApplicantType=@n_ApplicanterType
			      AND ap.s_ApplicantSort='3'
			      AND ps.dt_AuthorizeDate> @d_StartDate
			      AND ps.dt_AuthorizeDate< @d_EndDate
			      GROUP BY ap.s_Name			  
            
			      SELECT COUNT(SingleNum) ApplicantNum,
			      SUM(SingleNum) PatentNum FROM #Ta
			  
			      DROP TABLE #Ta
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ApplicanterType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--本省各城市下属某种申请人类型的数目+该种申请人的总申请量-->
  <dataCommand name="loadApplicant_Patent_City_SQ_1" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
	          SELECT
	          ap.s_Name
	          ,COUNT(0) SingleNum 
	          ,ap.s_City
	          ,ac.CITY_NAME
	          INTO #Ta
	          FROM dbo.T_PatentCase as pc  WITH(NOLOCK)
	          inner join dbo.T_PatentStatus as ps  WITH(NOLOCK) on ps.s_ApplicationNO=pc.Application_NO 
	          inner join dbo.T_Applicants as ap  WITH(NOLOCK) on ap.s_ApplicationNO=pc.Application_NO
	          INNER JOIN dbo.T_AddrCity AS ac WITH(NOLOCK) ON ap.s_City=ac.CITY_CODE
	          WHERE ap.s_ApplicantType=@n_ApplicantType        
				        AND ap.s_ApplicantSort=1
			          AND (pc.s_PatentType = @n_PatentType OR @n_PatentType=0)
			          AND ps.dt_ApplyDate>= @d_StartDate
			          AND ps.dt_ApplyDate<= @d_EndDate
	          GROUP BY ap.s_Name
	          ,ap.s_City
	          ,ac.CITY_Name
			  
	          SELECT 
	          CITY_NAME
	          ,COUNT(0) ApplicantNum
	          ,SUM(SingleNum) PatentNum
	          FROM #Ta 
	          GROUP BY s_City,CITY_NAME
	          ORDER BY PatentNum desc
	          DROP TABLE #Ta
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ApplicantType" dbType="Int32" direction="Input"/>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--本省各城市下属某种申请人类型的数目+该种申请人的总授权量-->
  <dataCommand name="loadApplicant_Patent_City_SQ_3" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
			      SELECT
			      ap.s_Name
			      ,COUNT(0) SingleNum 
			      ,ap.s_City
			      ,ac.CITY_NAME
			      INTO #Ta
			      FROM dbo.T_PatentCase as pc  WITH(NOLOCK)
			      inner join dbo.T_PatentStatus as ps  WITH(NOLOCK) on ps.s_ApplicationNO=pc.Application_NO 
			      inner join dbo.T_Applicants as ap  WITH(NOLOCK) on ap.s_ApplicationNO=pc.Application_NO  
			      INNER JOIN dbo.T_AddrCity AS ac WITH(NOLOCK) ON ap.s_City=ac.CITY_CODE
			      WHERE ap.s_ApplicantType=@n_ApplicantType 
				      AND ap.s_ApplicantSort=3
			        AND (pc.s_PatentType = @n_PatentType OR @n_PatentType=0)
              AND ps.dt_AuthorizeDate> @d_StartDate
              AND ps.dt_AuthorizeDate< @d_EndDate
			      GROUP BY ap.s_Name
			      ,ap.s_City
			      ,ac.CITY_Name
			  
			      SELECT 
			      CITY_NAME
			      ,COUNT(0) ApplicantNum
			      ,SUM(SingleNum) PatentNum
			      FROM #Ta 
			      GROUP BY s_City,CITY_NAME
			      DROP TABLE #Ta
    ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ApplicantType" dbType="Int32" direction="Input"/>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--本省各城市下属某种申请人类型的数目+该种申请人的总申请量-->
  <dataCommand name="loadApplicant_Patent_City_SQ_1_ExtShunde" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
              DECLARE @s_ApplicantType char=@n_ApplicantType;
              DECLARE @s_PatentType char=@n_PatentType;

              SELECT
	                        ap.s_Name
	                        ,COUNT(0) SingleNum 
	                        ,ap.s_City
	                        ,ac.CITY_NAME
	                        INTO #Ta
	                        FROM dbo.T_PatentCase as pc  WITH(NOLOCK)
	                        inner join dbo.T_PatentStatus as ps  WITH(NOLOCK) on ps.s_ApplicationNO=pc.Application_NO 
	                        inner join dbo.T_Applicants as ap  WITH(NOLOCK) on ap.s_ApplicationNO=pc.Application_NO
	                        INNER JOIN dbo.T_AddrCity AS ac WITH(NOLOCK) ON ap.s_City=ac.CITY_CODE
	                        WHERE ap.s_ApplicantType=@s_ApplicantType        
				                    AND ap.s_ApplicantSort='1'
			                        AND (pc.s_PatentType = @s_PatentType OR @s_PatentType='0')
			                        AND ps.dt_ApplyDate>= @d_StartDate
			                        AND ps.dt_ApplyDate<= @d_EndDate
			                        AND ap.s_City!='68'
	                        GROUP BY ap.s_Name
	                        ,ap.s_City
	                        ,ac.CITY_Name 
	                        
	                        
	                        SELECT
	                        ap.s_Name
	                        ,COUNT(0) SingleNum 
	                        ,ap.s_City
	                        ,ac.AREA_CODE
	                        INTO #T_FoShanTotal
	                        FROM dbo.T_PatentCase as pc  WITH(NOLOCK)
	                        inner join dbo.T_PatentStatus as ps  WITH(NOLOCK) on ps.s_ApplicationNO=pc.Application_NO 
	                        inner join dbo.T_Applicants as ap  WITH(NOLOCK) on ap.s_ApplicationNO=pc.Application_NO
	                        INNER JOIN dbo.T_AddrArea AS ac WITH(NOLOCK) ON ap.s_Area=ac.AREA_CODE
	                        WHERE ap.s_ApplicantType=@s_ApplicantType        
				                    AND ap.s_ApplicantSort='1'
			                        AND (pc.s_PatentType = @s_PatentType OR @s_PatentType='0')
			                        AND ps.dt_ApplyDate>= @d_StartDate
			                        AND ps.dt_ApplyDate<= @d_EndDate
			                        AND ap.s_City='68'
	                        GROUP BY ap.s_Name
	                        ,ap.s_City
	                        ,ac.AREA_CODE                        
	                        
	                       
	                         SELECT 
	                        CITY_NAME
	                        ,COUNT(0) ApplicantNum
	                        ,SUM(SingleNum) PatentNum
	                        FROM #Ta 
	                        WHERE CITY_NAME!='修正'
	                        GROUP BY s_City,CITY_NAME
	                        UNION
	                      SELECT 
	                        CITY_NAME='顺德区'
	                        ,COUNT(0) ApplicantNum
	                        ,SUM(SingleNum) PatentNum	          
	                        FROM #T_FoShanTotal 
	                        WHERE
			                AREA_CODE='71'
	                        GROUP BY s_City
	                        UNION
	                      SELECT 
	                        CITY_NAME='佛山市（不含顺德区）'
	                        ,COUNT(0) ApplicantNum
	                        ,SUM(SingleNum) PatentNum	         
	                        FROM #T_FoShanTotal 
	                        WHERE
			                AREA_CODE!='71'
	                        GROUP BY s_City
	          
	              ORDER BY PatentNum desc
	          
	              DROP TABLE #Ta
	              DROP TABLE #T_FoShanTotal	
      ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ApplicantType" dbType="Int32" direction="Input"/>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--本省各城市下属某种申请人类型的数目+该种申请人的总授权量-->
  <dataCommand name="loadApplicant_Patent_City_SQ_3_ExtShunde" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
			      DECLARE @s_ApplicantType char=@n_ApplicantType
            DECLARE @s_PatentType char=@n_PatentType
            SELECT
	                      ap.s_Name
	                      ,COUNT(0) SingleNum 
	                      ,ap.s_City
	                      ,ac.CITY_NAME
	                      INTO #Ta
	                      FROM dbo.T_PatentCase as pc  WITH(NOLOCK)
	                      inner join dbo.T_PatentStatus as ps  WITH(NOLOCK) on ps.s_ApplicationNO=pc.Application_NO 
	                      inner join dbo.T_Applicants as ap  WITH(NOLOCK) on ap.s_ApplicationNO=pc.Application_NO
	                      INNER JOIN dbo.T_AddrCity AS ac WITH(NOLOCK) ON ap.s_City=ac.CITY_CODE
	                      WHERE ap.s_ApplicantType=@s_ApplicantType        
				                  AND ap.s_ApplicantSort='3'
			                      AND (pc.s_PatentType = @s_PatentType OR @s_PatentType='0')
			                      AND ps.dt_AuthorizeDate>= @d_StartDate
			                      AND ps.dt_AuthorizeDate<= @d_EndDate
			                      AND ap.s_City!='68'
	                      GROUP BY ap.s_Name
	                      ,ap.s_City
	                      ,ac.CITY_Name 
            SELECT
	                      ap.s_Name
	                      ,COUNT(0) SingleNum 
	                      ,ap.s_City
	                      ,ac.AREA_CODE
	                      INTO #T_FoShanTotal
	                      FROM dbo.T_PatentCase as pc  WITH(NOLOCK)
	                      inner join dbo.T_PatentStatus as ps  WITH(NOLOCK) on ps.s_ApplicationNO=pc.Application_NO 
	                      inner join dbo.T_Applicants as ap  WITH(NOLOCK) on ap.s_ApplicationNO=pc.Application_NO
	                      INNER JOIN dbo.T_AddrArea AS ac WITH(NOLOCK) ON ap.s_Area=ac.AREA_CODE
	                      WHERE ap.s_ApplicantType=@s_ApplicantType        
				                  AND ap.s_ApplicantSort='3'
			                      AND (pc.s_PatentType = @s_PatentType OR @s_PatentType='0')
			                      AND ps.dt_AuthorizeDate>= @d_StartDate
			                      AND ps.dt_AuthorizeDate<= @d_EndDate
			                      AND ap.s_City='68'
	                      GROUP BY ap.s_Name
	                      ,ap.s_City
	                      ,ac.AREA_CODE
            
	          
	          
	                    SELECT 
	                      CITY_NAME
	                      ,COUNT(0) ApplicantNum
	                      ,SUM(SingleNum) PatentNum
	                      FROM #Ta 
	                      WHERE CITY_NAME!='修正'
	                      GROUP BY s_City,CITY_NAME
	                      UNION
	                    SELECT 
	                      CITY_NAME='顺德区'
	                      ,COUNT(0) ApplicantNum
	                      ,SUM(SingleNum) PatentNum	          
	                      FROM #T_FoShanTotal 
	                      WHERE AREA_CODE='71'
	                      GROUP BY s_City
	                      UNION
	                    SELECT 
	                      CITY_NAME='佛山市（不含顺德区）'
	                      ,COUNT(0) ApplicantNum
	                      ,SUM(SingleNum) PatentNum	         
	                      FROM #T_FoShanTotal 
	                      WHERE AREA_CODE!='71'
	                      GROUP BY s_City
	          
	            ORDER BY PatentNum desc
	          
	            DROP TABLE #Ta
	            DROP TABLE #T_FoShanTotal
    ]]>
    </commandText>
    <parameters>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
      <param name="@n_ApplicantType" dbType="Int32" direction="Input"/>
      <param name="@n_PatentType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--不区分专利类型-->
  <dataCommand name="loadDataGQY_ZLSQ_SQZKT_1" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        SELECT ISNULL(SUM(f_Count),0) V_COUNT
            --,n_PatentType  V_n_PatentType
            ,n_AreaType V_n_AreaType
        --INTO #Ta
        FROM dbo.T_PatentChartBaseData WITH(NOLOCK)
        WHERE n_PatentStatus=@n_PatentStatus 
            AND (YEAR(@d_StartDate)<n_PatentYear OR (YEAR(@d_StartDate)=n_PatentYear AND MONTH(@d_StartDate)<=n_PatentMonth))
	          AND (YEAR(@d_EndDate)>n_PatentYear OR (YEAR(@d_EndDate)=n_PatentYear AND MONTH(@d_EndDate)>=n_PatentMonth))
        GROUP BY n_AreaType
          ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--图18  XXXX年1-X月 全国（某省） 发明专利 申请/授权 受理状况图示 -->
  <dataCommand name="load_Province_Patent_1_Month" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
	          SELECT d_Month,s_AreaCN,n_PCount INTO #curT FROM T_SIPOData 
	          WHERE n_Type=@n_Type
	          AND s_AreaCN = @s_AreaCN
	          AND (d_Year>@d_StartYear OR (d_Year=@d_StartYear AND d_Month>=@d_StartMonth))
	          AND (d_Year<@d_EndYear OR (d_Year=@d_EndYear AND d_Month<=@d_EndMonth))	
	
	          SELECT d_Month,s_AreaCN,n_PCount INTO #lastT FROM T_SIPOData 
	          WHERE n_Type=@n_Type
	          AND s_AreaCN = @s_AreaCN
	          AND (d_Year>@d_StartYear-1 OR (d_Year=@d_StartYear-1 AND d_Month>=@d_StartMonth))
	          AND (d_Year<@d_EndYear-1 OR (d_Year=@d_EndYear-1 AND d_Month<=@d_EndMonth))	
	
	          SELECT #curT.d_Month d_Month
		          ,#curT.n_PCount curCount
		          ,#lastT.n_PCount lastCount
		          ,rate=CASE WHEN #lastT.n_PCount!=0 THEN (#curT.n_PCount-#lastT.n_PCount)*1.0/#lastT.n_PCount ELSE 0 END
	           FROM #curT LEFT JOIN #lastT ON #curT.d_Month=#lastT.d_Month 
	          ORDER BY #curT.d_Month
	
	          DROP TABLE #curT
	          DROP TABLE #lastT
          ]]>
    </commandText>
    <parameters>
      <param name="@d_StartYear" dbType="Int32" direction="Input"/>
      <param name="@d_StartMonth" dbType="Int32" direction="Input"/>
      <param name="@d_EndYear" dbType="Int32" direction="Input"/>
      <param name="@d_EndMonth" dbType="Int32" direction="Input"/>
      <param name="@n_Type" dbType="Int32" direction="Input"/>
      <param name="@s_AreaCN" dbType="String" direction="Input"/>
    </parameters>
  </dataCommand>
  <!--图1、14  XXX年1-X月XX省专利申请、授权趋势图-根据SIPOData计算-->
  <dataCommand name="load_Province_AllType_Month_BySIPO" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
                SELECT s_AreaCN
                ,d_Month
                ,curNum=(n_PCount+n_UCount+n_DCount) INTO #curT FROM [T_SIPOData] 
                WHERE n_Type=@n_Type
                AND d_Year=@d_EndYear
                AND d_Month<=@d_EndMonth
                AND s_AreaCN=@s_AreaCN

                SELECT s_AreaCN
                ,d_Month
                ,lastNum=(n_PCount+n_UCount+n_DCount) INTO #lastT FROM [T_SIPOData] 
                WHERE n_Type=@n_Type
                AND d_Year=@d_EndYear-1
                AND d_Month<=@d_EndMonth
                AND s_AreaCN=@s_AreaCN

                SELECT #curT.s_AreaCN s_AreaCN,
                #curT.d_Month d_Month,
                Num=#curT.curNum,
                rate=CASE WHEN #lastT.lastNum=0 THEN 0 ELSE (#curT.curNum-#lastT.lastNum)*1.0/#lastT.lastNum END
                FROM #curT
                LEFT JOIN #lastT
                ON #curT.d_Month=#lastT.d_Month
                ORDER BY #curT.d_Month

                DROP TABLE #curT
                DROP TABLE #lastT
          ]]>
    </commandText>
    <parameters>
      <param name="@d_EndYear" dbType="Int32" direction="Input"/>
      <param name="@d_EndMonth" dbType="Int32" direction="Input"/>
      <param name="@n_Type" dbType="Int32" direction="Input"/>
      <param name="@s_AreaCN" dbType="String" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="load_Province_AllType_Month" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
              SELECT SUM(f_Count) V_COUNT
              ,n_PatentYear V_Year
              ,n_PatentMonth V_Month
              INTO #G1
              FROM  dbo.T_PatentChartBaseData  WITH(NOLOCK)
              WHERE n_PatentStatus=@n_PatentStatus
              AND (YEAR(@d_StartDate)<n_PatentYear OR (YEAR(@d_StartDate)=n_PatentYear AND MONTH(@d_StartDate)<=n_PatentMonth))
              AND (YEAR(@d_EndDate)>n_PatentYear OR (YEAR(@d_EndDate)=n_PatentYear AND MONTH(@d_EndDate)>=n_PatentMonth))
              GROUP BY n_PatentYear,n_PatentMonth
 
              SELECT SUM(f_Count) V_COUNT
              ,n_PatentYear V_Year
              ,n_PatentMonth V_Month
              INTO #G2
              FROM  dbo.T_PatentChartBaseData  WITH(NOLOCK)
              WHERE n_PatentStatus=@n_PatentStatus
              AND ((YEAR(@d_StartDate)-1)<n_PatentYear OR ((YEAR(@d_StartDate)-1)=n_PatentYear AND MONTH(@d_StartDate)<=n_PatentMonth))
              AND ((YEAR(@d_EndDate)-1)>n_PatentYear OR ((YEAR(@d_EndDate)-1)=n_PatentYear AND MONTH(@d_EndDate)>=n_PatentMonth))
              GROUP BY n_PatentYear,n_PatentMonth
      
              SELECT g1.V_Year n_Year  
              ,g1.V_Month n_Month
              ,g1.V_COUNT n_Count
              ,g2.V_COUNT n_CountLast
              ,ZZL=
              CASE WHEN g2.V_COUNT=0 THEN 0 ELSE (ISNULL(((g1.V_COUNT-g2.V_COUNT)*100.0/g2.V_COUNT),0) )END
              INTO #G3
              FROM #G1 g1
              LEFT JOIN #G2 g2
              ON g1.V_Month=g2.V_Month
              AND g1.V_Year-1=g2.V_Year
      
              DECLARE @index int=1;
              DECLARE @T_Rate TABLE(n_Month int null, ZZL float null);
      
              WHILE(@index<=MONTH(@d_EndDate))
              BEGIN
              DECLARE @curCount int;
              DECLARE @lastCount int;
              SELECT @curCount=SUM(n_Count),
              @lastCount=SUM(n_CountLast) FROM #G3
              WHERE n_Month<=@index

              INSERT INTO @T_Rate (n_Month,ZZL)
              VALUES
              (
              @index,
              CASE WHEN @lastCount=0 THEN 0 ELSE ISNULL((@curCount-@lastCount)*1.0/@lastCount,0) END
              )
              SET @index=@index+1
              END 
      
              SELECT g3.n_Year,d_Month=g3.n_Month,Num=g3.n_Count,rate=rate.ZZL
              FROM #G3 g3
              LEFT JOIN @T_Rate rate
              ON g3.n_Month=rate.n_Month 
              ORDER BY g3.n_Month
      
              DROP TABLE #G1
              DROP TABLE #G2
              DROP TABLE #G3
      ]]>
    </commandText>
    <parameters>
      <param name="@n_PatentStatus" dbType="Int32" direction="Input"/>
      <param name="@d_StartDate" dbType="DateTime" direction="Input"/>
      <param name="@d_EndDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSamplePolitCityAndAreaNum" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --示范、试点--城市、区县、企业--数量
          SELECT COUNT(0) FROM T_SampleAndPilotInfo
          WHERE n_Type=@iType
          AND dt_Start<=@dtReportDate
          AND dt_End>=@dtReportDate      
      ]]>
    </commandText>
    <parameters>
      <param name="@iType" dbType="Int32" direction="Input"/>
      <param name="@dtReportDate" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSamplePolitApplyCityNumAndRate" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --示范、试点城市下的专利申请数量+同比增长
          DECLARE @dtLastYearStart DATETIME=DATEADD(YEAR,-1,@dtStart)
          DECLARE @dtLastYearEnd DATETIME=DATEADD(YEAR,-1,@dtEnd)

          --城市列表
          SELECT n_CityCode INTO #TSample FROM T_SampleAndPilotInfo
          WHERE n_Type=@iType
          AND dt_Start<=@dtEnd
          AND dt_End>=@dtEnd
          --简报当年数据
          SELECT COUNT(0) curCount INTO #TCur FROM T_PatentStatus TStatus 
          JOIN T_Applicants TApply ON TStatus.s_ApplicationNO=TApply.s_ApplicationNO
          JOIN #TSample TSample ON TApply.s_City=TSample.n_CityCode
          WHERE TApply.s_ApplicantSort=1
          AND TStatus.dt_ApplyDate>=@dtStart
          AND TStatus.dt_ApplyDate<@dtEnd
          --简报上一年数据
          SELECT COUNT(0) lastCount INTO #TLast FROM T_PatentStatus TStatus 
          JOIN T_Applicants TApply ON TStatus.s_ApplicationNO=TApply.s_ApplicationNO
          JOIN #TSample TSample ON TApply.s_City=TSample.n_CityCode
          WHERE TApply.s_ApplicantSort=1
          AND TStatus.dt_ApplyDate>=@dtLastYearStart
          AND TStatus.dt_ApplyDate<@dtLastYearEnd

          SELECT *,rate=CASE WHEN lastCount=0 THEN 0 ELSE (curCount-lastCount)*1.0/lastCount END
          FROM #TCur,#TLast

          DROP TABLE #TSample
          DROP TABLE #TCur
          DROP TABLE #TLast
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
      <param name="@iType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSamplePolitAuthorizeCityNumAndRate" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --示范、试点城市下的专利授权数量+同比增长
          DECLARE @dtLastYearStart DATETIME=DATEADD(YEAR,-1,@dtStart)
          DECLARE @dtLastYearEnd DATETIME=DATEADD(YEAR,-1,@dtEnd)

          --城市列表
          SELECT n_CityCode INTO #TSample FROM T_SampleAndPilotInfo
          WHERE n_Type=@iType
          AND dt_Start<=@dtEnd
          AND dt_End>=@dtEnd
          --简报当年数据
          SELECT COUNT(0) curCount INTO #TCur FROM T_PatentStatus TStatus 
          JOIN T_Applicants TApply ON TStatus.s_ApplicationNO=TApply.s_ApplicationNO
          JOIN #TSample TSample ON TApply.s_City=TSample.n_CityCode
          WHERE TApply.s_ApplicantSort=3
          AND TStatus.dt_AuthorizeDate>=@dtStart
          AND TStatus.dt_AuthorizeDate<@dtEnd
          --简报上一年数据
          SELECT COUNT(0) lastCount INTO #TLast FROM T_PatentStatus TStatus 
          JOIN T_Applicants TApply ON TStatus.s_ApplicationNO=TApply.s_ApplicationNO
          JOIN #TSample TSample ON TApply.s_City=TSample.n_CityCode
          WHERE TApply.s_ApplicantSort=3
          AND TStatus.dt_AuthorizeDate>=@dtLastYearStart
          AND TStatus.dt_AuthorizeDate<@dtLastYearEnd

          SELECT *,rate=CASE WHEN lastCount=0 THEN 0 ELSE (curCount-lastCount)*1.0/lastCount END
          FROM #TCur,#TLast

          DROP TABLE #TSample
          DROP TABLE #TCur
          DROP TABLE #TLast
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
      <param name="@iType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSamplePolitCityApplyRank" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --示范、试点城市的申请量排名
          --城市列表
          SELECT n_CityCode INTO #TSample FROM T_SampleAndPilotInfo
          WHERE n_Type=@iType
          AND dt_Start<=@dtEnd
          AND dt_End>=@dtEnd
          --排名表
          SELECT CITY_NAME,curCount FROM
          (
	          SELECT s_City,COUNT(s_City) curCount FROM T_PatentStatus TStatus 
	          JOIN T_Applicants TApply ON TStatus.s_ApplicationNO=TApply.s_ApplicationNO
	          JOIN #TSample TSample ON TApply.s_City= TSample.n_CityCode
	          WHERE TApply.s_ApplicantSort=1
	          AND TStatus.dt_ApplyDate>=@dtStart
	          AND TStatus.dt_ApplyDate<=@dtEnd
	          GROUP BY TApply.s_City
          ) Temp
          LEFT JOIN T_AddrCity ON T_AddrCIty.CITY_CODE=Temp.s_City
          ORDER BY curCount DESC
          DROP TABLE #TSample
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
      <param name="@iType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSamplePolitCityAuthorizeRank" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
           --示范、试点城市的授权量排名
          --城市列表
          SELECT n_CityCode INTO #TSample FROM T_SampleAndPilotInfo
          WHERE n_Type=@iType
          AND dt_Start<=@dtEnd
          AND dt_End>=@dtEnd
          --排名表
          SELECT CITY_NAME,curCount FROM
          (
	          SELECT s_City,COUNT(s_City) curCount FROM T_PatentStatus TStatus 
	          JOIN T_Applicants TApply ON TStatus.s_ApplicationNO=TApply.s_ApplicationNO
	          JOIN #TSample TSample ON TApply.s_City= TSample.n_CityCode
	          WHERE TApply.s_ApplicantSort=3
	          AND TStatus.dt_AuthorizeDate>=@dtStart
	          AND TStatus.dt_AuthorizeDate<=@dtEnd
	          GROUP BY TApply.s_City
          ) Temp
          LEFT JOIN T_AddrCity ON T_AddrCIty.CITY_CODE=Temp.s_City
          ORDER BY curCount DESC
          DROP TABLE #TSample
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
      <param name="@iType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSamplePolitAreaApplyNum" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --示范、试点区县下的专利申请数量+同比增长
           --区县列表
          SELECT n_CityCode,n_AreaCode INTO #TSample FROM T_SampleAndPilotInfo
          WHERE n_Type=@iType
          AND dt_Start<=@dtEnd
          AND dt_End>=@dtEnd

          --简报当年数据
          SELECT COUNT(0) curCount FROM T_PatentStatus TStatus 
          JOIN T_Applicants TApply ON TStatus.s_ApplicationNO=TApply.s_ApplicationNO
          JOIN #TSample TSample ON TApply.s_City=TSample.n_CityCode AND TApply.s_Area=TSample.n_AreaCode
          WHERE TApply.s_ApplicantSort=1
          AND TStatus.dt_ApplyDate>=@dtStart
          AND TStatus.dt_ApplyDate<@dtEnd

          DROP TABLE #TSample
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
      <param name="@iType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSamplePolitAreaAuthorizeNum" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --示范、试点区县下的专利授权数量+同比增长
           --区县列表
          SELECT n_CityCode,n_AreaCode INTO #TSample FROM T_SampleAndPilotInfo
          WHERE n_Type=@iType
          AND dt_Start<=@dtEnd
          AND dt_End>=@dtEnd

          --简报当年数据
          SELECT COUNT(0) curCount FROM T_PatentStatus TStatus 
          JOIN T_Applicants TApply ON TStatus.s_ApplicationNO=TApply.s_ApplicationNO
          JOIN #TSample TSample ON TApply.s_City=TSample.n_CityCode AND TApply.s_Area=TSample.n_AreaCode
          WHERE TApply.s_ApplicantSort=3
          AND TStatus.dt_AuthorizeDate>=@dtStart
          AND TStatus.dt_AuthorizeDate<@dtEnd

          DROP TABLE #TSample
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
      <param name="@iType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSamplePolitAreaApplyRank" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --示范、试点区县的申请量排名
          --区县列表
          SELECT n_CityCode,n_AreaCode INTO #TSample FROM T_SampleAndPilotInfo
          WHERE n_Type=@iType
          AND dt_Start<=@dtEnd
          AND dt_End>=@dtEnd
          --排名表
          SELECT s_CityName+s_AreaName CITY_AREA,curCount FROM
          (
	          SELECT n_AreaCode,COUNT(n_AreaCode) curCount FROM T_PatentStatus TStatus 
	          JOIN T_Applicants TApply ON TStatus.s_ApplicationNO=TApply.s_ApplicationNO
	          JOIN #TSample TSample ON TApply.s_City= TSample.n_CityCode AND TApply.s_Area=TSample.n_AreaCode
	          WHERE TApply.s_ApplicantSort=1
	          AND TStatus.dt_ApplyDate>=@dtStart
	          AND TStatus.dt_ApplyDate<=@dtEnd
	          GROUP BY n_AreaCode
          ) Temp
          LEFT JOIN T_SampleAndPilotInfo ON T_SampleAndPilotInfo.n_AreaCode=Temp.n_AreaCode
          ORDER BY curCount DESC
          DROP TABLE #TSample
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
      <param name="@iType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSamplePolitAreaAuthorizeRank" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --示范、试点区县的授权量排名
          --区县列表
          SELECT n_CityCode,n_AreaCode INTO #TSample FROM T_SampleAndPilotInfo
          WHERE n_Type=@iType
          AND dt_Start<=@dtEnd
          AND dt_End>=@dtEnd
          --排名表
          SELECT s_CityName+s_AreaName CITY_AREA,curCount FROM
          (
	          SELECT n_AreaCode,COUNT(n_AreaCode) curCount FROM T_PatentStatus TStatus 
	          JOIN T_Applicants TApply ON TStatus.s_ApplicationNO=TApply.s_ApplicationNO
	          JOIN #TSample TSample ON TApply.s_City= TSample.n_CityCode AND TApply.s_Area=TSample.n_AreaCode
	          WHERE TApply.s_ApplicantSort=3
	          AND TStatus.dt_AuthorizeDate>=@dtStart
	          AND TStatus.dt_AuthorizeDate<=@dtEnd
	          GROUP BY n_AreaCode
          ) Temp
          LEFT JOIN T_SampleAndPilotInfo ON T_SampleAndPilotInfo.n_AreaCode=Temp.n_AreaCode
          ORDER BY curCount DESC
          DROP TABLE #TSample
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
      <param name="@iType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSamplePolitAreaApplyInventRank" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --示范、试点区县的申请量排名
          --区县列表
          SELECT n_CityCode,n_AreaCode INTO #TSample FROM T_SampleAndPilotInfo
          WHERE n_Type=@iType
          AND dt_Start<=@dtEnd
          AND dt_End>=@dtEnd
          --排名表
          SELECT s_CityName+s_AreaName CITY_AREA,curCount FROM
          (
	          SELECT n_AreaCode,COUNT(n_AreaCode) curCount FROM T_PatentStatus TStatus
	          JOIN T_PatentCase TCase ON tcase.Application_NO=TStatus.s_ApplicationNO 
	          JOIN T_Applicants TApply ON TStatus.s_ApplicationNO=TApply.s_ApplicationNO
	          JOIN #TSample TSample ON TApply.s_City= TSample.n_CityCode AND TApply.s_Area=TSample.n_AreaCode
	          WHERE TApply.s_ApplicantSort=1
	          AND TCase.s_PatentType=1
	          AND TStatus.dt_ApplyDate>=@dtStart
	          AND TStatus.dt_ApplyDate<=@dtEnd
	          GROUP BY n_AreaCode
          ) Temp
          LEFT JOIN T_SampleAndPilotInfo ON T_SampleAndPilotInfo.n_AreaCode=Temp.n_AreaCode
          ORDER BY curCount DESC
          DROP TABLE #TSample
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
      <param name="@iType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSamplePolitAreaAuthorizeInventRank" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --示范、试点区县的授权量排名
          --区县列表
          SELECT n_CityCode,n_AreaCode INTO #TSample FROM T_SampleAndPilotInfo
          WHERE n_Type=@iType
          AND dt_Start<=@dtEnd
          AND dt_End>=@dtEnd
          --排名表
          SELECT s_CityName+s_AreaName CITY_AREA,curCount FROM
          (
	          SELECT n_AreaCode,COUNT(n_AreaCode) curCount FROM T_PatentStatus TStatus
	          JOIN T_PatentCase TCase ON tcase.Application_NO=TStatus.s_ApplicationNO 
	          JOIN T_Applicants TApply ON TStatus.s_ApplicationNO=TApply.s_ApplicationNO
	          JOIN #TSample TSample ON TApply.s_City= TSample.n_CityCode AND TApply.s_Area=TSample.n_AreaCode
	          WHERE TApply.s_ApplicantSort=3
	          AND TCase.s_PatentType=1
	          AND TStatus.dt_AuthorizeDate>=@dtStart
	          AND TStatus.dt_AuthorizeDate<=@dtEnd
	          GROUP BY n_AreaCode
          ) Temp
          LEFT JOIN T_SampleAndPilotInfo ON T_SampleAndPilotInfo.n_AreaCode=Temp.n_AreaCode
          ORDER BY curCount DESC
          DROP TABLE #TSample
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
      <param name="@iType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSamplePolitAreaApplyNumOverRegion" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --珠三角、粤东等地区的示范、试点区县的申请量
           --区县列表
          SELECT n_CityCode,n_AreaCode INTO #TSample FROM T_SampleAndPilotInfo
          WHERE n_Type=3 OR n_Type=4
          AND dt_Start<=@dtEnd
          AND dt_End>=@dtEnd

          SELECT n_AreaType,SUM(curCount) Num FROM T_SampleAndPilotInfo TInfo
          RIGHT JOIN
          (
	          SELECT n_AreaCode,COUNT(n_AreaCode) curCount FROM T_PatentStatus TStatus
	          JOIN T_Applicants TApply ON TStatus.s_ApplicationNO=TApply.s_ApplicationNO
	          JOIN #TSample TSample ON TApply.s_City= TSample.n_CityCode AND TApply.s_Area=TSample.n_AreaCode
	          WHERE TApply.s_ApplicantSort=1
	          AND TStatus.dt_ApplyDate>=@dtStart
	          AND TStatus.dt_ApplyDate<=@dtEnd
	          GROUP BY n_AreaCode
          ) Temp ON TInfo.n_AreaCode=Temp.n_AreaCode
          LEFT JOIN T_AddrCity ON T_AddrCity.PROVINCE_ID=5 AND T_AddrCity.CITY_CODE=TInfo.n_CityCode
          GROUP BY T_AddrCity.n_AreaType

          DROP TABLE #TSample
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSamplePolitAreaAuthorizeNumOverRegion" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --珠三角、粤东等地区的示范、试点区县的授权量
           --区县列表
          SELECT n_CityCode,n_AreaCode INTO #TSample FROM T_SampleAndPilotInfo
          WHERE n_Type=3 OR n_Type=4
          AND dt_Start<=@dtEnd
          AND dt_End>=@dtEnd

          SELECT n_AreaType,SUM(curCount) Num FROM T_SampleAndPilotInfo TInfo
          RIGHT JOIN
          (
	          SELECT n_AreaCode,COUNT(n_AreaCode) curCount FROM T_PatentStatus TStatus
	          JOIN T_Applicants TApply ON TStatus.s_ApplicationNO=TApply.s_ApplicationNO
	          JOIN #TSample TSample ON TApply.s_City= TSample.n_CityCode AND TApply.s_Area=TSample.n_AreaCode
	          WHERE TApply.s_ApplicantSort=3
	          AND TStatus.dt_AuthorizeDate>=@dtStart
	          AND TStatus.dt_AuthorizeDate<=@dtEnd
	          GROUP BY n_AreaCode
          ) Temp ON TInfo.n_AreaCode=Temp.n_AreaCode
          LEFT JOIN T_AddrCity ON T_AddrCity.PROVINCE_ID=5 AND T_AddrCity.CITY_CODE=TInfo.n_CityCode
          GROUP BY T_AddrCity.n_AreaType

          DROP TABLE #TSample
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSampleAdvanceEnterpriseNum" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
        --示范、优势企业总量
        SELECT COUNT(0) FROM T_SampleAndPilotInfo
        WHERE n_Type=@iType AND b_IsValid=1  
      ]]>
    </commandText>
    <parameters>
      <param name="@iType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSampleAdvanceEnterpriseApplyCountList" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --示范、优势企业-申请量-各企业具体数量
          SELECT s_EnterpriseName INTO #TSample FROM T_SampleAndPilotInfo
          WHERE n_Type=@iType
          AND b_IsValid=1

          SELECT COUNT(0) Num FROM T_Applicants TApply 
          JOIN #TSample TSample ON TApply.s_Name= TSample.s_EnterpriseName AND TApply.s_ApplicantSort=1
          JOIN T_PatentStatus TStatus ON TStatus.s_ApplicationNO=TApply.s_ApplicationNO
          WHERE TStatus.dt_ApplyDate>=@dtStart
          AND TStatus.dt_ApplyDate<=@dtEnd
          GROUP BY TSample.s_EnterpriseName
          DROP TABLE #TSample
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
      <param name="@iType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSampleAdvanceEnterpriseApplyInventCountTotal" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --示范、优势企业-申请量-发明专利-总量
          SELECT s_EnterpriseName INTO #TSample FROM T_SampleAndPilotInfo
          WHERE n_Type=@iType
          AND b_IsValid=1
	          
          SELECT COUNT(0) FROM T_Applicants TApply 
          JOIN #TSample TSample ON TApply.s_Name= TSample.s_EnterpriseName AND TApply.s_ApplicantSort='1'
          JOIN T_PatentStatus TStatus ON TStatus.s_ApplicationNO=TApply.s_ApplicationNO
          JOIN T_PatentCase TCase ON TCase.Application_NO=TApply.s_ApplicationNO AND Tcase.s_PatentType='1'
          WHERE TStatus.dt_ApplyDate>=@dtStart
          AND TStatus.dt_ApplyDate<=@dtEnd

          DROP TABLE #TSample
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
      <param name="@iType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSampleAdvanceEnterpriseAuthorizeCountList" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --示范、优势企业-授权量-各企业具体数量
          SELECT s_EnterpriseName INTO #TSample FROM T_SampleAndPilotInfo
          WHERE n_Type=@iType
          AND b_IsValid=1

          SELECT COUNT(0) Num FROM T_Applicants TApply 
          JOIN #TSample TSample ON TApply.s_Name= TSample.s_EnterpriseName AND TApply.s_ApplicantSort=3
          JOIN T_PatentStatus TStatus ON TStatus.s_ApplicationNO=TApply.s_ApplicationNO
          WHERE TStatus.dt_AuthorizeDate>=@dtStart
          AND TStatus.dt_AuthorizeDate<=@dtEnd
          GROUP BY TSample.s_EnterpriseName
          DROP TABLE #TSample
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
      <param name="@iType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSampleAdvanceEnterpriseAuthorizeInventCountTotal" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --示范、优势企业-授权量-发明专利-总量
          SELECT s_EnterpriseName INTO #TSample FROM T_SampleAndPilotInfo
          WHERE n_Type=@iType
          AND b_IsValid=1
	          
          SELECT COUNT(0) FROM T_Applicants TApply 
          JOIN #TSample TSample ON TApply.s_Name= TSample.s_EnterpriseName AND TApply.s_ApplicantSort='3'
          JOIN T_PatentStatus TStatus ON TStatus.s_ApplicationNO=TApply.s_ApplicationNO
          JOIN T_PatentCase TCase ON TCase.Application_NO=TApply.s_ApplicationNO AND Tcase.s_PatentType='1'
          WHERE TStatus.dt_AuthorizeDate>=@dtStart
          AND TStatus.dt_AuthorizeDate<=@dtEnd

          DROP TABLE #TSample
      ]]>
    </commandText>
    <parameters>
      <param name="@dtStart" dbType="DateTime" direction="Input"/>
      <param name="@dtEnd" dbType="DateTime" direction="Input"/>
      <param name="@iType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="loadSamplePolitInfoByType" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
		        SELECT @TotalCount = COUNT(1) FROM GDPA_One.dbo.T_SampleAndPilotInfo WITH(NOLOCK)
		        #StrWhere#
		
		        --根据n_Type筛选市、区数据
		        SELECT ROW_NUMBER() OVER(ORDER BY n_ID) rownumber, n_ID,s_ProvinceName,n_ProvinceCode,s_CityName,n_CityCode,s_AreaName
		        ,n_AreaCode,dt_Start,dt_End,s_EnterpriseName,n_EnterpriseID,b_IsValid,n_Type
		        INTO #Temp FROM GDPA_One.dbo.T_SampleAndPilotInfo WITH(NOLOCK)
		        #StrWhere#

		        SELECT rownumber, n_ID,s_ProvinceName,n_ProvinceCode,s_CityName,n_CityCode,s_AreaName
		        ,n_AreaCode,dt_Start,dt_End,s_EnterpriseName,n_EnterpriseID,b_IsValid,n_Type FROM #Temp
		        WHERE rownumber>=@StartNumber AND rownumber<=@EndNumber
		        ORDER BY #SortColumnName#
		        DROP TABLE #Temp
      ]]>
    </commandText>
  </dataCommand>
  <dataCommand name="loadEnterpriseDataByType" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --筛选企业数据
          SELECT n_ID,s_ProvinceName,n_ProvinceCode,s_CityName,n_CityCode,s_AreaName
                ,n_AreaCode,dt_Start,dt_End,s_EnterpriseName,n_EnterpriseID,b_IsValid,n_Type
          FROM GDPA_One.dbo.T_SampleAndPilotInfo
          WHERE n_Type=@iType
          AND b_IsValid=1
      ]]>
    </commandText>
    <parameters>
      <param name="@iType" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="deleteSamplePolitInfoByID" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --根据n_Type筛选数据
          DELETE FROM GDPA_One.dbo.T_SampleAndPilotInfo
          WHERE n_ID=@ID
      ]]>
    </commandText>
    <parameters>
      <param name="@ID" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="insertSamplePolitInfo" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --
          INSERT INTO GDPA_One.dbo.T_SampleAndPilotInfo
                     (s_ProvinceName
                     ,n_ProvinceCode
                     ,s_CityName
                     ,n_CityCode
                     ,s_AreaName
                     ,n_AreaCode
                     ,dt_Start
                     ,dt_End
                     ,s_EnterpriseName
                     ,n_EnterpriseID
                     ,b_IsValid
                     ,n_Type)
               VALUES
                     (@s_ProvinceName
                     ,@n_ProvinceCode
                     ,@s_CityName
                     ,@n_CityCode
                     ,@s_AreaName
                     ,@n_AreaCode
                     ,@dt_Start
                     ,@dt_End
                     ,@s_EnterpriseName
                     ,@n_EnterpriseID
                     ,@b_IsValid
                     ,@n_Type)
      ]]>
    </commandText>
    <parameters>
      <param name="@s_ProvinceName" dbType="String" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@s_CityName" dbType="String" direction="Input"/>
      <param name="@n_CityCode" dbType="Int32" direction="Input"/>
      <param name="@s_AreaName" dbType="String" direction="Input"/>
      <param name="@n_AreaCode" dbType="Int32" direction="Input"/>
      <param name="@dt_Start" dbType="DateTime" direction="Input"/>
      <param name="@dt_End" dbType="DateTime" direction="Input"/>
      <param name="@s_EnterpriseName" dbType="String" direction="Input"/>
      <param name="@n_EnterpriseID" dbType="Int32" direction="Input"/>
      <param name="@b_IsValid" dbType="Boolean" direction="Input"/>
      <param name="@n_Type" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="updateSamplePolitInfo" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
          --
          UPDATE GDPA_One.dbo.T_SampleAndPilotInfo SET
                        s_ProvinceName=@s_ProvinceName
                        ,n_ProvinceCode=@n_ProvinceCode
                        ,s_CityName=@s_CityName
                        ,n_CityCode=@n_CityCode
                        ,s_AreaName=@s_AreaName
                        ,n_AreaCode=@n_AreaCode
                        ,dt_Start=@dt_Start
                        ,dt_End=@dt_End
                        ,s_EnterpriseName=@s_EnterpriseName
                        ,n_EnterpriseID=@n_EnterpriseID
                        ,b_IsValid=@b_IsValid
                        ,n_Type=@n_Type
                        WHERE n_ID=@ID
      ]]>
    </commandText>
    <parameters>
      <param name="@ID" dbType="String" direction="Input"/>
      <param name="@s_ProvinceName" dbType="String" direction="Input"/>
      <param name="@n_ProvinceCode" dbType="Int32" direction="Input"/>
      <param name="@s_CityName" dbType="String" direction="Input"/>
      <param name="@n_CityCode" dbType="Int32" direction="Input"/>
      <param name="@s_AreaName" dbType="String" direction="Input"/>
      <param name="@n_AreaCode" dbType="Int32" direction="Input"/>
      <param name="@dt_Start" dbType="DateTime" direction="Input"/>
      <param name="@dt_End" dbType="DateTime" direction="Input"/>
      <param name="@s_EnterpriseName" dbType="String" direction="Input"/>
      <param name="@n_EnterpriseID" dbType="Int32" direction="Input"/>
      <param name="@b_IsValid" dbType="Boolean" direction="Input"/>
      <param name="@n_Type" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="checkSamplePolitCityExist" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
            SELECT n_ID FROM T_SampleAndPilotInfo
            WHERE n_Type=@n_Type AND n_CityCode=@n_CityCode
      ]]>
    </commandText>
    <parameters>
      <param name="@n_CityCode" dbType="Int32" direction="Input"/>
      <param name="@n_Type" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="checkSamplePolitAreaExist" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
            SELECT n_ID FROM T_SampleAndPilotInfo
            WHERE n_Type=@n_Type AND n_CityCode=@n_CityCode AND n_AreaCode=@n_AreaCode
      ]]>
    </commandText>
    <parameters>
      <param name="@n_CityCode" dbType="Int32" direction="Input"/>
      <param name="@n_AreaCode" dbType="Int32" direction="Input"/>
      <param name="@n_Type" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
  <dataCommand name="checkSampleAdvanceEnterpriseExist" database="MDATA" commandType="Text">
    <commandText>
      <![CDATA[ 
            SELECT n_ID FROM T_SampleAndPilotInfo
            WHERE n_Type=@n_Type AND s_EnterpriseName=@s_EnterpriseName
      ]]>
    </commandText>
    <parameters>
      <param name="@s_EnterpriseName" dbType="String" direction="Input"/>
      <param name="@n_Type" dbType="Int32" direction="Input"/>
    </parameters>
  </dataCommand>
</dataOperations>



